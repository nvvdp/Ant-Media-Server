!function(){function e(e,t){var i;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(i=n(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){i=e[Symbol.iterator]()},n:function(){var e=i.next();return s=e.done,e},e:function(e){c=!0,o=e},f:function(){try{s||null==i.return||i.return()}finally{if(c)throw o}}}}function t(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||n(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){if(e){if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function r(e,t,n){return(r="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=h(e)););return e}(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function s(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=h(e);if(t){var r=h(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return d(this,n)}}function d(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{"tP/V":function(n,i,o){"use strict";o.r(i),(function(n){o.d(i,"default",(function(){return W}));var u=o("LFg+");o("KeXy");var d=u.v.getComponent("MenuItem"),f=u.v.getComponent("Component"),m=function(e){c(n,e);var t=l(n);function n(e,i){return a(this,n),i.selectable=!0,i.multiSelectable=!1,t.call(this,e,i)}return s(n,[{key:"handleClick",value:function(){this.options().plugin.changeStreamQuality(this.options().value)}}]),n}(d);f.registerComponent("ResolutionMenuItem",m);var p=function(e){c(i,e);var n=l(i);function i(e,t){return a(this,i),n.call(this,e,t)}return s(i,[{key:"createEl",value:function(){return u.v.dom.createEl("div",{className:"vjs-http-source-selector vjs-menu-button vjs-menu-button-popup vjs-control vjs-button"})}},{key:"buildCSSClass",value:function(){return r(h(i.prototype),"buildCSSClass",this).call(this)+" vjs-icon-cog"}},{key:"update",value:function(){return r(h(i.prototype),"update",this).call(this)}},{key:"createItems",value:function(){for(var e=[],n=[{label:"auto",value:0}].concat(t(this.player().resolutions)),i=0;i<n.length;i++)e.push(new m(this.player_,{label:n[i].label,value:n[i].value,selected:n[i].value===this.player().selectedResolution,plugin:this.options().plugin,streamName:this.options().streamName}));return e}}]),i}(u.v.getComponent("MenuButton"));window.log=function(){var e=function(){},t="undefined"!=typeof window&&void 0!==window.navigator&&/Trident\/|MSIE /.test(window.navigator.userAgent),n=["trace","debug","info","warn","error"];function i(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(i){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function r(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function a(n){return"debug"===n&&(n="log"),"undefined"!=typeof console&&("trace"===n&&t?r:void 0!==console[n]?i(console,n):void 0!==console.log?i(console,"log"):e)}function o(t,i){for(var r=0;r<n.length;r++){var a=n[r];this[a]=r<t?e:this.methodFactory(a,t,i)}this.log=this.debug}function s(e,t,n){return function(){"undefined"!=typeof console&&(o.call(this,t,n),this[e].apply(this,arguments))}}function c(e,t,n){return a(e)||s.apply(this,arguments)}function u(e,t,i){var r,a=this;t=null==t?"WARN":t;var s="loglevel";function u(){var e;if("undefined"!=typeof window&&s){try{e=window.localStorage[s]}catch(i){}if(void 0===e)try{var t=window.document.cookie,n=t.indexOf(encodeURIComponent(s)+"=");-1!==n&&(e=/^([^;]+)/.exec(t.slice(n))[1])}catch(i){}return void 0===a.levels[e]&&(e=void 0),e}}"string"==typeof e?s+=":"+e:"symbol"==typeof e&&(s=void 0),a.name=e,a.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},a.methodFactory=i||c,a.getLevel=function(){return r},a.setLevel=function(t,i){if("string"==typeof t&&void 0!==a.levels[t.toUpperCase()]&&(t=a.levels[t.toUpperCase()]),!("number"==typeof t&&t>=0&&t<=a.levels.SILENT))throw"log.setLevel() called with invalid level: "+t;if(r=t,!1!==i&&function(e){var t=(n[e]||"silent").toUpperCase();if("undefined"!=typeof window&&s){try{return void(window.localStorage[s]=t)}catch(i){}try{window.document.cookie=encodeURIComponent(s)+"="+t+";"}catch(i){}}}(t),o.call(a,t,e),"undefined"==typeof console&&t<a.levels.SILENT)return"No console available for logging"},a.setDefaultLevel=function(e){t=e,u()||a.setLevel(e,!1)},a.resetLevel=function(){a.setLevel(t,!1),function(){if("undefined"!=typeof window&&s){try{return void window.localStorage.removeItem(s)}catch(e){}try{window.document.cookie=encodeURIComponent(s)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}()},a.enableAll=function(e){a.setLevel(a.levels.TRACE,e)},a.disableAll=function(e){a.setLevel(a.levels.SILENT,e)};var l=u();null==l&&(l=t),a.setLevel(l,!1)}var l=new u,d={};l.getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=d[e];return t||(t=d[e]=new u(e,l.getLevel(),l.methodFactory)),t};var h="undefined"!=typeof window?window.log:void 0;return l.noConflict=function(){return"undefined"!=typeof window&&window.log===l&&(window.log=h),l},l.getLoggers=function(){return d},l.default=l,l}();var v=window.log,g=function(){function e(t,n){a(this,e),this.context=t,this.instant=0,this.mic=null,this.volumeMeterNode=null,this.url=n}return s(e,[{key:"connectToSource",value:function(e,t,n){var i=this;return this.context.audioWorklet.addModule(this.url).then((function(){i.mic=i.context.createMediaStreamSource(e),i.volumeMeterNode=new AudioWorkletNode(i.context,"volume-meter"),i.volumeMeterNode.port.onmessage=function(e){"debug"==e.data.type?v.debug(e.data.message):(i.instant=e.data,t(i.instant.toFixed(2)),v.debug("Audio level: "+i.instant.toFixed(2)))},i.mic.connect(i.volumeMeterNode)})).catch((function(e){throw void 0!==n&&n(e),v.error("Error in soundmeter: "+e),v.error("You may need to define the url of the volume-meter-processor.js"),e}))}},{key:"stop",value:function(){null!=this.volumeMeterNode&&(this.volumeMeterNode.port.postMessage("stop"),this.volumeMeterNode.disconnect(),this.volumeMeterNode.port.close(),this.volumeMeterNode=null),null!=this.mic&&(this.mic.disconnect(),this.mic=null)}}]),e}();function y(){var e=navigator.userAgent||navigator.vendor||window.opera;return/android/i.test(e)}String.prototype.endsWith||(String.prototype.endsWith=function(e,t){var n=this.toString();("number"!=typeof t||!isFinite(t)||Math.floor(t)!==t||t>n.length)&&(t=n.length);var i=n.lastIndexOf(e,t-=e.length);return-1!==i&&i===t});var b=window.log,k=function(){function t(e){for(var n in a(this,t),this.bandwidth=1200,this.debug=!1,this.camera_location="top",this.camera_margin=15,this.camera_percent=15,this.mediaConstraints={video:!0,audio:!0},this.getSender=e.getSender,this.publishStreamId=null,this.localStream=null,this.publishMode="camera",this.callback=function(e,t){b.debug("Callback info: "+e+" object: "+typeof t!==void 0?JSON.stringify(t):"")},this.callbackError=function(e){b.error(e)},this.volumeMeterUrl="volume-meter-processor.js",e.userParameters)e.userParameters.hasOwnProperty(n)&&(this[n]=e.userParameters[n]);e.callback&&(this.callback=e.callback),e.callbackError&&(this.callbackError=e.callbackError),this.currentVolume=null,this.previousAudioTrack=null,this.silentAudioTrack=null,this.desktopStream=null,this.smallVideoTrack=null,this.blackVideoTrack=null,this.audioContext=new AudioContext,this.oscillator=null,this.primaryAudioTrackGainNode=null,this.secondaryAudioTrackGainNode=null,this.localStreamSoundMeter=null,this.levelCallback=null,this.blackFrameTimer=null,this.desktopCameraCanvasDrawerTimer=null,this.mutedAudioStream=null,this.isMuted=!1,this.meterRefresh=null,this.cameraEnabled=!0,this.replacementStream=null,this.localVideo=this.localVideoElement||document.getElementById(this.localVideoId),this.dummyCanvas=document.createElement("canvas"),this.mediaConstraints?"camera"==this.mediaConstraints.video?this.publishMode="camera":"screen"==this.mediaConstraints.video?this.publishMode="screen":"screen+camera"==this.mediaConstraints.video&&(this.publishMode="screen+camera"):this.mediaConstraints={video:!0,audio:!0},this.checkBrowserScreenShareSupported()}return s(t,[{key:"initLocalStream",value:function(){var e=this;return this.checkWebRTCPermissions(),void 0!==this.mediaConstraints.video&&0!=this.mediaConstraints.video?this.openStream(this.mediaConstraints):void 0!==this.mediaConstraints.audio&&0!=this.mediaConstraints.audio?this.navigatorUserMedia({audio:this.mediaConstraints.audio},(function(t){return e.gotStream(t)}),!0):(b.debug("no media requested, just return an empty stream"),Promise.resolve(null))}},{key:"checkWebRTCPermissions",value:function(){return"WebSocket"in window?void 0===navigator.mediaDevices?(b.debug("Cannot open camera and mic because of unsecure context. Please Install SSL(https)"),void this.callbackError("UnsecureContext")):void(void 0!==navigator.mediaDevices&&null!=navigator.mediaDevices&&null!=navigator.mediaDevices||this.callbackError("getUserMediaIsNotAllowed")):(b.debug("WebSocket not supported."),void this.callbackError("WebSocketNotSupported"))}},{key:"getDevices",value:function(){var e=this;return navigator.mediaDevices.enumerateDevices().then((function(t){var n=new Array,i=!1,r=!1;return t.forEach((function(e){"audioinput"!=e.kind&&"videoinput"!=e.kind||(n.push(e),"audioinput"==e.kind&&(i=!0),"videoinput"==e.kind&&(r=!0))})),e.callback("available_devices",n),0==i&&null==e.localStream&&(b.debug("Audio input not found"),b.debug("Retrying to get user media without audio"),e.inputDeviceNotFoundLimit<2?0!=r?(e.openStream({video:!0,audio:!1}),e.inputDeviceNotFoundLimit++):(b.debug("Video input not found"),alert("There is no video or audio input")):alert("No input device found, publish is not possible")),n})).catch((function(e){throw b.error("Cannot get devices -> error name: "+e.name+": "+e.message),e}))}},{key:"trackDeviceChange",value:function(){var e=this;navigator.mediaDevices.ondevicechange=function(){e.getDevices()}}},{key:"setDesktopwithCameraSource",value:function(e,t,n){var i=this;return this.desktopStream=e,this.navigatorUserMedia({video:!0,audio:!1},(function(r){i.smallVideoTrack=r.getVideoTracks()[0];var a=document.createElement("canvas"),o=a.getContext("2d"),s=document.createElement("video");s.srcObject=e,s.play();var c=document.createElement("video");c.srcObject=r,c.play();var u=a.captureStream(15);null!=n&&(e.getVideoTracks()[0].onended=function(e){n(e)}),(null==i.localStream?i.gotStream(u):i.updateVideoTrack(u,t,onended,null)).then((function(){i.desktopCameraCanvasDrawerTimer=setInterval((function(){a.width=s.videoWidth,a.height=s.videoHeight,o.drawImage(s,0,0,a.width,a.height);var e=s.videoWidth*(i.camera_percent/100),t=c.videoHeight/c.videoWidth*e;o.drawImage(c,a.width-e-i.camera_margin,"top"==i.camera_location?i.camera_margin:a.height-t-i.camera_margin,e,t)}),66)}))}),!0)}},{key:"prepareStreamTracks",value:function(e,t,n,i){var r=this,a=n.getAudioTracks();return a.length>0&&"camera"==this.publishMode&&(a[0].stop(),n.removeTrack(a[0])),"undefined"!=t&&0!=t?this.navigatorUserMedia({audio:t}).then((function(o){o=r.setGainNodeStream(o);var s=function(t){r.callback("screen_share_stopped"),r.setVideoCameraSource(i,e,null,!0)};return"screen"==r.publishMode?r.updateVideoTrack(n,i,s,!0).then((function(){return a.length>0&&(o=r.mixAudioStreams(n,o)),r.updateAudioTrack(o,i,null)})):"screen+camera"==r.publishMode?(a.length>0&&(o=r.mixAudioStreams(n,o)),r.updateAudioTrack(o,i,null).then((function(){return r.setDesktopwithCameraSource(n,i,s)}))):(0!=t&&null!=t&&n.addTrack(o.getAudioTracks()[0]),n.getVideoTracks().length>0?r.updateVideoTrack(n,i,null,null).then((function(){return r.updateAudioTrack(n,i,null).then((function(){return r.gotStream(n)}))})):n.getAudioTracks().length>0?r.updateAudioTrack(n,i,null).then((function(){return r.gotStream(n)})):r.gotStream(n))})).catch((function(e){throw"NotFoundError"==e.name?r.getDevices():r.callbackError(e.name,e.message),e})):this.gotStream(n)}},{key:"navigatorUserMedia",value:function(e,t,n){var i=this;if("dummy"==e.video||"dummy"==e.audio){var r=new MediaStream;return"dummy"==e.audio&&r.addTrack(this.getSilentAudioTrack()),"dummy"==e.video&&r.addTrack(this.getBlackVideoTrack()),new Promise((function(e,t){e(r)}))}return navigator.mediaDevices.getUserMedia(e).then((function(e){return void 0===t&&null==t||t(e),e})).catch((function(e){throw 1==n?"NotFoundError"==e.name?i.getDevices():i.callbackError(e.name,e.message):b.warn(e),e}))}},{key:"navigatorDisplayMedia",value:function(e,t){var n=this;return navigator.mediaDevices.getDisplayMedia(e).then((function(e){return void 0!==t&&t(e),e})).catch((function(e){"NotAllowedError"===e.name&&(b.debug("Permission denied error"),n.callbackError("ScreenSharePermissionDenied"),null==n.localStream?n.openStream({video:!0,audio:!0}):n.switchVideoCameraCapture(streamId))}))}},{key:"getMedia",value:function(e,t){var n=this,i=!1;return void 0!==e.audio&&0!=e.audio&&(i=e.audio),null!=this.desktopCameraCanvasDrawerTimer&&(clearInterval(this.desktopCameraCanvasDrawerTimer),this.desktopCameraCanvasDrawerTimer=null),"screen+camera"==this.publishMode||"screen"==this.publishMode?this.navigatorDisplayMedia(e).then((function(r){return n.smallVideoTrack&&n.smallVideoTrack.stop(),n.prepareStreamTracks(e,i,r,t)})):this.navigatorUserMedia(e).then((function(r){return n.smallVideoTrack&&n.smallVideoTrack.stop(),n.prepareStreamTracks(e,i,r,t)})).catch((function(e){"NotFoundError"==e.name?n.getDevices():n.callbackError(e.name,e.message)}))}},{key:"openStream",value:function(e,t){var n=this;return this.mediaConstraints=e,this.getMedia(e,t).then((function(){"dummy"!=n.mediaConstraints.video&&null!=n.mediaConstraints.video&&(n.stopBlackVideoTrack(),n.clearBlackVideoTrackTimer()),"dummy"!=n.mediaConstraints.audio&&null!=n.mediaConstraints.audio&&n.stopSilentAudioTrack()}))}},{key:"closeStream",value:function(){this.localStream&&(this.localStream.getVideoTracks().forEach((function(e){e.onended=null,e.stop()})),this.localStream.getAudioTracks().forEach((function(e){e.onended=null,e.stop()}))),this.videoTrack&&this.videoTrack.stop(),this.audioTrack&&this.audioTrack.stop(),this.smallVideoTrack&&this.smallVideoTrack.stop(),this.previousAudioTrack&&this.previousAudioTrack.stop()}},{key:"checkBrowserScreenShareSupported",value:function(){(void 0!==navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia||navigator.getDisplayMedia)&&this.callback("browser_screen_share_supported")}},{key:"enableSecondStreamInMixedAudio",value:function(e){null!=this.secondaryAudioTrackGainNode&&(this.secondaryAudioTrackGainNode.gain.value=e?1:0)}},{key:"gotStream",value:function(e){return this.localStream=e,this.localVideo&&(this.localVideo.srcObject=e),this.getDevices(),this.trackDeviceChange(),new Promise((function(e,t){e()}))}},{key:"changeLocalVideo",value:function(e){this.localVideo=e,this.localStream&&(this.localVideo.srcObject=this.localStream)}},{key:"enableAudioLevelWhenMuted",value:function(){var e=this;return new Promise((function(t,n){navigator.mediaDevices.getUserMedia({video:!1,audio:!0}).then((function(i){e.mutedAudioStream=i,e.mutedSoundMeter=new g(e.audioContext,e.volumeMeterUrl),e.mutedSoundMeter.connectToSource(e.mutedAudioStream,(function(t){t>.1&&e.callback("speaking_but_muted")}),(function(i){i&&n(i),e.meterRefresh=setInterval((function(){e.mutedSoundMeter.instant.toFixed(2)>.1&&e.callback("speaking_but_muted")}),200),t(null)}))})).catch((function(e){b.debug("Can't get the soundlevel on mute"),n(e)}))}))}},{key:"disableAudioLevelWhenMuted",value:function(){null!=this.meterRefresh&&(clearInterval(this.meterRefresh),this.meterRefresh=null),null!=this.mutedSoundMeter&&(this.mutedSoundMeter.stop(),this.mutedSoundMeter=null),null!=this.mutedAudioStream&&this.mutedAudioStream.getTracks().forEach((function(e){e.stop()}))}},{key:"mixAudioStreams",value:function(e,t){var n=new MediaStream;e.getVideoTracks().forEach((function(e){n.addTrack(e)}));var i=this.audioContext.createMediaStreamDestination();return e.getAudioTracks().length>0?(this.primaryAudioTrackGainNode=this.audioContext.createGain(),this.primaryAudioTrackGainNode.gain.value=1,this.audioContext.createMediaStreamSource(e).connect(this.primaryAudioTrackGainNode).connect(i)):b.debug("Origin stream does not have audio track"),t.getAudioTracks().length>0?(this.secondaryAudioTrackGainNode=this.audioContext.createGain(),this.secondaryAudioTrackGainNode.gain.value=1,this.audioContext.createMediaStreamSource(t).connect(this.secondaryAudioTrackGainNode).connect(i)):b.debug("Second stream does not have audio track"),i.stream.getAudioTracks().forEach((function(e){n.addTrack(e),b.debug("audio destination add track")})),n}},{key:"setGainNodeStream",value:function(t){if(0!=this.mediaConstraints.audio&&void 0!==this.mediaConstraints.audio){var n=t.getVideoTracks(),i=t.getAudioTracks();this.audioContext=new AudioContext;var r=this.audioContext.createMediaStreamSource(t),a=this.audioContext.createMediaStreamDestination();this.primaryAudioTrackGainNode=this.audioContext.createGain(),r.connect(this.primaryAudioTrackGainNode),this.primaryAudioTrackGainNode.connect(a),this.primaryAudioTrackGainNode.gain.value=null==this.currentVolume?1:this.currentVolume;var o,s=a.stream,c=e(n);try{for(c.s();!(o=c.n()).done;){var u=o.value;s.addTrack(u)}}catch(f){c.e(f)}finally{c.f()}var l,d=e(i);try{for(d.s();!(l=d.n()).done;){var h=l.value;s.addTrack(h)}}catch(f){d.e(f)}finally{d.f()}return null!==this.previousAudioTrack&&this.previousAudioTrack.stop(),this.previousAudioTrack=s.getAudioTracks()[1],s}return t}},{key:"switchDesktopCapture",value:function(e){return this.publishMode="screen",void 0!==this.mediaConstraints.video&&0!=this.mediaConstraints.video&&(this.mediaConstraints.video=!0),this.getMedia(this.mediaConstraints,e)}},{key:"switchDesktopCaptureWithCamera",value:function(e){return void 0!==this.mediaConstraints.video&&0!=this.mediaConstraints.video&&(this.mediaConstraints.video=!0),this.publishMode="screen+camera",this.getMedia(this.mediaConstraints,e)}},{key:"updateLocalAudioStream",value:function(e,t){var n=e.getAudioTracks()[0];if(null!=this.localStream&&null!=this.localStream.getAudioTracks()[0]){var i=this.localStream.getAudioTracks()[0];i!=n&&(this.localStream.removeTrack(i),i.stop(),this.localStream.addTrack(n))}else null!=this.localStream?this.localStream.addTrack(n):this.localStream=e;null!=this.localVideo&&(this.localVideo.srcObject=this.localStream),null!=t&&(e.getAudioTracks()[0].onended=function(e){t(e)}),this.isMuted?this.muteLocalMic():this.unmuteLocalMic(),null!=this.localStreamSoundMeter&&this.enableAudioLevelForLocalStream(this.levelCallback)}},{key:"updateLocalVideoStream",value:function(e,t,n){n&&null!=this.desktopStream&&this.desktopStream.getVideoTracks()[0].stop();var i=e.getVideoTracks()[0];if(null!=this.localStream&&null!=this.localStream.getVideoTracks()[0]){var r=this.localStream.getVideoTracks()[0];r!=i&&(this.localStream.removeTrack(r),r.stop(),this.localStream.addTrack(i))}else null!=this.localStream?this.localStream.addTrack(i):this.localStream=e;this.localVideo&&(this.localVideo.srcObject=this.localStream),null!=t&&(e.getVideoTracks()[0].onended=function(e){t(e)})}},{key:"switchAudioInputSource",value:function(e,t){var n=this.localStream.getAudioTracks()[0];return n&&y()&&n.stop(),void 0===n&&b.warn("There is no audio track in local stream"),void 0!==t?(!0!==this.mediaConstraints.audio?this.mediaConstraints.audio.deviceId=t:this.mediaConstraints.audio={deviceId:t},this.setAudioInputSource(e,{video:!1,audio:{deviceId:t}},null,t)):new Promise((function(e,t){t("There is no device id for audio input source")}))}},{key:"setAudioInputSource",value:function(e,t,n){var i=this;return this.navigatorUserMedia(t,(function(r){return r=i.setGainNodeStream(r),i.updateAudioTrack(r,e,t,n)}),!0)}},{key:"checkAndStopLocalVideoTrackOnAndroid",value:function(){this.localStream&&this.localStream.getVideoTracks().length>0&&y()&&this.localStream.getVideoTracks()[0].stop(),null!==this.localStream&&0!==this.localStream.getVideoTracks().length||b.warn("There is no video track in local stream")}},{key:"switchVideoCameraCapture",value:function(e,t,n){var i=this;return this.checkAndStopLocalVideoTrackOnAndroid(),this.publishMode="camera",navigator.mediaDevices.enumerateDevices().then((function(r){for(var a=0;a<r.length;a++)if("videoinput"==r[a].kind&&r[a].deviceId==t){!0!==i.mediaConstraints.video?i.mediaConstraints.video.deviceId={exact:t}:i.mediaConstraints.video={deviceId:{exact:t}};break}return b.debug("Given deviceId = "+t+" - Media constraints video property = "+i.mediaConstraints.video),i.setVideoCameraSource(e,i.mediaConstraints,n,!0,t)}))}},{key:"setVideoCameraSource",value:function(e,t,n,i){var r=this;return this.navigatorUserMedia(t,(function(a){return i&&r.secondaryAudioTrackGainNode&&a.getAudioTracks().length>0&&(r.secondaryAudioTrackGainNode=null,a=r.setGainNodeStream(a),r.updateAudioTrack(a,e,t,n)),r.cameraEnabled?r.updateVideoTrack(a,e,n,i):r.turnOffLocalCamera()}),!0)}},{key:"switchVideoCameraFacingMode",value:function(e,t){this.checkAndStopLocalVideoTrackOnAndroid(),void 0!==this.mediaConstraints.video&&void 0!==this.mediaConstraints.video.deviceId&&delete this.mediaConstraints.video.deviceId;var n={facingMode:t};return this.mediaConstraints.video=Object(u._)({},this.mediaConstraints.video,n),this.publishMode="camera",b.debug("Media constraints video property = "+this.mediaConstraints.video),this.setVideoCameraSource(e,{video:this.mediaConstraints.video},null,!0)}},{key:"updateAudioTrack",value:function(e,t,n){var i=this,r=this.getSender(t,"audio");return r?r.replaceTrack(e.getAudioTracks()[0]).then((function(t){i.updateLocalAudioStream(e,n)})).catch((function(e){throw b.debug(e.name),e})):(this.updateLocalAudioStream(e,n),new Promise((function(e,t){e()})))}},{key:"updateVideoTrack",value:function(e,t,n,i){var r=this,a=this.getSender(t,"video");return a?a.replaceTrack(e.getVideoTracks()[0]).then((function(t){r.updateLocalVideoStream(e,n,i)})).catch((function(e){b.debug(e.name)})):(this.updateLocalVideoStream(e,n,i),new Promise((function(e,t){e()})))}},{key:"getBlackVideoTrack",value:function(){var e=this;return this.dummyCanvas.getContext("2d").fillRect(0,0,320,240),this.replacementStream=this.dummyCanvas.captureStream(),null==this.blackFrameTimer&&(this.blackFrameTimer=setInterval((function(){e.getBlackVideoTrack()}),3e3)),this.blackVideoTrack=this.replacementStream.getVideoTracks()[0],this.blackVideoTrack}},{key:"getSilentAudioTrack",value:function(){this.stopSilentAudioTrack(),this.oscillator=this.audioContext.createOscillator();var e=this.oscillator.connect(this.audioContext.createMediaStreamDestination());return this.oscillator.start(),this.silentAudioTrack=e.stream.getAudioTracks()[0],this.silentAudioTrack}},{key:"stopSilentAudioTrack",value:function(){null!=this.oscillator&&(this.oscillator.stop(),this.oscillator.disconnect(),this.oscillator=null),null!=this.silentAudioTrack&&(this.silentAudioTrack.stop(),this.silentAudioTrack=null)}},{key:"turnOffLocalCamera",value:function(e){var t,n=this;return this.getBlackVideoTrack(),null!=this.localStream?(t=null!=e||void 0!==e?e:this.publishStreamId,this.cameraEnabled=!1,this.updateVideoTrack(this.replacementStream,t,null,!0)):new Promise((function(e,t){n.callbackError("NoActiveConnection"),t("NoActiveStream")}))}},{key:"clearBlackVideoTrackTimer",value:function(){null!=this.blackFrameTimer&&(clearInterval(this.blackFrameTimer),this.blackFrameTimer=null)}},{key:"stopBlackVideoTrack",value:function(){null!=this.blackVideoTrack&&(this.blackVideoTrack.stop(),this.blackVideoTrack=null)}},{key:"turnOnLocalCamera",value:function(e){var t=this;return this.clearBlackVideoTrackTimer(),this.stopBlackVideoTrack(),this.navigatorUserMedia(this.mediaConstraints,null==this.localStream?function(e){t.gotStream(e)}:function(n){var i;i=null!=e||void 0!==e?e:t.publishStreamId,t.cameraEnabled=!0,t.updateVideoTrack(n,i,null,!0)},!1)}},{key:"muteLocalMic",value:function(){this.isMuted=!0,null!=this.localStream?this.localStream.getAudioTracks().forEach((function(e){return e.enabled=!1})):this.callbackError("NoActiveConnection")}},{key:"unmuteLocalMic",value:function(){this.isMuted=!1,null!=this.localStream?this.localStream.getAudioTracks().forEach((function(e){return e.enabled=!0})):this.callbackError("NoActiveConnection")}},{key:"getVideoSender",value:function(e){var t=null;return"undefined"!=typeof adapter&&null!==adapter&&("chrome"===adapter.browserDetails.browser||"firefox"===adapter.browserDetails.browser||"safari"===adapter.browserDetails.browser&&adapter.browserDetails.version>=64)&&"RTCRtpSender"in window&&"setParameters"in window.RTCRtpSender.prototype&&(t=this.getSender(e,"video")),t}},{key:"changeBandwidth",value:function(e,t){var n=this.getVideoSender(t);if(null!=n){var i=n.getParameters();return i.encodings||(i.encodings=[{}]),"unlimited"===e?delete i.encodings[0].maxBitrate:i.encodings[0].maxBitrate=1e3*e,n.setParameters(i)}return Promise.reject("Video sender not found to change bandwidth. Streaming may not be active")}},{key:"setVolumeLevel",value:function(e){this.currentVolume=e,null!=this.primaryAudioTrackGainNode&&(this.primaryAudioTrackGainNode.gain.value=e),null!=this.secondaryAudioTrackGainNode&&(this.secondaryAudioTrackGainNode.gain.value=e)}},{key:"enableAudioLevelForLocalStream",value:function(e){var t=this;return this.levelCallback=e,this.disableAudioLevelForLocalStream(),this.localStreamSoundMeter=new g(this.audioContext,this.volumeMeterUrl),"running"!==this.audioContext.state?this.audioContext.resume().then((function(){return t.localStreamSoundMeter.connectToSource(t.localStream,e)})):this.localStreamSoundMeter.connectToSource(this.localStream,e)}},{key:"disableAudioLevelForLocalStream",value:function(){null!=this.localStreamSoundMeter&&(this.localStreamSoundMeter.stop(),this.localStreamSoundMeter=null)}},{key:"applyConstraints",value:function(e){var t={};void 0===e.audio&&void 0===e.video?(t.video=e,this.mediaConstraints.video=Object(u._)({},this.mediaConstraints.video,t.video)):void 0!==e.video&&(t.video=e.video,this.mediaConstraints.video=Object(u._)({},this.mediaConstraints.video,t.video)),void 0!==e.audio&&(t.audio=e.audio,this.mediaConstraints.audio=Object(u._)({},this.mediaConstraints.audio,t.audio));var n=null;return void 0!==t.video&&(n=this.localStream&&this.localStream.getVideoTracks().length>0?this.localStream.getVideoTracks()[0].applyConstraints(this.mediaConstraints.video):new Promise((function(e,t){t("There is no video track to apply constraints")}))),void 0!==t.audio&&(n=this.setAudioInputSource(this.publishStreamId,{audio:this.mediaConstraints.audio},null)),null!=this.localStreamSoundMeter&&this.enableAudioLevelForLocalStream(this.levelCallback),n}}]),t}();function S(e,t,n,i,r,a,o){try{var s=e[a](o),c=s.value}catch(u){return void n(u)}s.done?t(c):Promise.resolve(c).then(i,r)}function w(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var a=e.apply(t,n);function o(e){S(a,i,r,o,s,"next",e)}function s(e){S(a,i,r,o,s,"throw",e)}o(void 0)}))}}function C(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function A(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}function T(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}function E(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}var R=function(){function e(t){a(this,e),this.streamId=t,this.totalBytesReceivedCount=0,this.totalBytesSent=0,this.videoPacketsLost=0,this.fractionLost=0,this.startTime=0,this.lastFramesEncoded=0,this.totalFramesEncodedCount=0,this.lastBytesReceived=0,this.lastBytesSent=0,this.totalVideoPacketsSent=0,this.totalAudioPacketsSent=0,this.currentTimestamp=0,this.lastTime=0,this.timerId=0,this.firstByteSentCount=0,this.firstBytesReceivedCount=0,this.audioLevel=-1,this.qualityLimitationReason="",this.resWidth=0,this.resHeight=0,this.srcFps=0,this.frameWidth=0,this.frameHeight=0,this.videoRoundTripTime=0,this.videoJitter=0,this.audioRoundTripTime=0,this.audioJitter=0,this.audioPacketsLost=0,this.framesReceived=0,this.framesDropped=0,this.framesDecoded=0,this.audioJitterAverageDelay=0,this.videoJitterAverageDelay=0,this.availableOutgoingBitrate=1/0,this.inboundRtpList=[]}return s(e,[{key:"averageOutgoingBitrate",get:function(){return Math.floor(8*(this.totalBytesSentCount-this.firstByteSentCount)/(this.currentTimestamp-this.startTime))}},{key:"currentFPS",get:function(){return((this.totalFramesEncodedCount-this.lastFramesEncoded)/(this.currentTimestamp-this.lastTime)*1e3).toFixed(1)}},{key:"averageIncomingBitrate",get:function(){return Math.floor(8*(this.totalBytesReceivedCount-this.firstBytesReceivedCount)/(this.currentTimestamp-this.startTime))}},{key:"currentOutgoingBitrate",get:function(){return Math.floor(8*(this.totalBytesSentCount-this.lastBytesSent)/(this.currentTimestamp-this.lastTime))}},{key:"currentIncomingBitrate",get:function(){return Math.floor(8*(this.totalBytesReceivedCount-this.lastBytesReceived)/(this.currentTimestamp-this.lastTime))}},{key:"currentTime",set:function(e){this.lastTime=this.currentTimestamp,this.currentTimestamp=e,0==this.startTime&&(this.startTime=e-1)}},{key:"totalBytesReceived",set:function(e){this.lastBytesReceived=this.totalBytesReceivedCount,this.totalBytesReceivedCount=e,0==this.firstBytesReceivedCount&&(this.firstBytesReceivedCount=e)}},{key:"totalBytesSent",set:function(e){this.lastBytesSent=this.totalBytesSentCount,this.totalBytesSentCount=e,0==this.firstByteSentCount&&(this.firstByteSentCount=e)}},{key:"totalFramesEncoded",set:function(e){this.lastFramesEncoded=this.totalFramesEncodedCount,this.totalFramesEncodedCount=e,0==this.lastFramesEncoded&&(this.lastFramesEncoded=e)}}]),e}(),P=window.log,I=function(){function e(t){var n=this;for(var i in a(this,e),this.debug=!1,t)t.hasOwnProperty(i)&&(this[i]=t[i]);this.initWebSocketConnection(),addEventListener("offline",(function(e){n.connected=!1,n.connecting=!1,P.info("Network status has changed to offline. Resetting flags to reconnect faster")}))}return s(e,[{key:"initWebSocketConnection",value:function(e){var t=this;this.connecting=!0,this.connected=!1,this.pingTimerId=-1;var n=new URL(this.websocket_url);["origin","edge"].includes(n.searchParams.get("target"))||(n.searchParams.set("target",this.webrtcadaptor.isPlayMode?"edge":"origin"),this.websocket_url=n.toString()),this.wsConn=new WebSocket(this.websocket_url),this.wsConn.onopen=function(){t.debug&&P.debug("websocket connected"),t.pingTimerId=setInterval((function(){t.sendPing()}),3e3),t.connected=!0,t.connecting=!1,t.callback("initialized"),void 0!==e&&e()},this.wsConn.onmessage=function(e){var n=JSON.parse(e.data);"start"==n.command?(t.debug&&P.debug("received start command"),t.webrtcadaptor.startPublishing(n.streamId)):"takeCandidate"==n.command?(t.debug&&(P.debug("received ice candidate for stream id "+n.streamId),P.debug(n.candidate)),t.webrtcadaptor.takeCandidate(n.streamId,n.label,n.candidate)):"takeConfiguration"==n.command?(t.debug&&P.debug("received remote description type for stream id: "+n.streamId+" type: "+n.type),t.webrtcadaptor.takeConfiguration(n.streamId,n.sdp,n.type,n.idMapping)):"stop"==n.command?(t.debug&&P.debug("Stop command received"),t.webrtcadaptor.closePeerConnection(n.streamId)):"error"==n.command?t.callbackError(n.definition,n):"notification"==n.command?t.callback(n.definition,n):"streamInformation"==n.command||"roomInformation"==n.command?t.callback(n.command,n):"pong"==n.command?t.callback(n.command):"trackList"==n.command?t.callback(n.command,n):"connectWithNewId"==n.command?(t.multiPeerStreamId=n.streamId,t.join(n.streamId)):"peerMessageCommand"==n.command&&t.callback(n.command,n)},this.wsConn.onerror=function(e){t.connecting=!1,t.connected=!1,P.info(" error occured: "+JSON.stringify(e)),t.clearPingTimer(),t.callbackError("WebSocketNotConnected",e)},this.wsConn.onclose=function(e){t.connecting=!1,t.connected=!1,t.debug&&P.debug("connection closed."),t.clearPingTimer(),t.callback("closed",e)}}},{key:"clearPingTimer",value:function(){-1!=this.pingTimerId&&(this.debug&&P.debug("Clearing ping message timer"),clearInterval(this.pingTimerId),this.pingTimerId=-1)}},{key:"sendPing",value:function(){this.wsConn.send(JSON.stringify({command:"ping"}))}},{key:"close",value:function(){this.wsConn.close()}},{key:"send",value:function(e){var t=this;if(0!=this.connecting||0!=this.connected)try{this.wsConn.send(e),this.debug&&P.debug("sent message:"+e)}catch(n){P.warn("Cannot send message:"+e)}else this.initWebSocketConnection((function(){t.send(e)}))}},{key:"isConnected",value:function(){return this.connected}},{key:"isConnecting",value:function(){return this.connecting}}]),e}(),M=window.log,L=function e(t){a(this,e),this.size=t,this.received=0,this.data=new ArrayBuffer(t)},O=function(){function e(t){var n=this;for(var i in a(this,e),this.peerconnection_config={iceServers:[{urls:"stun:stun1.l.google.com:19302"}],sdpSemantics:"unified-plan"},this.sdp_constraints={OfferToReceiveAudio:!1,OfferToReceiveVideo:!1},this.remotePeerConnection=new Array,this.remotePeerConnectionStats=new Array,this.remoteDescriptionSet=new Array,this.iceCandidateList=new Array,this.roomName=null,this.playStreamId=new Array,this.isMultiPeer=!1,this.multiPeerStreamId=null,this.webSocketAdaptor=null,this.isPlayMode=!1,this.debug=!1,this.publishStreamId=null,this.idMapping=new Array,this.onlyDataChannel=!1,this.dataChannelEnabled=!0,this.receivingMessages=new Map,this.candidateTypes=["udp","tcp"],this.callback=null,this.callbackError=null,this.reconnectIfRequiredFlag=!0,this.websocket_url=null,this.websocketURL=null,this.initializeComponents=!0,this.degradationPreference="maintain-resolution",t)t.hasOwnProperty(i)&&(this[i]=t[i]);if(null==this.websocketURL&&(this.websocketURL=this.websocket_url),null==this.websocketURL)throw new Error("WebSocket URL is not defined. It's mandatory");this.remoteVideo=this.remoteVideoElement||document.getElementById(this.remoteVideoId),this.soundMeters=new Array,this.soundLevelList=new Array,this.eventListeners=new Array,this.errorEventListeners=new Array,this.publishToken=null,this.publishSubscriberId=null,this.publishSubscriberCode=null,this.publishStreamName=null,this.publishMainTrack=null,this.publishMetaData=null,this.publishRole=null,this.playToken=null,this.playRoomId=null,this.playEnableTracks=null,this.playSubscriberId=null,this.playSubscriberCode=null,this.playMetaData=null,this.playRole=null,this.lastReconnectiontionTrialTime=0,this.mediaManager=new k({userParameters:t,webRTCAdaptor:this,callback:function(e,t){n.notifyEventListeners(e,t)},callbackError:function(e,t){n.notifyErrorEventListeners(e,t)},getSender:function(e,t){return n.getSender(e,t)}}),this.initializeComponents&&this.initialize()}return s(e,null,[{key:"register",value:function(t){e.pluginInitMethods.push(t)}}]),s(e,[{key:"initPlugins",value:function(){var t=this;e.pluginInitMethods.forEach((function(e){e(t)}))}},{key:"addEventListener",value:function(e){this.eventListeners.push(e)}},{key:"addErrorEventListener",value:function(e){this.errorEventListeners.push(e)}},{key:"notifyEventListeners",value:function(e,t){this.eventListeners.forEach((function(n){n(e,t)})),null!=this.callback&&this.callback(e,t)}},{key:"notifyErrorEventListeners",value:function(e,t){this.errorEventListeners.forEach((function(n){n(e,t)})),null!=this.callbackError&&this.callbackError(e,t)}},{key:"initialize",value:function(){var e=this;return this.isPlayMode||this.onlyDataChannel||null!=this.mediaManager.localStream?new Promise((function(t,n){e.initPlugins(),e.checkWebSocketConnection(),t("Wait 'initialized' callback from websocket")})):this.mediaManager.initLocalStream().then((function(){return e.initPlugins(),e.checkWebSocketConnection(),new Promise((function(e,t){e("Wait 'initialized' callback from websocket")}))})).catch((function(e){throw M.warn(e),e}))}},{key:"publish",value:function(e,t,n,i,r,a,o,s){var c=this;if(this.publishStreamId=e,this.mediaManager.publishStreamId=e,this.publishToken=t,this.publishSubscriberId=n,this.publishSubscriberCode=i,this.publishStreamName=r,this.publishMainTrack=a,this.publishMetaData=o,this.publishRole=s,this.onlyDataChannel)this.sendPublishCommand(e,t,n,i,r,a,o,s,!1,!1);else if(null==this.mediaManager.localStream)this.mediaManager.initLocalStream().then((function(){var u=!1,l=!1;null!=c.mediaManager.localStream&&(u=c.mediaManager.localStream.getVideoTracks().length>0,l=c.mediaManager.localStream.getAudioTracks().length>0),c.sendPublishCommand(e,t,n,i,r,a,o,s,u,l)})).catch((function(e){throw M.warn(e),e}));else{var u=this.mediaManager.localStream.getVideoTracks().length>0,l=this.mediaManager.localStream.getAudioTracks().length>0;this.sendPublishCommand(e,t,n,i,r,a,o,s,u,l)}this.initPeerConnection(e,"publish"),setTimeout((function(){"checking"!=c.iceConnectionState(c.publishStreamId)&&"connected"!=c.iceConnectionState(c.publishStreamId)&&"completed"!=c.iceConnectionState(c.publishStreamId)&&c.reconnectIfRequired(0)}),3e3)}},{key:"sendPublishCommand",value:function(e,t,n,i,r,a,o,s,c,u){this.webSocketAdaptor.send(JSON.stringify({command:"publish",streamId:e,token:t,subscriberId:void 0!==typeof n&&null!=n?n:"",subscriberCode:void 0!==typeof i&&null!=i?i:"",streamName:void 0!==typeof r&&null!=r?r:"",mainTrack:void 0!==typeof a&&null!=a?a:"",video:c,audio:u,metaData:void 0!==typeof o&&null!=o?o:"",role:void 0!==typeof s&&null!=s?s:""}))}},{key:"joinRoom",value:function(e,t,n){this.roomName=e,this.webSocketAdaptor.send(JSON.stringify({command:"joinRoom",room:e,streamId:t,mode:n}))}},{key:"play",value:function(e,t,n,i,r,a,o,s){var c=this;this.playStreamId.push(e),this.playToken=t,this.playRoomId=n,this.playEnableTracks=i,this.playSubscriberId=r,this.playSubscriberCode=a,this.playMetaData=o,this.playRole=s,this.webSocketAdaptor.send(JSON.stringify({command:"play",streamId:e,token:void 0!==typeof t&&null!=t?t:"",room:void 0!==typeof n&&null!=n?n:"",trackList:void 0!==typeof i&&null!=i?i:[],subscriberId:void 0!==typeof r&&null!=r?r:"",subscriberCode:void 0!==typeof a&&null!=r?a:"",viewerInfo:void 0!==typeof o&&null!=o?o:"",role:void 0!==typeof s&&null!=s?s:""})),this.initPeerConnection(e,"play"),setTimeout((function(){"checking"!=c.iceConnectionState(e)&&"connected"!=c.iceConnectionState(e)&&"completed"!=c.iceConnectionState(e)&&c.reconnectIfRequired(0)}),3e3)}},{key:"reconnectIfRequired",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3e3;this.reconnectIfRequiredFlag&&(t>0?setTimeout((function(){e.tryAgain()}),t):this.tryAgain())}},{key:"tryAgain",value:function(){var e=this,t=this,n=Date.now();if(!(n-this.lastReconnectiontionTrialTime<3e3)){this.lastReconnectiontionTrialTime=n,null!=this.remotePeerConnection[this.publishStreamId]&&"checking"!=this.iceConnectionState(this.publishStreamId)&&"connected"!=this.iceConnectionState(this.publishStreamId)&&"completed"!=this.iceConnectionState(this.publishStreamId)&&(this.notifyEventListeners("reconnection_attempt_for_publisher",this.publishStreamId),this.stop(this.publishStreamId),setTimeout((function(){M.log("Trying publish again for stream: "+e.publishStreamId),e.publish(e.publishStreamId,e.publishToken,e.publishSubscriberId,e.publishSubscriberCode,e.publishStreamName,e.publishMainTrack,e.publishMetaData,e.publishRole)}),500));var i=function(){var e=t.playStreamId[r];"null"!=t.remotePeerConnection[e]&&"checking"!=t.iceConnectionState(e)&&"connected"!=t.iceConnectionState(e)&&"completed"!=t.iceConnectionState(e)&&(t.notifyEventListeners("reconnection_attempt_for_player",e),M.log("It will try to play again for stream: "+e+" because it is not stopped on purpose"),t.stop(e),setTimeout((function(){M.log("Trying play again for stream: "+e),t.play(e,t.playToken,t.playRoomId,t.playEnableTracks,t.playSubscriberId,t.playSubscriberCode,t.playMetaData,t.playRole)}),500))};for(var r in this.playStreamId)i()}}},{key:"stop",value:function(e){this.closePeerConnection(e),null!=this.webSocketAdaptor&&this.webSocketAdaptor.isConnected()&&this.webSocketAdaptor.send(JSON.stringify({command:"stop",streamId:e}))}},{key:"join",value:function(e){this.webSocketAdaptor.send(JSON.stringify({command:"join",streamId:e,multiPeer:this.isMultiPeer&&null==this.multiPeerStreamId,mode:this.isPlayMode?"play":"both"}))}},{key:"onTrack",value:function(e,t){if(M.debug("onTrack for stream"),null!=this.remoteVideo)this.remoteVideo.srcObject!==e.streams[0]&&(this.remoteVideo.srcObject=e.streams[0],M.debug("Received remote stream"));else{var n={stream:e.streams[0],track:e.track,streamId:t,trackId:this.idMapping[t][e.transceiver.mid]};this.notifyEventListeners("newTrackAvailable",n),this.notifyEventListeners("newStreamAvailable",n)}}},{key:"leaveFromRoom",value:function(e){for(var t in this.remotePeerConnection)this.closePeerConnection(t);this.roomName=e;var n={command:"leaveFromRoom",room:e};M.debug("leave request is sent for "+e),this.webSocketAdaptor.send(JSON.stringify(n))}},{key:"leave",value:function(e){this.webSocketAdaptor.send(JSON.stringify({command:"leave",streamId:this.isMultiPeer&&null!=this.multiPeerStreamId?this.multiPeerStreamId:e})),this.closePeerConnection(e),this.multiPeerStreamId=null}},{key:"getStreamInfo",value:function(e){this.webSocketAdaptor.send(JSON.stringify({command:"getStreamInfo",streamId:e}))}},{key:"requestVideoTrackAssignments",value:function(e){this.webSocketAdaptor.send(JSON.stringify({command:"getVideoTrackAssignmentsCommand",streamId:e}))}},{key:"getBroadcastObject",value:function(e){this.webSocketAdaptor.send(JSON.stringify({command:"getBroadcastObject",streamId:e}))}},{key:"updateStreamMetaData",value:function(e,t){this.webSocketAdaptor.send(JSON.stringify({command:"updateStreamMetaData",streamId:e,metaData:t}))}},{key:"getRoomInfo",value:function(e,t){this.webSocketAdaptor.send(JSON.stringify({command:"getRoomInfo",streamId:t,room:e}))}},{key:"getSubtracks",value:function(e,t,n,i){this.webSocketAdaptor.send(JSON.stringify({command:"getSubtracks",streamId:e,role:t,offset:n,size:i}))}},{key:"enableTrack",value:function(e,t,n){this.webSocketAdaptor.send(JSON.stringify({command:"enableTrack",streamId:e,trackId:t,enabled:n}))}},{key:"getTracks",value:function(e,t){this.playStreamId.push(e),this.webSocketAdaptor.send(JSON.stringify({command:"getTrackList",streamId:e,token:t}))}},{key:"iceCandidateReceived",value:function(e,t){if(e.candidate){var n=!1;if(""==e.candidate.candidate?n=!0:void 0===e.candidate.protocol?this.candidateTypes.forEach((function(t){e.candidate.candidate.toLowerCase().includes(t)&&(n=!0)})):n=this.candidateTypes.includes(e.candidate.protocol.toLowerCase()),n){var i={command:"takeCandidate",streamId:t,label:e.candidate.sdpMLineIndex,id:e.candidate.sdpMid,candidate:e.candidate.candidate};this.debug&&(M.debug("sending ice candiate for stream Id "+t),M.debug(JSON.stringify(e.candidate))),this.webSocketAdaptor.send(JSON.stringify(i))}else M.debug("Candidate's protocol(full sdp: "+e.candidate.candidate+") is not supported. Supported protocols: "+this.candidateTypes),""!=e.candidate.candidate&&this.notifyErrorEventListeners("protocol_not_supported","Support protocols: "+this.candidateTypes.toString()+" candidate: "+e.candidate.candidate)}else M.debug("No event.candidate in the iceCandidate event")}},{key:"sanitizeHTML",value:function(e){return e.includes("script")?e.replace(/</g,"&lt;").replace(/>/g,"&gt;"):e}},{key:"initDataChannel",value:function(e,t){var n=this;t.onerror=function(i){M.debug("Data Channel Error:",i);var r={streamId:e,error:i};M.debug("channel status: ",t.readyState),"closed"!=t.readyState&&n.notifyErrorEventListeners("data_channel_error",r)},t.onmessage=function(t){var i={streamId:e,data:t.data},r=i.data;if("string"==typeof r||r instanceof String)i.data=n.sanitizeHTML(i.data),n.notifyEventListeners("data_received",i);else{var a=r.length||r.size||r.byteLength,o=(c=new Int32Array(r,0,1))[0],s=n.receivingMessages[o];if(null==s){var c=new Int32Array(r,0,2);return s=new L(c[1]),n.receivingMessages[o]=s,void(a>8&&M.debug("something went wrong in msg receiving"))}var u=r.slice(4,a);new Uint8Array(s.data).set(new Uint8Array(u),s.received,a-4),s.received+=a-4,s.size==s.received&&(i.data=s.data,n.notifyEventListeners("data_received",i))}},t.onopen=function(){n.remotePeerConnection[e].dataChannel=t,M.debug("Data channel is opened"),n.notifyEventListeners("data_channel_opened",e)},t.onclose=function(){M.debug("Data channel is closed"),n.notifyEventListeners("data_channel_closed",e)}}},{key:"initPeerConnection",value:function(e,t){var n=this;if(null==this.remotePeerConnection[e]){var i=e;if(M.debug("stream id in init peer connection: "+e+" close stream id: "+i),this.remotePeerConnection[e]=new RTCPeerConnection(this.peerconnection_config),this.remoteDescriptionSet[e]=!1,this.iceCandidateList[e]=new Array,this.playStreamId.includes(e)||null!=this.mediaManager.localStream&&this.mediaManager.localStream.getTracks().forEach((function(t){var i=n.remotePeerConnection[e].addTrack(t,n.mediaManager.localStream);if("video"==t.kind){var r=i.getParameters();r.degradationPreference=n.degradationPreference,i.setParameters(r).then((function(){M.info("Degradation Preference is set to "+n.degradationPreference)})).catch((function(e){M.warn("Degradation Preference cannot be set to "+n.degradationPreference)}))}})),this.remotePeerConnection[e].onicecandidate=function(e){n.iceCandidateReceived(e,i)},this.remotePeerConnection[e].ontrack=function(e){n.onTrack(e,i)},this.remotePeerConnection[e].onnegotiationneeded=function(e){M.debug("onnegotiationneeded")},this.dataChannelEnabled)if("publish"==t)if(this.remotePeerConnection[e].createDataChannel){var r=this.remotePeerConnection[e].createDataChannel(e,{ordered:!0});this.initDataChannel(e,r)}else M.warn("CreateDataChannel is not supported");else if("play"==t)this.remotePeerConnection[e].ondatachannel=function(t){n.initDataChannel(e,t.channel)};else if(this.remotePeerConnection[e].createDataChannel){var a=this.remotePeerConnection[e].createDataChannel(e,{ordered:!0});this.initDataChannel(e,a),this.remotePeerConnection[e].ondatachannel=function(t){n.initDataChannel(e,t.channel)}}else M.warn("CreateDataChannel is not supported");this.remotePeerConnection[e].oniceconnectionstatechange=function(t){var i={state:n.remotePeerConnection[e].iceConnectionState,streamId:e};"failed"!=i.state&&"disconnected"!=i.state&&"closed"!=i.state||n.reconnectIfRequired(3e3),n.notifyEventListeners("ice_connection_state_changed",i),n.isPlayMode||n.playStreamId.includes(e)||"connected"==n.remotePeerConnection[e].iceConnectionState&&n.mediaManager.changeBandwidth(n.mediaManager.bandwidth,e).then((function(){M.debug("Bandwidth is changed to "+n.mediaManager.bandwidth)})).catch((function(e){return M.warn(e)}))}}return this.remotePeerConnection[e]}},{key:"closePeerConnection",value:function(e){var t=this.remotePeerConnection[e];if(null!=t){this.remotePeerConnection[e]=null,delete this.remotePeerConnection[e],null!=t.dataChannel&&t.dataChannel.close(),"closed"!=t.signalingState&&t.close();var n=this.playStreamId.indexOf(e);-1!=n&&this.playStreamId.splice(n,1)}null!=this.remotePeerConnectionStats[e]&&(clearInterval(this.remotePeerConnectionStats[e].timerId),delete this.remotePeerConnectionStats[e]),null!=this.soundMeters[e]&&delete this.soundMeters[e]}},{key:"signallingState",value:function(e){return null!=this.remotePeerConnection[e]?this.remotePeerConnection[e].signalingState:null}},{key:"iceConnectionState",value:function(e){return null!=this.remotePeerConnection[e]?this.remotePeerConnection[e].iceConnectionState:null}},{key:"gotDescription",value:function(e,t){var n=this;this.remotePeerConnection[t].setLocalDescription(e).then((function(i){M.debug("Set local description successfully for stream Id "+t);var r={command:"takeConfiguration",streamId:t,type:e.type,sdp:e.sdp};M.debug("setLocalDescription:"+e.sdp),n.webSocketAdaptor.send(JSON.stringify(r))})).catch((function(e){M.error("Cannot set local description. Error is: "+e)}))}},{key:"takeConfiguration",value:function(e,t,n,i){var r=this,a=e,o=n,s=t,c="offer"==o,u="publish";c&&(u="play"),this.idMapping[a]=i,this.initPeerConnection(a,u),M.debug("setRemoteDescription:"+s),this.remotePeerConnection[a].setRemoteDescription(new RTCSessionDescription({sdp:s,type:o})).then((function(e){r.debug&&(M.debug("set remote description is succesfull with response: "+e+" for stream : "+a+" and type: "+o),M.debug(s)),r.remoteDescriptionSet[a]=!0;var t=r.iceCandidateList[a].length;M.debug("Ice candidate list size to be added: "+t);for(var n=0;n<t;n++)r.addIceCandidate(a,r.iceCandidateList[a][n]);r.iceCandidateList[a]=[],c&&(M.debug("try to create answer for stream id: "+a),r.remotePeerConnection[a].createAnswer(r.sdp_constraints).then((function(e){M.debug("created answer for stream id: "+a),e.sdp=e.sdp.replace("useinbandfec=1","useinbandfec=1; stereo=1"),r.gotDescription(e,a)})).catch((function(e){M.error("create answer error :"+e)})))})).catch((function(e){r.debug&&M.error("set remote description is failed with error: "+e),(e.toString().indexOf("InvalidAccessError")>-1||e.toString().indexOf("setRemoteDescription")>-1)&&r.notifyErrorEventListeners("notSetRemoteDescription")}))}},{key:"takeCandidate",value:function(e,t,n){var i=e,r=n,a=new RTCIceCandidate({sdpMLineIndex:t,candidate:r});this.initPeerConnection(i,"peer"),M.debug("takeCandidate:"+r),1==this.remoteDescriptionSet[i]?this.addIceCandidate(i,a):(M.debug("Ice candidate is added to list because remote description is not set yet"),this.iceCandidateList[i].push(a))}},{key:"addIceCandidate",value:function(e,t){var n=this,i=!1;""==t.candidate?i=!0:void 0===t.protocol?this.candidateTypes.forEach((function(e){t.candidate.toLowerCase().includes(e)&&(i=!0)})):i=this.candidateTypes.includes(t.protocol.toLowerCase()),i?this.remotePeerConnection[e].addIceCandidate(t).then((function(t){n.debug&&M.debug("Candidate is added for stream "+e)})).catch((function(n){M.error("ice candiate cannot be added for stream id: "+e+" error is: "+n),M.error(t)})):this.debug&&M.debug("Candidate's protocol("+t.protocol+") is not supported.Candidate: "+t.candidate+" Supported protocols:"+this.candidateTypes)}},{key:"startPublishing",value:function(e){var t=this,n=e;this.initPeerConnection(n,"publish").createOffer(this.sdp_constraints).then((function(e){t.gotDescription(e,n)})).catch((function(e){M.error("create offer error for stream id: "+n+" error: "+e)}))}},{key:"toggleVideo",value:function(e,t,n){this.webSocketAdaptor.send(JSON.stringify({command:"toggleVideo",streamId:e,trackId:t,enabled:n}))}},{key:"toggleAudio",value:function(e,t,n){this.webSocketAdaptor.send(JSON.stringify({command:"toggleAudio",streamId:e,trackId:t,enabled:n}))}},{key:"getStats",value:function(e){var t=this;return M.debug("peerstatsgetstats = "+this.remotePeerConnectionStats[e]),new Promise((function(n,i){t.remotePeerConnection[e].getStats(null).then((function(i){var r=-1,a=-1,o=-1,s=-1,c=-1,u=-1,l=-1,d=-1,h=-1,f="",m=-1,p=-1,v=-1,g=-1,y=-1,b=-1,k=-1,S=-1,w=-1,C=-1,A=-1,T=-1,E=-1,P=-1,I=-1,M=1/0,L=[];i.forEach((function(e){if("inbound-rtp"==e.type&&void 0!==e.kind){var t={};t.trackIdentifier=e.trackIdentifier,r+=e.bytesReceived,"audio"==e.kind?(o=e.packetsLost,t.audioPacketsLost=e.packetsLost):"video"==e.kind&&(a=e.packetsLost,t.videoPacketsLost=e.packetsLost,t.framesDropped=e.framesDropped,t.framesDecoded=e.framesDecoded,t.framesPerSecond=e.framesPerSecond),t.bytesReceived=e.bytesReceived,t.jitterBufferDelay=e.jitterBufferDelay,t.lastPacketReceivedTimestamp=e.lastPacketReceivedTimestamp,s+=e.fractionLost,t.fractionLost=e.fractionLost,c=e.timestamp,t.currentTime=e.timestamp,void 0!==e.frameWidth&&(y=e.frameWidth,t.frameWidth=e.frameWidth),void 0!==e.frameHeight&&(b=e.frameHeight,t.frameHeight=e.frameHeight),void 0!==e.framesDecoded&&(A=e.framesDecoded,t.framesDecoded=e.framesDecoded),void 0!==e.framesDropped&&(T=e.framesDropped,t.framesDropped=e.framesDropped),void 0!==e.framesReceived&&(E=e.framesReceived,t.framesReceived=e.framesReceived),L.push(t)}else"outbound-rtp"==e.type?("audio"==e.kind?d=e.packetsSent:"video"==e.kind&&(l=e.packetsSent,y=e.frameWidth,b=e.frameHeight),u+=e.bytesSent,c=e.timestamp,f=e.qualityLimitationReason,null!=e.framesEncoded&&(m+=e.framesEncoded)):"track"==e.type&&void 0!==e.kind&&"audio"==e.kind?(void 0!==e.audioLevel&&(h=e.audioLevel),void 0!==e.jitterBufferDelay&&void 0!==e.jitterBufferEmittedCount&&(P=e.jitterBufferDelay/e.jitterBufferEmittedCount)):"track"==e.type&&void 0!==e.kind&&"video"==e.kind?(void 0!==e.frameWidth&&(y=e.frameWidth),void 0!==e.frameHeight&&(b=e.frameHeight),void 0!==e.framesDecoded&&(A=e.framesDecoded),void 0!==e.framesDropped&&(T=e.framesDropped),void 0!==e.framesReceived&&(E=e.framesReceived),void 0!==e.jitterBufferDelay&&void 0!==e.jitterBufferEmittedCount&&(I=e.jitterBufferDelay/e.jitterBufferEmittedCount)):"remote-inbound-rtp"==e.type&&void 0!==e.kind?(void 0!==e.packetsLost&&("video"==e.kind?a=e.packetsLost:"audio"==e.kind&&(o=e.packetsLost)),void 0!==e.roundTripTime&&("video"==e.kind?k=e.roundTripTime:"audio"==e.kind&&(w=e.roundTripTime)),void 0!==e.jitter&&("video"==e.kind?S=e.jitter:"audio"==e.kind&&(C=e.jitter))):"media-source"==e.type?"video"==e.kind&&(p=e.width,v=e.height,g=e.framesPerSecond):"candidate-pair"==e.type&&"succeeded"==e.state&&null!=e.availableOutgoingBitrate&&(M=e.availableOutgoingBitrate/1e3)})),void 0!==t.remotePeerConnectionStats[e]&&null!=t.remotePeerConnectionStats[e]||(t.remotePeerConnectionStats[e]=new R(e)),t.remotePeerConnectionStats[e].totalBytesReceived=r,t.remotePeerConnectionStats[e].videoPacketsLost=a,t.remotePeerConnectionStats[e].audioPacketsLost=o,t.remotePeerConnectionStats[e].fractionLost=s,t.remotePeerConnectionStats[e].currentTime=c,t.remotePeerConnectionStats[e].totalBytesSent=u,t.remotePeerConnectionStats[e].totalVideoPacketsSent=l,t.remotePeerConnectionStats[e].totalAudioPacketsSent=d,t.remotePeerConnectionStats[e].audioLevel=h,t.remotePeerConnectionStats[e].qualityLimitationReason=f,t.remotePeerConnectionStats[e].totalFramesEncoded=m,t.remotePeerConnectionStats[e].resWidth=p,t.remotePeerConnectionStats[e].resHeight=v,t.remotePeerConnectionStats[e].srcFps=g,t.remotePeerConnectionStats[e].frameWidth=y,t.remotePeerConnectionStats[e].frameHeight=b,t.remotePeerConnectionStats[e].videoRoundTripTime=k,t.remotePeerConnectionStats[e].videoJitter=S,t.remotePeerConnectionStats[e].audioRoundTripTime=w,t.remotePeerConnectionStats[e].audioJitter=C,t.remotePeerConnectionStats[e].framesDecoded=A,t.remotePeerConnectionStats[e].framesDropped=T,t.remotePeerConnectionStats[e].framesReceived=E,t.remotePeerConnectionStats[e].videoJitterAverageDelay=I,t.remotePeerConnectionStats[e].audioJitterAverageDelay=P,t.remotePeerConnectionStats[e].availableOutgoingBitrate=M,t.remotePeerConnectionStats[e].inboundRtpList=L,t.notifyEventListeners("updated_stats",t.remotePeerConnectionStats[e]),n(!0)})).catch((function(e){n(!1)}))}))}},{key:"enableStats",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;null==this.remotePeerConnectionStats[e]&&(this.remotePeerConnectionStats[e]=new R(e),this.remotePeerConnectionStats[e].timerId=setInterval((function(){t.getStats(e)}),n))}},{key:"disableStats",value:function(e){null==this.remotePeerConnectionStats[e]&&void 0===this.remotePeerConnectionStats[e]||(clearInterval(this.remotePeerConnectionStats[e].timerId),delete this.remotePeerConnectionStats[e])}},{key:"checkWebSocketConnection",value:function(){var e=this;(null==this.webSocketAdaptor||0==this.webSocketAdaptor.isConnected()&&0==this.webSocketAdaptor.isConnecting())&&(M.debug("websocket url : "+this.websocketURL),this.webSocketAdaptor=new I({websocket_url:this.websocketURL,webrtcadaptor:this,callback:function(t,n){"closed"==t&&e.reconnectIfRequired(),e.notifyEventListeners(t,n)},callbackError:function(t,n){e.notifyErrorEventListeners(t,n)},debug:this.debug}))}},{key:"closeWebSocket",value:function(){for(var e in this.remotePeerConnection)this.closePeerConnection(e);this.remotePeerConnection=new Array,this.webSocketAdaptor.close()}},{key:"peerMessage",value:function(e,t,n){this.webSocketAdaptor.send(JSON.stringify({command:"peerMessageCommand",streamId:e,definition:t,data:n}))}},{key:"forceStreamQuality",value:function(e,t){this.webSocketAdaptor.send(JSON.stringify({command:"forceStreamQuality",streamId:e,streamHeight:t}))}},{key:"sendData",value:function(e,t){if(void 0!==this.remotePeerConnection[e]){var n=this.remotePeerConnection[e].dataChannel;if(null==n||void 0===n)return void M.warn("dataChannel is null or undefined");if("open"!==n.readyState)return void M.warn("dataChannel.readyState is not open: "+n.readyState);var i=t.length||t.size||t.byteLength,r=0;if("string"==typeof t||t instanceof String)n.send(t);else{var a=Math.floor(999999*Math.random()),o=new Int32Array(2);for(o[0]=a,o[1]=i,n.send(o),r=0;r<i;){var s=Math.min(i-r,16e3),c=new Uint8Array(s+4),u=new Int32Array(1);u[0]=a,c.set(new Uint8Array(u.buffer,0,4),0);var l=t.slice(r,r+s);c.set(new Uint8Array(l),4),r+=s,n.send(c)}}}else M.warn("Send data is called for undefined peer connection with stream id: "+e)}},{key:"enableAudioLevel",value:function(e,t){var n=new g(this.mediaManager.audioContext);n.connectToSource(e,(function(){}),(function(e){e?alert(e):M.debug("Added sound meter for stream: "+t+" = "+n.instant.toFixed(2))})),this.soundMeters[t]=n}},{key:"getSoundLevelList",value:function(e){for(var t=0;t<e.length;t++)this.soundLevelList[e[t]]=this.soundMeters[e[t]].instant.toFixed(2);this.notifyEventListeners("gotSoundList",this.soundLevelList)}},{key:"getSender",value:function(e,t){var n=null;return null!=this.remotePeerConnection[e]&&(n=this.remotePeerConnection[e].getSenders().find((function(e){return e.track.kind==t}))),n}},{key:"assignVideoTrack",value:function(e,t,n){this.webSocketAdaptor.send(JSON.stringify({command:"assignVideoTrackCommand",streamId:t,videoTrackId:e,enabled:n}))}},{key:"updateVideoTrackAssignments",value:function(e,t,n){this.webSocketAdaptor.send(JSON.stringify({streamId:e,command:"updateVideoTrackAssignmentsCommand",offset:t,size:n}))}},{key:"setMaxVideoTrackCount",value:function(e,t){this.webSocketAdaptor.send(JSON.stringify({streamId:e,command:"setMaxVideoTrackCountCommand",maxTrackCount:t}))}},{key:"updateAudioLevel",value:function(e,t){this.sendData(e,JSON.stringify({streamId:e,eventType:"UPDATE_AUDIO_LEVEL",audioLevel:t}))}},{key:"getDebugInfo",value:function(e){this.webSocketAdaptor.send(JSON.stringify({streamId:e,command:"getDebugInfo"}))}},{key:"registerPushNotificationToken",value:function(e,t,n,i){this.webSocketAdaptor.send(JSON.stringify({command:"registerPushNotificationToken",subscriberId:e,token:t,pnsRegistrationToken:n,pnsType:i}))}},{key:"sendPushNotification",value:function(e,t,n,i){if("object"!=typeof n)throw M.error("Push Notification Content is not JSON format"),new Error("Push Notification Content is not JSON format");if(!Array.isArray(i))throw M.error("subscriberIdsToNotify is not an array. Please put the subscriber ids to notify in an array such as [user1], [user1, user2]"),new Error("subscriberIdsToNotify is not an array. Please put the subscriber ids to notify in an array such as [user1], [user1, user2]");this.webSocketAdaptor.send(JSON.stringify({command:"sendPushNotification",subscriberId:e,token:t,pushNotificationContent:n,subscriberIdsToNotify:i}))}},{key:"sendPushNotificationToTopic",value:function(e,t,n,i){if("object"!=typeof n)throw M.error("Push Notification Content is not JSON format"),new Error("Push Notification Content is not JSON format");this.webSocketAdaptor.send(JSON.stringify({command:"sendPushNotification",subscriberId:e,token:t,pushNotificationContent:n,topic:i}))}},{key:"turnOffLocalCamera",value:function(e){return this.mediaManager.turnOffLocalCamera(e)}},{key:"turnOnLocalCamera",value:function(e){return this.mediaManager.turnOnLocalCamera(e)}},{key:"muteLocalMic",value:function(){this.mediaManager.muteLocalMic()}},{key:"unmuteLocalMic",value:function(){this.mediaManager.unmuteLocalMic()}},{key:"switchDesktopCapture",value:function(e){return this.mediaManager.switchDesktopCapture(e)}},{key:"switchVideoCameraCapture",value:function(e,t,n){return this.mediaManager.switchVideoCameraCapture(e,t,n)}},{key:"updateVideoTrack",value:function(e,t,n,i){return this.mediaManager.updateVideoTrack(e,t,n,i)}},{key:"updateAudioTrack",value:function(e,t,n){return this.mediaManager.updateAudioTrack(e,t,n)}},{key:"switchVideoCameraFacingMode",value:function(e,t){return this.mediaManager.switchVideoCameraFacingMode(e,t)}},{key:"switchDesktopCaptureWithCamera",value:function(e){return this.mediaManager.switchDesktopCaptureWithCamera(e)}},{key:"switchAudioInputSource",value:function(e,t){return this.mediaManager.switchAudioInputSource(e,t)}},{key:"setVolumeLevel",value:function(e){this.mediaManager.setVolumeLevel(e)}},{key:"enableAudioLevelForLocalStream",value:function(e,t){return this.mediaManager.enableAudioLevelForLocalStream(e)}},{key:"disableAudioLevelForLocalStream",value:function(){this.mediaManager.disableAudioLevelForLocalStream()}},{key:"applyConstraints",value:function(e){return this.mediaManager.applyConstraints(e)}},{key:"changeBandwidth",value:function(e,t){this.mediaManager.changeBandwidth(e,t)}},{key:"enableAudioLevelWhenMuted",value:function(){return this.mediaManager.enableAudioLevelWhenMuted()}},{key:"disableAudioLevelWhenMuted",value:function(){this.mediaManager.disableAudioLevelWhenMuted()}},{key:"getVideoSender",value:function(e){return this.mediaManager.getVideoSender(e)}},{key:"openStream",value:function(e,t){return this.mediaManager.openStream(e,t)}},{key:"closeStream",value:function(){return this.mediaManager.closeStream()}}]),e}();C(O,"pluginInitMethods",new Array);var x="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n?n:"undefined"!=typeof self?self:{};(function(){var e;function t(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}var n="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e},i=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof x&&x];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);function r(e,t){if(t)e:{var r=i;e=e.split(".");for(var a=0;a<e.length-1;a++){var o=e[a];if(!(o in r))break e;r=r[o]}(t=t(a=r[e=e[e.length-1]]))!=a&&null!=t&&n(r,e,{configurable:!0,writable:!0,value:t})}}function a(e){return(e={next:e})[Symbol.iterator]=function(){return this},e}function o(e){var n="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];return n?n.call(e):{next:t(e)}}function s(e){if(!(e instanceof Array)){e=o(e);for(var t,n=[];!(t=e.next()).done;)n.push(t.value);e=n}return e}r("Symbol",(function(e){function t(e,t){this.h=e,n(this,"description",{configurable:!0,writable:!0,value:t})}if(e)return e;t.prototype.toString=function(){return this.h};var i="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",r=0;return function e(n){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new t(i+(n||"")+"_"+r++,n)}})),r("Symbol.iterator",(function(e){if(e)return e;e=Symbol("Symbol.iterator");for(var r="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),o=0;o<r.length;o++){var s=i[r[o]];"function"==typeof s&&"function"!=typeof s.prototype[e]&&n(s.prototype,e,{configurable:!0,writable:!0,value:function(){return a(t(this))}})}return e}));var c="function"==typeof Object.assign?Object.assign:function(e,t){for(var n=1;n<arguments.length;n++){var i=arguments[n];if(i)for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e};r("Object.assign",(function(e){return e||c}));var l,d="function"==typeof Object.create?Object.create:function(e){function t(){}return t.prototype=e,new t};if("function"==typeof Object.setPrototypeOf)l=Object.setPrototypeOf;else{var h;e:{var f={};try{f.__proto__={a:!0},h=f.a;break e}catch(gn){}h=!1}l=h?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null}var m=l;function p(e,t){if(e.prototype=d(t.prototype),e.prototype.constructor=e,m)m(e,t);else for(var n in t)if("prototype"!=n)if(Object.defineProperties){var i=Object.getOwnPropertyDescriptor(t,n);i&&Object.defineProperty(e,n,i)}else e[n]=t[n];e.za=t.prototype}function v(){this.m=!1,this.j=null,this.i=void 0,this.h=1,this.v=this.s=0,this.l=null}function g(e){if(e.m)throw new TypeError("Generator is already running");e.m=!0}function y(e,t){e.l={ma:t,na:!0},e.h=e.s||e.v}function b(e,t,n){return e.h=n,{value:t}}function k(e){this.h=new v,this.i=e}function S(e,t,n,i){try{var r=t.call(e.h.j,n);if(!(r instanceof Object))throw new TypeError("Iterator result "+r+" is not an object");if(!r.done)return e.h.m=!1,r;var a=r.value}catch(o){return e.h.j=null,y(e.h,o),w(e)}return e.h.j=null,i.call(e.h,a),w(e)}function w(e){for(;e.h.h;)try{var t=e.i(e.h);if(t)return e.h.m=!1,{value:t.value,done:!1}}catch(n){e.h.i=void 0,y(e.h,n)}if(e.h.m=!1,e.h.l){if(t=e.h.l,e.h.l=null,t.na)throw t.ma;return{value:t.return,done:!0}}return{value:void 0,done:!0}}function C(e){this.next=function(t){return g(e.h),e.h.j?t=S(e,e.h.j.next,t,e.h.u):(e.h.u(t),t=w(e)),t},this.throw=function(t){return g(e.h),e.h.j?t=S(e,e.h.j.throw,t,e.h.u):(y(e.h,t),t=w(e)),t},this.return=function(t){return function(e,t){g(e.h);var n=e.h.j;return n?S(e,"return"in n?n.return:function(e){return{value:e,done:!0}},t,e.h.return):(e.h.return(t),w(e))}(e,t)},this[Symbol.iterator]=function(){return this}}function A(e){return function(e){function t(t){return e.next(t)}function n(t){return e.throw(t)}return new Promise((function(i,r){!function e(a){a.done?i(a.value):Promise.resolve(a.value).then(t,n).then(e,r)}(e.next())}))}(new C(new k(e)))}function T(e){return e||Array.prototype.fill}v.prototype.u=function(e){this.i=e},v.prototype.return=function(e){this.l={return:e},this.h=this.v},r("Promise",(function(e){function t(e){this.i=0,this.j=void 0,this.h=[],this.u=!1;var t=this.l();try{e(t.resolve,t.reject)}catch(n){t.reject(n)}}function n(){this.h=null}function r(e){return e instanceof t?e:new t((function(t){t(e)}))}if(e)return e;n.prototype.i=function(e){if(null==this.h){this.h=[];var t=this;this.j((function(){t.m()}))}this.h.push(e)};var a=i.setTimeout;n.prototype.j=function(e){a(e,0)},n.prototype.m=function(){for(;this.h&&this.h.length;){var e=this.h;this.h=[];for(var t=0;t<e.length;++t){var n=e[t];e[t]=null;try{n()}catch(i){this.l(i)}}}this.h=null},n.prototype.l=function(e){this.j((function(){throw e}))},t.prototype.l=function(){function e(e){return function(i){n||(n=!0,e.call(t,i))}}var t=this,n=!1;return{resolve:e(this.I),reject:e(this.m)}},t.prototype.I=function(e){if(e===this)this.m(new TypeError("A Promise cannot resolve to itself"));else if(e instanceof t)this.L(e);else{e:switch(typeof e){case"object":var n=null!=e;break e;case"function":n=!0;break e;default:n=!1}n?this.F(e):this.s(e)}},t.prototype.F=function(e){var t=void 0;try{t=e.then}catch(n){return void this.m(n)}"function"==typeof t?this.M(t,e):this.s(e)},t.prototype.m=function(e){this.v(2,e)},t.prototype.s=function(e){this.v(1,e)},t.prototype.v=function(e,t){if(0!=this.i)throw Error("Cannot settle("+e+", "+t+"): Promise already settled in state"+this.i);this.i=e,this.j=t,2===this.i&&this.K(),this.H()},t.prototype.K=function(){var e=this;a((function(){if(e.D()){var t=i.console;void 0!==t&&t.error(e.j)}}),1)},t.prototype.D=function(){if(this.u)return!1;var e=i.CustomEvent,t=i.Event,n=i.dispatchEvent;return void 0===n||("function"==typeof e?e=new e("unhandledrejection",{cancelable:!0}):"function"==typeof t?e=new t("unhandledrejection",{cancelable:!0}):(e=i.document.createEvent("CustomEvent")).initCustomEvent("unhandledrejection",!1,!0,e),e.promise=this,e.reason=this.j,n(e))},t.prototype.H=function(){if(null!=this.h){for(var e=0;e<this.h.length;++e)s.i(this.h[e]);this.h=null}};var s=new n;return t.prototype.L=function(e){var t=this.l();e.T(t.resolve,t.reject)},t.prototype.M=function(e,t){var n=this.l();try{e.call(t,n.resolve,n.reject)}catch(i){n.reject(i)}},t.prototype.then=function(e,n){function i(e,t){return"function"==typeof e?function(t){try{r(e(t))}catch(n){a(n)}}:t}var r,a,o=new t((function(e,t){r=e,a=t}));return this.T(i(e,r),i(n,a)),o},t.prototype.catch=function(e){return this.then(void 0,e)},t.prototype.T=function(e,t){function n(){switch(i.i){case 1:e(i.j);break;case 2:t(i.j);break;default:throw Error("Unexpected state: "+i.i)}}var i=this;null==this.h?s.i(n):this.h.push(n),this.u=!0},t.resolve=r,t.reject=function(e){return new t((function(t,n){n(e)}))},t.race=function(e){return new t((function(t,n){for(var i=o(e),a=i.next();!a.done;a=i.next())r(a.value).T(t,n)}))},t.all=function(e){var n=o(e),i=n.next();return i.done?r([]):new t((function(e,t){function a(t){return function(n){o[t]=n,0==--s&&e(o)}}var o=[],s=0;do{o.push(void 0),s++,r(i.value).T(a(o.length-1),t),i=n.next()}while(!i.done)}))},t})),r("Array.prototype.keys",(function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,i=!1,r={next:function(){return!i&&n<e.length?{value:n++,done:!1}:(i=!0,{done:!0,value:void 0})}};return r[Symbol.iterator]=function(){return r},r}(this)}})),r("Array.prototype.fill",(function(e){return e||function(e,t,n){var i=this.length||0;for(0>t&&(t=Math.max(0,i+t)),(null==n||n>i)&&(n=i),0>(n=Number(n))&&(n=Math.max(0,i+n)),t=Number(t||0);t<n;t++)this[t]=e;return this}})),r("Int8Array.prototype.fill",T),r("Uint8Array.prototype.fill",T),r("Uint8ClampedArray.prototype.fill",T),r("Int16Array.prototype.fill",T),r("Uint16Array.prototype.fill",T),r("Int32Array.prototype.fill",T),r("Uint32Array.prototype.fill",T),r("Float32Array.prototype.fill",T),r("Float64Array.prototype.fill",T),r("Object.is",(function(e){return e||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}})),r("Array.prototype.includes",(function(e){return e||function(e,t){var n=this;n instanceof String&&(n=String(n));var i=n.length;for(0>(t=t||0)&&(t=Math.max(t+i,0));t<i;t++){var r=n[t];if(r===e||Object.is(r,e))return!0}return!1}})),r("String.prototype.includes",(function(e){return e||function(e,t){if(null==this)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(e instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return-1!==this.indexOf(e,t||0)}}));var E=this||self;function R(e,t){e=e.split(".");var n,i=E;e[0]in i||void 0===i.execScript||i.execScript("var "+e[0]);for(;e.length&&(n=e.shift());)e.length||void 0===t?i=i[n]&&i[n]!==Object.prototype[n]?i[n]:i[n]={}:i[n]=t}function P(e){var t;return(t=E.navigator)&&(t=t.userAgent)||(t=""),-1!=t.indexOf(e)}var I=Array.prototype.map?function(e,t){return Array.prototype.map.call(e,t,void 0)}:function(e,t){for(var n=e.length,i=Array(n),r="string"==typeof e?e.split(""):e,a=0;a<n;a++)a in r&&(i[a]=t.call(void 0,r[a],a,e));return i},M={},L=null;function O(){if(!L){L={};for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),t=["+/=","+/","-_=","-_.","-_"],n=0;5>n;n++){var i=e.concat(t[n].split(""));M[n]=i;for(var r=0;r<i.length;r++){var a=i[r];void 0===L[a]&&(L[a]=r)}}}}var j="undefined"!=typeof Uint8Array,D=!(P("Trident")||P("MSIE"))&&"function"==typeof E.btoa;function N(e){if(!D){var t;void 0===t&&(t=0),O(),t=M[t];for(var n=Array(Math.floor(e.length/3)),i=t[64]||"",r=0,a=0;r<e.length-2;r+=3){var o=e[r],s=e[r+1],c=e[r+2],u=t[o>>2];n[a++]=u+(o=t[(3&o)<<4|s>>4])+(s=t[(15&s)<<2|c>>6])+(c=t[63&c])}switch(u=0,c=i,e.length-r){case 2:c=t[(15&(u=e[r+1]))<<2]||i;case 1:n[a]=t[(e=e[r])>>2]+t[(3&e)<<4|u>>4]+c+i}return n.join("")}for(t="";10240<e.length;)t+=String.fromCharCode.apply(null,e.subarray(0,10240)),e=e.subarray(10240);return t+=String.fromCharCode.apply(null,e),btoa(t)}var _,F=RegExp("[-_.]","g");function B(e){switch(e){case"-":return"+";case"_":return"/";case".":return"=";default:return""}}function V(e){if(!D)return function(e){var t=e.length,n=3*t/4;n%3?n=Math.floor(n):-1!="=.".indexOf(e[t-1])&&(n=-1!="=.".indexOf(e[t-2])?n-2:n-1);var i=new Uint8Array(n),r=0;return function(e,t){function n(t){for(;i<e.length;){var n=e.charAt(i++),r=L[n];if(null!=r)return r;if(!/^[\s\xa0]*$/.test(n))throw Error("Unknown base64 encoding at char: "+n)}return t}O();for(var i=0;;){var r=n(-1),a=n(0),o=n(64),s=n(64);if(64===s&&-1===r)break;t(r<<2|a>>4),64!=o&&(t(a<<4&240|o>>2),64!=s&&t(o<<6&192|s))}}(e,(function(e){i[r++]=e})),r!==n?i.subarray(0,r):i}(e);F.test(e)&&(e=e.replace(F,B)),e=atob(e);for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}function U(){return _||(_=new Uint8Array(0))}var W={},G="function"==typeof Uint8Array.prototype.slice,J=0,H=0;function z(e){var t=0>e,n=(e=Math.abs(e))>>>0;e=Math.floor((e-n)/4294967296),t&&(t=(n=o(q(n,e))).next().value,e=n.next().value,n=t),J=n>>>0,H=e>>>0}var K,X="function"==typeof BigInt;function q(e,t){return t=~t,e?e=1+~e:t+=1,[e,t]}function Y(e,t){this.i=e>>>0,this.h=t>>>0}function Q(e){if(!e)return K||(K=new Y(0,0));if(!/^-?\d+$/.test(e))return null;if(16>e.length)z(Number(e));else if(X)e=BigInt(e),J=Number(e&BigInt(4294967295))>>>0,H=Number(e>>BigInt(32)&BigInt(4294967295));else{var t=+("-"===e[0]);H=J=0;for(var n=e.length,i=t,r=(n-t)%6+t;r<=n;i=r,r+=6)i=Number(e.slice(i,r)),H*=1e6,4294967296<=(J=1e6*J+i)&&(H+=J/4294967296|0,J%=4294967296);t&&(e=(t=o(q(J,H))).next().value,t=t.next().value,J=e,H=t)}return new Y(J,H)}function $(e,t){return Error("Invalid wire type: "+e+" (at position "+t+")")}function Z(){return Error("Failed to read varint, encoding is invalid.")}function ee(e,t){return Error("Tried to read past the end of the data "+t+" > "+e)}function te(){throw Error("Invalid UTF8")}function ne(e,t){return t=String.fromCharCode.apply(null,t),null==e?t:e+t}var ie,re,ae,oe=void 0,se="undefined"!=typeof TextDecoder,ce="undefined"!=typeof TextEncoder;function ue(e){if(e!==W)throw Error("illegal external caller")}function le(e,t){if(ue(t),this.V=e,null!=e&&0===e.length)throw Error("ByteString should be constructed with non-empty values")}function de(){return ae||(ae=new le(null,W))}function he(e){ue(W);var t=e.V;return null==(t=null==t||j&&null!=t&&t instanceof Uint8Array?t:"string"==typeof t?V(t):null)?t:e.V=t}function fe(e,t){this.i=null,this.m=!1,this.h=this.j=this.l=0,me(this,e,t)}function me(e,t,n){e.S=void 0!==(n=void 0===n?{}:n).S&&n.S,t&&(t=function(e){if("string"==typeof e)return{buffer:V(e),C:!1};if(Array.isArray(e))return{buffer:new Uint8Array(e),C:!1};if(e.constructor===Uint8Array)return{buffer:e,C:!1};if(e.constructor===ArrayBuffer)return{buffer:new Uint8Array(e),C:!1};if(e.constructor===le)return{buffer:he(e)||U(),C:!0};if(e instanceof Uint8Array)return{buffer:new Uint8Array(e.buffer,e.byteOffset,e.byteLength),C:!1};throw Error("Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, a ByteString or an Array of numbers")}(t),e.i=t.buffer,e.m=t.C,e.l=0,e.j=e.i.length,e.h=e.l)}function pe(e,t){if(e.h=t,t>e.j)throw ee(e.j,t)}function ve(e){var t=e.i,n=e.h,i=t[n++],r=127&i;if(128&i&&(r|=(127&(i=t[n++]))<<7,128&i&&(r|=(127&(i=t[n++]))<<14,128&i&&(r|=(127&(i=t[n++]))<<21,128&i&&(r|=(i=t[n++])<<28,128&i&&128&t[n++]&&128&t[n++]&&128&t[n++]&&128&t[n++]&&128&t[n++])))))throw Z();return pe(e,n),r}function ge(e,t){if(0>t)throw Error("Tried to read a negative byte length: "+t);var n=e.h,i=n+t;if(i>e.j)throw ee(t,e.j-n);return e.h=i,n}fe.prototype.reset=function(){this.h=this.l};var ye=[];function be(){this.h=[]}function ke(e,t,n){for(;0<n||127<t;)e.h.push(127&t|128),t=(t>>>7|n<<25)>>>0,n>>>=7;e.h.push(t)}function Se(e,t){for(;127<t;)e.h.push(127&t|128),t>>>=7;e.h.push(t)}function we(e,t){if(ye.length){var n=ye.pop();me(n,e,t),e=n}else e=new fe(e,t);this.h=e,this.j=this.h.h,this.i=this.l=-1,this.setOptions(t)}function Ce(e){var t=e.h;if(t.h==t.j)return!1;e.j=e.h.h;var n=ve(e.h)>>>0;if(t=n>>>3,!(0<=(n&=7)&&5>=n))throw $(n,e.j);if(1>t)throw Error("Invalid field number: "+t+" (at position "+e.j+")");return e.l=t,e.i=n,!0}function Ae(e){switch(e.i){case 0:if(0!=e.i)Ae(e);else e:{for(var t=(e=e.h).h,n=t+10,i=e.i;t<n;)if(0==(128&i[t++])){pe(e,t);break e}throw Z()}break;case 1:pe(e=e.h,e.h+8);break;case 2:2!=e.i?Ae(e):(t=ve(e.h)>>>0,pe(e=e.h,e.h+t));break;case 5:pe(e=e.h,e.h+4);break;case 3:for(t=e.l;;){if(!Ce(e))throw Error("Unmatched start-group tag: stream EOF");if(4==e.i){if(e.l!=t)throw Error("Unmatched end-group tag");break}Ae(e)}break;default:throw $(e.i,e.j)}}be.prototype.length=function(){return this.h.length},be.prototype.end=function(){var e=this.h;return this.h=[],e},we.prototype.setOptions=function(e){this.ca=void 0!==(e=void 0===e?{}:e).ca&&e.ca},we.prototype.reset=function(){this.h.reset(),this.j=this.h.h,this.i=this.l=-1};var Te=[];function Ee(){this.j=[],this.i=0,this.h=new be}function Re(e,t){0!==t.length&&(e.j.push(t),e.i+=t.length)}var Pe="function"==typeof Symbol&&"symbol"==typeof Symbol()?Symbol():void 0;function Ie(e,t){return Pe?e[Pe]|=t:void 0!==e.A?e.A|=t:(Object.defineProperties(e,{A:{value:t,configurable:!0,writable:!0,enumerable:!1}}),t)}function Me(e,t){Pe?e[Pe]&&(e[Pe]&=~t):void 0!==e.A&&(e.A&=~t)}function Le(e){var t;return null==(t=Pe?e[Pe]:e.A)?0:t}function Oe(e,t){Pe?e[Pe]=t:void 0!==e.A?e.A=t:Object.defineProperties(e,{A:{value:t,configurable:!0,writable:!0,enumerable:!1}})}function xe(e){return Ie(e,1),e}function je(e,t){Oe(t,-51&(0|e))}function De(e,t){Oe(t,-41&(18|e))}var Ne={};function _e(e){return null!==e&&"object"==typeof e&&!Array.isArray(e)&&e.constructor===Object}var Fe,Be,Ve=[];function Ue(e){if(2&Le(e.o))throw Error("Cannot mutate an immutable Message")}function We(e){var t=e.length;(t=t?e[t-1]:void 0)&&_e(t)?t.g=1:e.push(((t={}).g=1,t))}function Ge(e){return e.B||(e.B=e.o[e.i+e.G]={})}function Je(e,t){return-1===t?null:t>=e.i?e.B?e.B[t]:void 0:e.o[t+e.G]}function He(e,t,n,i){Ue(e),ze(e,t,n,i)}function ze(e,t,n,i){e.j&&(e.j=void 0),t>=e.i||i?Ge(e)[t]=n:(e.o[t+e.G]=n,(e=e.B)&&t in e&&delete e[t])}function Ke(e,t,n,i){var r=Je(e,t);Array.isArray(r)||(r=Fe);var a=Le(r);if(1&a||xe(r),i)2&a||Ie(r,2),1&n||Object.freeze(r);else{i=!(2&n);var o=2&a;1&n||!o?i&&16&a&&!o&&Me(r,16):ze(e,t,r=xe(Array.prototype.slice.call(r)))}return r}function Xe(e,t){var n=Je(e,t),i=null==n?n:"number"==typeof n||"NaN"===n||"Infinity"===n||"-Infinity"===n?Number(n):void 0;return null!=i&&i!==n&&ze(e,t,i),i}function qe(e,t,n,i,r){e.h||(e.h={});var a=e.h[n],o=Ke(e,n,3,r);if(!a){var s=o;a=[];var c=!!(16&Le(e.o));o=!!(2&Le(s));var u=s;!r&&o&&(s=Array.prototype.slice.call(s));for(var l=o,d=0;d<s.length;d++){var h=s[d],f=t,m=!1;if(m=void 0!==m&&m,void 0!==(h=Array.isArray(h)?new f(h):m?new f:void 0)){var p=m=Le(f=h.o);o&&(p|=2),c&&(p|=16),p!=m&&Oe(f,p),f=p,l=l||!!(2&f),a.push(h)}}return e.h[n]=a,t=33|(c=Le(s)),c!=(t=l?-9&t:8|t)&&(l=s,Object.isFrozen(l)&&(l=Array.prototype.slice.call(l)),Oe(l,t),s=l),u!==s&&ze(e,n,s),(r||i&&o)&&Ie(a,2),i&&Object.freeze(a),a}return r||(r=Object.isFrozen(a),i&&!r?Object.freeze(a):!i&&r&&(a=Array.prototype.slice.call(a),e.h[n]=a)),a}function Ye(e,t,n){var i=!!(2&Le(e.o));if(t=qe(e,t,n,i,i),e=Ke(e,n,3,i),!(i||8&Le(e))){for(i=0;i<t.length;i++){if(2&Le((n=t[i]).o)){var r=ct(n,!1);r.j=n}else r=n;n!==r&&(t[i]=r,e[i]=r.o)}Ie(e,8)}return t}function Qe(e,t,n){if(null!=n&&"number"!=typeof n)throw Error("Value of float/double field must be a number|null|undefined, found "+typeof n+": "+n);He(e,t,n)}function $e(e,t,n,i,r){Ue(e);var a=qe(e,n,t,!1,!1);return n=null!=i?i:new n,e=Ke(e,t,2,!1),null!=r?(a.splice(r,0,n),e.splice(r,0,n.o)):(a.push(n),e.push(n.o)),n.C()&&Me(e,8),n}function Ze(e,t){return null==e?t:e}function et(e,t,n){return n=void 0===n?0:n,Ze(Xe(e,t),n)}function tt(e,t,n,i){if(null!=e){if(Array.isArray(e))e=nt(e,t,n,void 0!==i);else if(_e(e)){var r,a={};for(r in e)a[r]=tt(e[r],t,n,i);e=a}else e=t(e,i);return e}}function nt(e,t,n,i){var r=Le(e);i=i?!!(16&r):void 0,e=Array.prototype.slice.call(e);for(var a=0;a<e.length;a++)e[a]=tt(e[a],t,n,i);return n(r,e),e}function it(e){return e.ja===Ne?e.toJSON():function(e){switch(typeof e){case"number":return isFinite(e)?e:String(e);case"object":if(e)if(Array.isArray(e)){if(0!=(128&Le(e)))return We(e=Array.prototype.slice.call(e)),e}else{if(j&&null!=e&&e instanceof Uint8Array)return N(e);if(e instanceof le){var t=e.V;return null==t?"":"string"==typeof t?t:e.V=N(t)}}}return e}(e)}function rt(e,t){128&e&&We(t)}function at(e,t,n){if(n=void 0===n?De:n,null!=e){if(j&&e instanceof Uint8Array)return e.length?new le(new Uint8Array(e),W):de();if(Array.isArray(e)){var i=Le(e);return 2&i?e:!t||32&i||!(16&i||0===i)?(4&(t=Le(e=nt(e,at,4&i?De:n,!0)))&&2&t&&Object.freeze(e),e):(Oe(e,2|i),e)}return e.ja===Ne?st(e):e}}function ot(e,t,n,i,r,a,o){if(e=e.h&&e.h[n]){if(2&(i=Le(e))?i=e:(De(i,a=I(e,st)),Object.freeze(a),i=a),Ue(t),o=null==i?Fe:xe([]),null!=i){for(a=!!i.length,e=0;e<i.length;e++){var s=i[e];a=a&&!(2&Le(s.o)),o[e]=s.o}a=1|(a?8:0),((e=Le(o))&a)!==a&&(Object.isFrozen(o)&&(o=Array.prototype.slice.call(o)),Oe(o,e|a)),t.h||(t.h={}),t.h[n]=i}else t.h&&(t.h[n]=void 0);ze(t,n,o,r)}else He(t,n,at(i,a,o),r)}function st(e){return 2&Le(e.o)||Ie((e=ct(e,!0)).o,2),e}function ct(e,t){var n=e.o,i=[];Ie(i,16);var r=e.constructor.h;if(r&&i.push(r),r=e.B){i.length=n.length,i.fill(void 0,i.length,n.length);var a={};i[i.length-1]=a}0!=(128&Le(n))&&We(i),t=t||e.C()?De:je,Be=i,i=new(a=e.constructor)(i),Be=void 0,e.R&&(i.R=e.R.slice()),a=!!(16&Le(n));for(var o=r?n.length-1:n.length,s=0;s<o;s++)ot(e,i,s-e.G,n[s],!1,a,t);if(r)for(var c in r)ot(e,i,+c,r[c],!0,a,t);return i}function ut(e,t,n){null==e&&(e=Be),Be=void 0;var i,r=this.constructor.i||0,a=0<r,o=this.constructor.h,s=!1;if(null==e){var c=48,u=!0;a&&(r=0,c|=128),Oe(e=o?[o]:[],c)}else{if(!Array.isArray(e))throw Error();if(o&&o!==e[0])throw Error();var l=c=Ie(e,0);if((u=0!=(16&l))&&((s=0!=(32&l))||(l|=32)),a){if(128&l)r=0;else if(0<e.length){var d=e[e.length-1];if(_e(d)&&"g"in d){r=0,l|=128,delete d.g;var h,f=!0;for(h in d){f=!1;break}f&&e.pop()}}}else if(128&l)throw Error();c!==l&&Oe(e,l)}if(this.G=(o?0:-1)-r,this.h=void 0,this.o=e,r=(o=this.o.length)-1,o&&_e(o=this.o[r])?(this.B=o,this.i=r-this.G):void 0!==t&&-1<t?(this.i=Math.max(t,r+1-this.G),this.B=void 0):this.i=Number.MAX_VALUE,!a&&this.B&&"g"in this.B)throw Error('Unexpected "g" flag in sparse object of message that is not a group type.');if(n)for(t=u&&!s&&!0,a=this.i,u=0;u<n.length;u++)(s=n[u])<a?(r=e[s+=this.G])?lt(r,t):e[s]=Fe:(i||(i=Ge(this)),(r=i[s])?lt(r,t):i[s]=Fe)}function lt(e,t){if(Array.isArray(e)){var n=Le(e),i=1;!t||2&n||(i|=16),(n&i)!==i&&Oe(e,n|i)}}function dt(e,t,n){if(n){var i,r={};for(i in n){var a=n[i],o=a.ra;o||(r.J=a.xa||a.oa.W,a.ia?(r.aa=bt(a.ia),o=function(e){return function(t,n,i){return e.J(t,n,i,e.aa)}}(r)):a.ka?(r.Z=kt(a.da.P,a.ka),o=function(e){return function(t,n,i){return e.J(t,n,i,e.Z)}}(r)):o=r.J,a.ra=o),o(t,e,a.da),r={J:r.J,aa:r.aa,Z:r.Z}}}!function(e,t){if(t=t.R){Re(e,e.h.end());for(var n=0;n<t.length;n++)Re(e,he(t[n])||U())}}(t,e)}Oe(Ve,23),Fe=Object.freeze(Ve),ut.prototype.toJSON=function(){return nt(this.o,it,rt)},ut.prototype.C=function(){return!!(2&Le(this.o))},ut.prototype.ja=Ne,ut.prototype.toString=function(){return this.o.toString()};var ht=Symbol();function ft(e,t,n){return e[ht]||(e[ht]=function(e,i){return t(e,i,n)})}function mt(e){var t=e[ht];if(!t){var n=Ot(e);e[ht]=t=function(e,t){return xt(e,t,n)}}return t}function pt(e){var t=function(e){var t=e.ia;return t?mt(t):(t=e.wa)?ft(e.da.P,t,e.ka):void 0}(e),n=e.da,i=e.oa.U;return t?function(e,r){return i(e,r,n,t)}:function(e,t){return i(e,t,n)}}function vt(e,t){var n=e[t];return"function"==typeof n&&0===n.length&&(n=n(),e[t]=n),Array.isArray(n)&&(Rt in n||St in n||0<n.length&&"function"==typeof n[0])?n:void 0}function gt(e,t,n,i,r,a){t.P=e[0];var o=1;if(e.length>o&&"number"!=typeof e[o]){var s=e[o++];n(t,s)}for(;o<e.length;){n=e[o++];for(var c=o+1;c<e.length&&"number"!=typeof e[c];)c++;switch(s=e[o++],c-=o){case 0:i(t,n,s);break;case 1:(c=vt(e,o))?(o++,r(t,n,s,c)):i(t,n,s,e[o++]);break;case 2:r(t,n,s,c=vt(e,c=o++),e[o++]);break;case 3:a(t,n,s,e[o++],e[o++],e[o++]);break;case 4:a(t,n,s,e[o++],e[o++],e[o++],e[o++]);break;default:throw Error("unexpected number of binary field arguments: "+c)}}return t}var yt=Symbol();function bt(e){var t=e[yt];if(!t){var n=Et(e);e[yt]=t=function(e,t){return jt(e,t,n)}}return t}function kt(e,t){var n=e[yt];return n||(e[yt]=n=function(e,n){return dt(e,n,t)}),n}var St=Symbol();function wt(e,t){e.push(t)}function Ct(e,t,n){e.push(t,n.W)}function At(e,t,n,i){var r=bt(i),a=Et(i).P,o=n.W;e.push(t,(function(e,t,n){return o(e,t,n,a,r)}))}function Tt(e,t,n,i,r,a){var o=kt(i,a),s=n.W;e.push(t,(function(e,t,n){return s(e,t,n,i,o)}))}function Et(e){var t=e[St];return t||(t=gt(e,e[St]=[],wt,Ct,At,Tt),Rt in e&&St in e&&(e.length=0),t)}var Rt=Symbol();function Pt(e,t){e[0]=t}function It(e,t,n,i){var r=n.U;e[t]=i?function(e,t,n){return r(e,t,n,i)}:r}function Mt(e,t,n,i,r){var a=n.U,o=mt(i),s=Ot(i).P;e[t]=function(e,t,n){return a(e,t,n,s,o,r)}}function Lt(e,t,n,i,r,a,o){var s=n.U,c=ft(i,r,a);e[t]=function(e,t,n){return s(e,t,n,i,c,o)}}function Ot(e){var t=e[Rt];return t||(t=gt(e,e[Rt]={},Pt,It,Mt,Lt),Rt in e&&St in e&&(e.length=0),t)}function xt(e,t,n){for(;Ce(t)&&4!=t.i;){var i=t.l,r=n[i];if(!r){var a=n[0];a&&(a=a[i])&&(r=n[i]=pt(a))}if(!r||!r(t,e,i)){i=e,a=(r=t).j,Ae(r);var o=r;if(!o.ca){if(r=o.h.h-a,o.h.h=a,o=o.h,0==r)r=de();else{if(a=ge(o,r),o.S&&o.m)r=o.i.subarray(a,a+r);else{o=o.i;var s=a;r=s===(r=a+r)?U():G?o.slice(s,r):new Uint8Array(o.subarray(s,r))}r=0==r.length?de():new le(r,W)}(a=i.R)?a.push(r):i.R=[r]}}}return e}function jt(e,t,n){for(var i=n.length,r=1==i%2,a=r?1:0;a<i;a+=2)(0,n[a+1])(t,e,n[a]);dt(e,t,r?n[0]:void 0)}function Dt(e,t){return{U:e,W:t}}var Nt=Dt((function(e,t,n){if(5!==e.i)return!1;var i=(e=e.h).i,r=e.h,a=i[r],o=i[r+1],s=i[r+2];return i=i[r+3],pe(e,e.h+4),e=2*((o=(a<<0|o<<8|s<<16|i<<24)>>>0)>>31)+1,a=o>>>23&255,o&=8388607,He(t,n,255==a?o?NaN:1/0*e:0==a?e*Math.pow(2,-149)*o:e*Math.pow(2,a-150)*(o+Math.pow(2,23))),!0}),(function(e,t,n){if(null!=(t=Xe(t,n))){Se(e.h,8*n+5),e=e.h;var i=+t;0===i?0<1/i?J=H=0:(H=0,J=2147483648):isNaN(i)?(H=0,J=2147483647):34028234663852886e22<(i=(n=0>i?-2147483648:0)?-i:i)?(H=0,J=(2139095040|n)>>>0):11754943508222875e-54>i?(i=Math.round(i/Math.pow(2,-149)),H=0,J=(n|i)>>>0):(t=Math.floor(Math.log(i)/Math.LN2),i*=Math.pow(2,-t),16777216<=(i=Math.round(8388608*i))&&++t,H=0,J=(n|t+127<<23|8388607&i)>>>0),e.h.push((n=J)>>>0&255),e.h.push(n>>>8&255),e.h.push(n>>>16&255),e.h.push(n>>>24&255)}})),_t=Dt((function(e,t,n){if(0!==e.i)return!1;var i=e.h,r=0,a=e=0,o=i.i,s=i.h;do{var c=o[s++];r|=(127&c)<<a,a+=7}while(32>a&&128&c);for(32<a&&(e|=(127&c)>>4),a=3;32>a&&128&c;a+=7)e|=(127&(c=o[s++]))<<a;if(pe(i,s),!(128>c))throw Z();return i=r>>>0,(e=2147483648&(c=e>>>0))&&(c=~c>>>0,0==(i=1+~i>>>0)&&(c=c+1>>>0)),i=4294967296*c+(i>>>0),He(t,n,e?-i:i),!0}),(function(e,t,n){null!=(t=Je(t,n))&&("string"==typeof t&&Q(t),null!=t&&(Se(e.h,8*n),"number"==typeof t?(e=e.h,z(t),ke(e,J,H)):(n=Q(t),ke(e.h,n.i,n.h))))})),Ft=Dt((function(e,t,n){return 0===e.i&&(He(t,n,ve(e.h)),!0)}),(function(e,t,n){if(null!=(t=Je(t,n))&&null!=t)if(Se(e.h,8*n),e=e.h,0<=(n=t))Se(e,n);else{for(t=0;9>t;t++)e.h.push(127&n|128),n>>=7;e.h.push(1)}})),Bt=Dt((function(e,t,n){if(2!==e.i)return!1;var i=ve(e.h)>>>0,r=ge(e=e.h,i);if(e=e.i,se){var a,o=e;(a=ie)||(a=ie=new TextDecoder("utf-8",{fatal:!0})),e=r+i,o=0===r&&e===o.length?o:o.subarray(r,e);try{var s=a.decode(o)}catch(d){if(void 0===oe){try{a.decode(new Uint8Array([128]))}catch(h){}try{a.decode(new Uint8Array([97])),oe=!0}catch(h){oe=!1}}throw!oe&&(ie=void 0),d}}else{i=(s=r)+i,r=[];for(var c,u,l=null;s<i;)128>(c=e[s++])?r.push(c):224>c?s>=i?te():(u=e[s++],194>c||128!=(192&u)?(s--,te()):r.push((31&c)<<6|63&u)):240>c?s>=i-1?te():128!=(192&(u=e[s++]))||224===c&&160>u||237===c&&160<=u||128!=(192&(o=e[s++]))?(s--,te()):r.push((15&c)<<12|(63&u)<<6|63&o):244>=c?s>=i-2?te():128!=(192&(u=e[s++]))||0!=u-144+(c<<28)>>30||128!=(192&(o=e[s++]))||128!=(192&(a=e[s++]))?(s--,te()):(c=(7&c)<<18|(63&u)<<12|(63&o)<<6|63&a,r.push(55296+((c-=65536)>>10&1023),56320+(1023&c))):te(),8192<=r.length&&(l=ne(l,r),r.length=0);s=ne(l,r)}return He(t,n,s),!0}),(function(e,t,n){if(null!=(t=Je(t,n))){var i=!1;if(i=void 0!==i&&i,ce){if(i&&/(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])/.test(t))throw Error("Found an unpaired surrogate");t=(re||(re=new TextEncoder)).encode(t)}else{for(var r=0,a=new Uint8Array(3*t.length),o=0;o<t.length;o++){var s=t.charCodeAt(o);if(128>s)a[r++]=s;else{if(2048>s)a[r++]=s>>6|192;else{if(55296<=s&&57343>=s){if(56319>=s&&o<t.length){var c=t.charCodeAt(++o);if(56320<=c&&57343>=c){a[r++]=(s=1024*(s-55296)+c-56320+65536)>>18|240,a[r++]=s>>12&63|128,a[r++]=s>>6&63|128,a[r++]=63&s|128;continue}o--}if(i)throw Error("Found an unpaired surrogate");s=65533}a[r++]=s>>12|224,a[r++]=s>>6&63|128}a[r++]=63&s|128}}t=r===a.length?a:a.subarray(0,r)}Se(e.h,8*n+2),Se(e.h,t.length),Re(e,e.h.end()),Re(e,t)}})),Vt=Dt((function(e,t,n,i,r){if(2!==e.i)return!1;t=$e(t,n,i),n=e.h.j,i=ve(e.h)>>>0;var a=e.h.h+i,o=a-n;if(0>=o&&(e.h.j=a,r(t,e,void 0,void 0,void 0),o=a-e.h.h),o)throw Error("Message parsing ended unexpectedly. Expected to read "+i+" bytes, instead read "+(i-o)+" bytes, either the data ended unexpectedly or the message misreported its own length");return e.h.h=a,e.h.j=n,!0}),(function(e,t,n,i,r){if(null!=(t=Ye(t,i,n)))for(i=0;i<t.length;i++){var a=e;Se(a.h,8*n+2);var o=a.h.end();Re(a,o),o.push(a.i),a=o,r(t[i],e),o=e;var s=a.pop();for(s=o.i+o.h.length()-s;127<s;)a.push(127&s|128),s>>>=7,o.i++;a.push(s),o.i++}}));function Ut(e){return function(t,n){e:{if(Te.length){var i=Te.pop();i.setOptions(n),me(i.h,t,n),t=i}else t=new we(t,n);try{var r=Ot(e),a=xt(new r.P,t,r);break e}finally{(r=t.h).i=null,r.m=!1,r.l=0,r.j=0,r.h=0,r.S=!1,t.l=-1,t.i=-1,100>Te.length&&Te.push(t)}a=void 0}return a}}function Wt(e){return function(){var t=new Ee;jt(this,t,Et(e)),Re(t,t.h.end());for(var n=new Uint8Array(t.i),i=t.j,r=i.length,a=0,o=0;o<r;o++){var s=i[o];n.set(s,a),a+=s.length}return t.j=[n],n}}function Gt(e){ut.call(this,e)}p(Gt,ut);var Jt=[Gt,1,Ft,2,Nt,3,Bt,4,Bt];function Ht(e){ut.call(this,e,-1,zt)}Gt.prototype.l=Wt(Jt),p(Ht,ut),Ht.prototype.addClassification=function(e,t){return $e(this,1,Gt,e,t),this};var zt=[1],Kt=Ut([Ht,1,Vt,Jt]);function Xt(e){ut.call(this,e)}p(Xt,ut);var qt=[Xt,1,Nt,2,Nt,3,Nt,4,Nt,5,Nt];function Yt(e){ut.call(this,e,-1,Qt)}Xt.prototype.l=Wt(qt),p(Yt,ut);var Qt=[1],$t=Ut([Yt,1,Vt,qt]);function Zt(e){ut.call(this,e)}p(Zt,ut);var en=[Zt,1,Nt,2,Nt,3,Nt,4,Nt,5,Nt,6,_t],tn=Ut(en);function nn(e,t,n){if(n=e.createShader(0===n?e.VERTEX_SHADER:e.FRAGMENT_SHADER),e.shaderSource(n,t),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw Error("Could not compile WebGL shader.\n\n"+e.getShaderInfoLog(n));return n}function rn(e){return Ye(e,Gt,1).map((function(e){var t=Je(e,1);return{index:null==t?0:t,qa:et(e,2),label:null!=Je(e,3)?Ze(Je(e,3),""):void 0,displayName:null!=Je(e,4)?Ze(Je(e,4),""):void 0}}))}function an(e){return{x:et(e,1),y:et(e,2),z:et(e,3),visibility:null!=Xe(e,4)?et(e,4):void 0}}function on(e,t){this.i=e,this.h=t,this.m=0}function sn(e,t,n){return function(e,t){var n=e.h;if(void 0===e.s){var i=nn(n,"\n  attribute vec2 aVertex;\n  attribute vec2 aTex;\n  varying vec2 vTex;\n  void main(void) {\n    gl_Position = vec4(aVertex, 0.0, 1.0);\n    vTex = aTex;\n  }",0),r=nn(n,"\n  precision mediump float;\n  varying vec2 vTex;\n  uniform sampler2D sampler0;\n  void main(){\n    gl_FragColor = texture2D(sampler0, vTex);\n  }",1),a=n.createProgram();if(n.attachShader(a,i),n.attachShader(a,r),n.linkProgram(a),!n.getProgramParameter(a,n.LINK_STATUS))throw Error("Could not compile WebGL program.\n\n"+n.getProgramInfoLog(a));i=e.s=a,n.useProgram(i),r=n.getUniformLocation(i,"sampler0"),e.l={O:n.getAttribLocation(i,"aVertex"),N:n.getAttribLocation(i,"aTex"),ya:r},e.v=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,e.v),n.enableVertexAttribArray(e.l.O),n.vertexAttribPointer(e.l.O,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null),e.u=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,e.u),n.enableVertexAttribArray(e.l.N),n.vertexAttribPointer(e.l.N,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null),n.uniform1i(r,0)}i=e.l,n.useProgram(e.s),n.canvas.width=t.width,n.canvas.height=t.height,n.viewport(0,0,t.width,t.height),n.activeTexture(n.TEXTURE0),e.i.bindTexture2d(t.glName),n.enableVertexAttribArray(i.O),n.bindBuffer(n.ARRAY_BUFFER,e.v),n.vertexAttribPointer(i.O,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(i.N),n.bindBuffer(n.ARRAY_BUFFER,e.u),n.vertexAttribPointer(i.N,2,n.FLOAT,!1,0,0),n.bindFramebuffer(n.DRAW_FRAMEBUFFER?n.DRAW_FRAMEBUFFER:n.FRAMEBUFFER,null),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),n.colorMask(!0,!0,!0,!0),n.drawArrays(n.TRIANGLE_FAN,0,4),n.disableVertexAttribArray(i.O),n.disableVertexAttribArray(i.N),n.bindBuffer(n.ARRAY_BUFFER,null),e.i.bindTexture2d(0)}(e,t),"function"==typeof e.h.canvas.transferToImageBitmap?Promise.resolve(e.h.canvas.transferToImageBitmap()):n?Promise.resolve(e.h.canvas):"function"==typeof createImageBitmap?createImageBitmap(e.h.canvas):(void 0===e.j&&(e.j=document.createElement("canvas")),new Promise((function(t){e.j.height=e.h.canvas.height,e.j.width=e.h.canvas.width,e.j.getContext("2d",{}).drawImage(e.h.canvas,0,0,e.h.canvas.width,e.h.canvas.height),t(e.j)})))}function cn(e){this.h=e}Zt.prototype.l=Wt(en);var un=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]);function ln(e,t){return t+e}function dn(e,t){window[e]=t}function hn(e){if(this.h=e,this.listeners={},this.l={},this.L={},this.s={},this.v={},this.M=this.u=this.ga=!0,this.I=Promise.resolve(),this.fa="",this.D={},this.locateFile=e&&e.locateFile||ln,"object"==typeof window)var t=window.location.pathname.toString().substring(0,window.location.pathname.toString().lastIndexOf("/"))+"/";else{if("undefined"==typeof location)throw Error("solutions can only be loaded on a web page or in a web worker");t=location.pathname.toString().substring(0,location.pathname.toString().lastIndexOf("/"))+"/"}if(this.ha=t,e.options)for(var n=(t=o(Object.keys(e.options))).next();!n.done;n=t.next()){var i=e.options[n=n.value].default;void 0!==i&&(this.l[n]="function"==typeof i?i():i)}}function fn(e,t){var n,i;return A((function(r){return t in e.L?r.return(e.L[t]):(n=e.locateFile(t,""),i=fetch(n).then((function(e){return e.arrayBuffer()})),e.L[t]=i,r.return(i))}))}function mn(e,t){for(var n=t.name||"$",i=[].concat(s(t.wants)),r=new e.i.StringList,a=o(t.wants),c=a.next();!c.done;c=a.next())r.push_back(c.value);a=e.i.PacketListener.implement({onResults:function(r){for(var a={},s=0;s<t.wants.length;++s)a[i[s]]=r.get(s);var c=e.listeners[n];c&&(e.I=function(e,t,n){var i,r,a,s,c,u,l,d,h,f,m,p;return A((function(v){switch(v.h){case 1:if(!n)return v.return(t);for(i={},r=0,a=o(Object.keys(n)),s=a.next();!s.done;s=a.next())"string"!=typeof(c=n[s.value])&&"texture"===c.type&&void 0!==t[c.stream]&&++r;1<r&&(e.M=!1),u=o(Object.keys(n)),s=u.next();case 2:if(s.done){v.h=4;break}if("string"==typeof(d=n[l=s.value]))return m=i,p=l,b(v,function(e,t,n){var i;return A((function(r){return"number"==typeof n||n instanceof Uint8Array||n instanceof e.i.Uint8BlobList?r.return(n):n instanceof e.i.Texture2dDataOut?((i=e.v[t])||(i=new on(e.i,e.K),e.v[t]=i),r.return(sn(i,n,e.M))):r.return(void 0)}))}(e,l,t[d]),14);if(h=t[d.stream],"detection_list"===d.type){if(h){for(var g=h.getRectList(),y=h.getLandmarksList(),k=h.getClassificationsList(),S=[],w=0;w<g.size();++w){var C=tn(g.get(w)),T=void 0;T=void 0===T?0:T,C={la:{sa:et(C,1),ta:et(C,2),height:et(C,3),width:et(C,4),rotation:et(C,5,0),pa:Ze(Je(C,6),T)},ea:Ye($t(y.get(w)),Xt,1).map(an),ba:rn(Kt(k.get(w)))},S.push(C)}g=S}else g=[];i[l]=g,v.h=7;break}if("proto_list"===d.type){if(h){for(g=Array(h.size()),y=0;y<h.size();y++)g[y]=h.get(y);h.delete()}else g=[];i[l]=g,v.h=7;break}if(void 0===h){v.h=3;break}if("float_list"===d.type){i[l]=h,v.h=7;break}if("proto"===d.type){i[l]=h,v.h=7;break}if("texture"!==d.type)throw Error("Unknown output config type: '"+d.type+"'");return(f=e.v[l])||(f=new on(e.i,e.K),e.v[l]=f),b(v,sn(f,h,e.M),13);case 13:i[l]=v.i;case 7:d.transform&&i[l]&&(i[l]=d.transform(i[l])),v.h=3;break;case 14:m[p]=v.i;case 3:s=u.next(),v.h=2;break;case 4:return v.return(i)}}))}(e,a,t.outs).then((function(n){n=c(n);for(var r=0;r<t.wants.length;++r){var o=a[i[r]];"object"==typeof o&&o.hasOwnProperty&&o.hasOwnProperty("delete")&&o.delete()}n&&(e.I=n)})))}}),e.j.attachMultiListener(r,a),r.delete()}function pn(e){switch(void 0===e&&(e=0),e){case 1:return"selfie_segmentation_landscape.tflite";default:return"selfie_segmentation.tflite"}}function vn(e){var t=this;this.h=new hn({locateFile:(e=e||{}).locateFile,files:function(e){return[{simd:!0,url:"selfie_segmentation_solution_simd_wasm_bin.js"},{simd:!1,url:"selfie_segmentation_solution_wasm_bin.js"},{data:!0,url:pn(e.modelSelection)}]},graph:{url:"selfie_segmentation.binarypb"},listeners:[{wants:["segmentation_mask","image_transformed"],outs:{image:{type:"texture",stream:"image_transformed"},segmentationMask:{type:"texture",stream:"segmentation_mask"}}}],inputs:{image:{type:"video",stream:"input_frames_gpu"}},options:{useCpuInference:{type:0,graphOptionXref:{calculatorType:"InferenceCalculator",fieldName:"use_cpu_inference"},default:"object"==typeof window&&void 0!==window.navigator&&("iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document)},selfieMode:{type:0,graphOptionXref:{calculatorType:"GlScalerCalculator",calculatorIndex:1,fieldName:"flip_horizontal"}},modelSelection:{type:1,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorModelSelection",fieldName:"int_value"},onChange:function(e){var n,i;return A((function(r){return 1==r.h?(n=pn(e),i="third_party/mediapipe/modules/selfie_segmentation/"+n,b(r,fn(t.h,n),2)):(t.h.overrideFile(i,r.i),r.return(!0))}))}}}})}(e=hn.prototype).close=function(){return this.j&&this.j.delete(),Promise.resolve()},e.reset=function(){var e=this;return A((function(t){e.j&&(e.j.reset(),e.s={},e.v={}),t.h=0}))},e.setOptions=function(e,t){var n=this;if(t=t||this.h.options){for(var i=[],r=[],a={},s=o(Object.keys(e)),c=s.next();!c.done;a={X:a.X,Y:a.Y},c=s.next())if(!((c=c.value)in this.l)||this.l[c]!==e[c]){this.l[c]=e[c];var l=t[c];void 0!==l&&(l.onChange&&(a.X=l.onChange,a.Y=e[c],i.push(function(e){return function(){return A((function(t){if(1==t.h)return b(t,e.X(e.Y),2);!0===t.i&&(n.u=!0),t.h=0}))}}(a))),l.graphOptionXref&&(c=Object(u._)({},{calculatorName:"",calculatorIndex:0},l.graphOptionXref,{valueNumber:1===l.type?e[c]:0,valueBoolean:0===l.type&&e[c],valueString:2===l.type?e[c]:""}),r.push(c)))}0===i.length&&0===r.length||(this.u=!0,this.H=(void 0===this.H?[]:this.H).concat(r),this.F=(void 0===this.F?[]:this.F).concat(i))}},e.initialize=function(){var e=this;return A((function(t){return 1==t.h?b(t,function(e){var t,n,i,r,a,o,c,u,l,d,h;return A((function(f){switch(f.h){case 1:return e.ga?(t=void 0===e.h.files?[]:"function"==typeof e.h.files?e.h.files(e.l):e.h.files,b(f,A((function(e){switch(e.h){case 1:return e.s=2,b(e,WebAssembly.instantiate(un),4);case 4:e.h=3,e.s=0;break;case 2:return e.s=0,e.l=null,e.return(!1);case 3:return e.return(!0)}})),2)):f.return();case 2:if(n=f.i,"object"==typeof window)return dn("createMediapipeSolutionsWasm",{locateFile:e.locateFile}),dn("createMediapipeSolutionsPackedAssets",{locateFile:e.locateFile}),o=t.filter((function(e){return void 0!==e.data})),c=t.filter((function(e){return void 0===e.data})),u=Promise.all(o.map((function(t){var n=fn(e,t.url);if(void 0!==t.path){var i=t.path;n=n.then((function(t){return e.overrideFile(i,t),Promise.resolve(t)}))}return n}))),l=Promise.all(c.map((function(t){return void 0===t.simd||t.simd&&n||!t.simd&&!n?function(e){var t=document.createElement("script");return t.setAttribute("src",e),t.setAttribute("crossorigin","anonymous"),new Promise((function(e){t.addEventListener("load",(function(){e()}),!1),t.addEventListener("error",(function(){e()}),!1),document.body.appendChild(t)}))}(e.locateFile(t.url,e.ha)):Promise.resolve()}))).then((function(){var t,n,i;return A((function(r){if(1==r.h)return t=window.createMediapipeSolutionsWasm,n=window.createMediapipeSolutionsPackedAssets,i=e,b(r,t(n),2);i.i=r.i,r.h=0}))})),d=A((function(t){return e.h.graph&&e.h.graph.url?t=b(t,fn(e,e.h.graph.url),0):(t.h=0,t=void 0),t})),b(f,Promise.all([l,u,d]),7);if("function"!=typeof importScripts)throw Error("solutions can only be loaded on a web page or in a web worker");return i=t.filter((function(e){return void 0===e.simd||e.simd&&n||!e.simd&&!n})).map((function(t){return e.locateFile(t.url,e.ha)})),importScripts.apply(null,s(i)),r=e,b(f,createMediapipeSolutionsWasm(Module),6);case 6:r.i=f.i,e.m=new OffscreenCanvas(1,1),e.i.canvas=e.m,a=e.i.GL.createContext(e.m,{antialias:!1,alpha:!1,va:"undefined"!=typeof WebGL2RenderingContext?2:1}),e.i.GL.makeContextCurrent(a),f.h=4;break;case 7:if(e.m=document.createElement("canvas"),!(h=e.m.getContext("webgl2",{}))&&!(h=e.m.getContext("webgl",{})))return alert("Failed to create WebGL canvas context when passing video frame."),f.return();e.K=h,e.i.canvas=e.m,e.i.createContext(e.m,!0,!0,{});case 4:e.j=new e.i.SolutionWasm,e.ga=!1,f.h=0}}))}(e),2):3!=t.h?b(t,function(e){var t,n,i,r,a,s;return A((function(c){if(1==c.h)return e.h.graph&&e.h.graph.url&&e.fa===e.h.graph.url?c.return():(e.u=!0,e.h.graph&&e.h.graph.url?(e.fa=e.h.graph.url,b(c,fn(e,e.h.graph.url),3)):void(c.h=2));for(2!=c.h&&e.j.loadGraph(c.i),t=o(Object.keys(e.D)),n=t.next();!n.done;n=t.next())e.j.overrideFile(i=n.value,e.D[i]);if(e.D={},e.h.listeners)for(r=o(e.h.listeners),a=r.next();!a.done;a=r.next())mn(e,a.value);s=e.l,e.l={},e.setOptions(s),c.h=0}))}(e),3):b(t,function(e){var t,n,i,r,a;return A((function(s){switch(s.h){case 1:if(!e.u)return s.return();if(!e.F){s.h=2;break}t=o(e.F),n=t.next();case 3:if(n.done){s.h=5;break}return b(s,(0,n.value)(),4);case 4:n=t.next(),s.h=3;break;case 5:e.F=void 0;case 2:if(e.H){for(i=new e.i.GraphOptionChangeRequestList,r=o(e.H),a=r.next();!a.done;a=r.next())i.push_back(a.value);e.j.changeOptions(i),i.delete(),e.H=void 0}e.u=!1,s.h=0}}))}(e),0)}))},e.overrideFile=function(e,t){this.j?this.j.overrideFile(e,t):this.D[e]=t},e.clearOverriddenFiles=function(){this.D={},this.j&&this.j.clearOverriddenFiles()},e.send=function(e,t){var n,i,r,a,s,c,l,d,h,f=this;return A((function(m){switch(m.h){case 1:return f.h.inputs?(n=1e3*(null==t?performance.now():t),b(m,f.I,2)):m.return();case 2:return b(m,f.initialize(),3);case 3:for(i=new f.i.PacketDataList,r=o(Object.keys(e)),a=r.next();!a.done;a=r.next())if(c=f.h.inputs[s=a.value]){e:{var p=e[s];switch(c.type){case"video":var v=f.s[c.stream];if(v||(v=new on(f.i,f.K),f.s[c.stream]=v),0===v.m&&(v.m=v.i.createTexture()),"undefined"!=typeof HTMLVideoElement&&p instanceof HTMLVideoElement)var g=p.videoWidth,y=p.videoHeight;else"undefined"!=typeof HTMLImageElement&&p instanceof HTMLImageElement?(g=p.naturalWidth,y=p.naturalHeight):(g=p.width,y=p.height);y={glName:v.m,width:g,height:y},(g=v.h).canvas.width=y.width,g.canvas.height=y.height,g.activeTexture(g.TEXTURE0),v.i.bindTexture2d(v.m),g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,p),v.i.bindTexture2d(0),v=y;break e;case"detections":for((v=f.s[c.stream])||(v=new cn(f.i),f.s[c.stream]=v),v.data||(v.data=new v.h.DetectionListData),v.data.reset(p.length),y=0;y<p.length;++y){var k=v.data,S=k.setBoundingBox,w=y,C=(g=p[y]).la,A=new Zt;if(Qe(A,1,C.sa),Qe(A,2,C.ta),Qe(A,3,C.height),Qe(A,4,C.width),Qe(A,5,C.rotation),He(A,6,C.pa),C=A.l(),S.call(k,w,C),g.ea)for(k=0;k<g.ea.length;++k){A=g.ea[k],w=(S=v.data).addNormalizedLandmark,C=y,A=Object(u._)({},A,{visibility:A.visibility?A.visibility:0});var T=new Xt;Qe(T,1,A.x),Qe(T,2,A.y),Qe(T,3,A.z),A.visibility&&Qe(T,4,A.visibility),A=T.l(),w.call(S,C,A)}if(g.ba)for(k=0;k<g.ba.length;++k)w=(S=v.data).addClassification,C=y,A=g.ba[k],Qe(T=new Gt,2,A.qa),A.index&&He(T,1,A.index),A.label&&He(T,3,A.label),A.displayName&&He(T,4,A.displayName),A=T.l(),w.call(S,C,A)}v=v.data;break e;default:v={}}}switch(l=v,d=c.stream,c.type){case"video":i.pushTexture2d(Object(u._)({},l,{stream:d,timestamp:n}));break;case"detections":(h=l).stream=d,h.timestamp=n,i.pushDetectionList(h);break;default:throw Error("Unknown input config type: '"+c.type+"'")}}return f.j.send(i),b(m,f.I,4);case 4:i.delete(),m.h=0}}))},e.onResults=function(e,t){this.listeners[t||"$"]=e},R("Solution",hn),R("OptionType",{BOOL:0,NUMBER:1,ua:2,0:"BOOL",1:"NUMBER",2:"STRING"}),(e=vn.prototype).close=function(){return this.h.close(),Promise.resolve()},e.onResults=function(e){this.h.onResults(e)},e.initialize=function(){var e=this;return A((function(t){return b(t,e.h.initialize(),0)}))},e.reset=function(){this.h.reset()},e.send=function(e){var t=this;return A((function(n){return b(n,t.h.send(e),0)}))},e.setOptions=function(e){this.h.setOptions(e)},R("SelfieSegmentation",vn),R("VERSION","0.1.1675465747")}).call(x);var j=window.log,D=new WeakMap,N=new WeakSet,_=function(){function e(t){var n,i,r;a(this,e),E(this,n=N),n.add(this),E(i=this,r=D),r.set(i,{writable:!0,value:null}),this.webRTCAdaptor=t,this.selfieSegmentation=null,this.effectCanvas=null,this.ctx=null,this.rawLocalVideo=document.createElement("video"),this.deepAR=null,this.backgroundBlurRange=3,this.edgeBlurRange=4,this.effectName=e.NO_EFFECT,this.startTime=0,this.statTimerId=-1,this.renderedFrameCount=0,this.lastRenderedFrameCount=0,this.effectCanvasFPS=0,this.videoCallbackPeriodMs=0,this.initializeSelfieSegmentation(),this.isInitialized=!0}return s(e,[{key:"init",value:function(e){var t=this;return w(regeneratorRuntime.mark((function n(){var i;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.setRawLocalVideo(e);case 2:return i=e.getVideoTracks()[0].getSettings(),n.abrupt("return",(t.effectCanvasFPS=i.frameRate,t.videoCallbackPeriodMs=1e3/t.effectCanvasFPS,t.effectCanvas=t.createEffectCanvas(i.width,i.height),t.ctx=t.effectCanvas.getContext("2d"),t.canvasStream&&(t.canvasStream.getTracks().forEach((function(e){return e.stop()})),t.canvasStream=null),t.canvasStream=t.effectCanvas.captureStream(t.effectCanvasFPS),new Promise((function(e,n){e(t.canvasStream)}))));case 4:case"end":return n.stop()}}),n)})))()}},{key:"setRawLocalVideo",value:function(e){return this.rawLocalVideo.srcObject=e,this.rawLocalVideo.muted=!0,this.rawLocalVideo.autoplay=!0,this.rawLocalVideo.play()}},{key:"createEffectCanvas",value:function(e,t){var n=document.createElement("canvas");return n.id="effectCanvas",n.width=e,n.height=t,n}},{key:"initializeSelfieSegmentation",value:function(){var t=this;this.selfieSegmentation=new SelfieSegmentation({locateFile:function(t){return e.LOCATE_FILE_URL+"/"+t}}),this.selfieSegmentation.setOptions({selfieMode:!1,modelSelection:1}),this.selfieSegmentation.onResults((function(e){t.onResults(e)}))}},{key:"startFpsCalculation",value:function(){var e=this;this.statTimerId=setInterval((function(){var t=(new Date).getTime(),n=(t-e.startTime)/1e3;e.startTime=t;var i=(e.renderedFrameCount-e.lastRenderedFrameCount)/n;e.renderedFrameCount=e.lastRenderedFrameCount,j.warn("Fps: "+i+"fps")}),1e3)}},{key:"stopFpsCalculation",value:function(){-1!==this.statTimerId&&(clearInterval(this.statTimerId),this.statTimerId=-1)}},{key:"processFrame",value:function(){var t=this;return w(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.selfieSegmentation.send({image:t.rawLocalVideo});case 2:t.effectName!==e.NO_EFFECT&&setTimeout((function(){t.processFrame()}),t.videoCallbackPeriodMs);case 3:case"end":return n.stop()}}),n)})))()}},{key:"setBlurEffectRange",value:function(e,t){this.backgroundBlurRange=e,this.edgeBlurRange=t}},{key:"enableEffect",value:function(t,n,i){var r=this;return w(regeneratorRuntime.mark((function a(){var o,s,c,u;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(!r.isInitialized){a.next=34;break}a.t0=t,a.next=a.t0===e.DEEPAR||a.t0===e.VIRTUAL_BACKGROUND||a.t0===e.BLUR_BACKGROUND||a.t0===e.NO_EFFECT?4:5;break;case 4:return a.abrupt("break",6);case 5:return a.abrupt("return",void j.warn("Unknown effect name please use the constants VideoEffect.VIRTUAL_BACKGROUND,VideoEffect.BLUR_BACKGROUND or VideoEffect.NO_EFFECT "));case 6:if(o=r.effectName,r.effectName=t,o===e.DEEPAR&&t!==e.DEEPAR&&(r.deepAR.shutdown(),r.deepAR=null),t!==e.VIRTUAL_BACKGROUND&&t!==e.BLUR_BACKGROUND){a.next=9;break}return a.abrupt("return",o===e.NO_EFFECT||o===e.DEEPAR?(e.DEBUG&&r.startFpsCalculation(),navigator.mediaDevices.getUserMedia({video:r.webRTCAdaptor.mediaConstraints.video,audio:!0}).then((function(e){return r.init(e).then((function(e){return r.webRTCAdaptor.updateVideoTrack(e,r.webRTCAdaptor.publishStreamId,null,!0).then((function(){setTimeout((function(){r.processFrame()}),r.videoCallbackPeriodMs)}))})).catch((function(e){throw j.error(e),e}))}))):new Promise((function(e,t){e()})));case 9:if(t===e.DEEPAR){a.next=17;break}if(o!==e.DEEPAR){a.next=16;break}return a.next=13,navigator.mediaDevices.getUserMedia({video:r.webRTCAdaptor.mediaConstraints.video,audio:!0});case 13:return s=a.sent,a.next=16,r.setRawLocalVideo(s);case 16:return a.abrupt("return",new Promise((function(e,t){r.stopFpsCalculation(),T(r,N,F).call(r),e()})));case 17:if(null==n||""===n||null==i||""===i){a.next=31;break}if(o===e.DEEPAR){a.next=28;break}if(a.t1=o!==e.BLUR_BACKGROUND&&o!==e.VIRTUAL_BACKGROUND,a.t1){a.next=24;break}return r.stopFpsCalculation(),a.next=24,T(r,N,F).call(r);case 24:c=r.createEffectCanvas(500,500),u=new DeepAR({licenseKey:n,canvas:c,deeparWasmPath:e.DEEP_AR_FOLDER_ROOT_URL+"/wasm/deepar.wasm",callbacks:{onInitialize:function(){u.startVideo(!0)}}}),r.deepAR=u,r.deepAR.callbacks.onVideoStarted=function(){r.canvasStream=c.captureStream(30),r.webRTCAdaptor.updateVideoTrack(r.canvasStream,r.webRTCAdaptor.publishStreamId,null,!0),r.deepAR.switchEffect(0,"slot",e.DEEP_AR_EFFECTS_URL+i+e.DEEP_AR_EXTENSION)},r.deepAR.downloadFaceTrackingModel(e.DEEP_AR_FOLDER_ROOT_URL+"/models/face/models-68-extreme.bin"),r.deepAR.setVideoElement(r.rawLocalVideo,!0),a.next=29;break;case 28:r.deepAR.switchEffect(0,"slot",e.DEEP_AR_EFFECTS_URL+i+e.DEEP_AR_EXTENSION);case 29:a.next=32;break;case 31:j.error("DeepAR API key or DeepAR Model is not set!");case 32:a.next=35;break;case 34:j.error("VideoEffect is not initialized!");case 35:case"end":return a.stop()}}),a)})))()}},{key:"drawSegmentationMask",value:function(e){this.ctx.drawImage(e,0,0,this.effectCanvas.width,this.effectCanvas.height)}},{key:"onResults",value:function(t){var n,i;this.renderedFrameCount++,this.effectName==e.BLUR_BACKGROUND?this.drawBlurBackground(t.image,t.segmentationMask,this.backgroundBlurRange):this.effectName==e.VIRTUAL_BACKGROUND?this.drawVirtualBackground(t.image,t.segmentationMask,(n=this,(i=A(this,D,"get")).get?i.get.call(n):i.value)):this.drawImageDirectly(t.image)}},{key:"drawImageDirectly",value:function(e){this.ctx.save(),this.ctx.globalCompositeOperation="source-over",this.ctx.filter="none",this.ctx.drawImage(e,0,0,e.width,e.height),this.ctx.restore()}},{key:"drawVirtualBackground",value:function(e,t,n){this.ctx.save(),this.ctx.filter="none",this.ctx.clearRect(0,0,this.effectCanvas.width,this.effectCanvas.height),this.ctx.drawImage(t,0,0,this.effectCanvas.width,this.effectCanvas.height),this.ctx.globalCompositeOperation="source-out",this.ctx.drawImage(n,0,0,n.naturalWidth,n.naturalHeight,0,0,this.effectCanvas.width,this.effectCanvas.height),this.ctx.globalCompositeOperation="destination-atop",this.ctx.drawImage(e,0,0,this.effectCanvas.width,this.effectCanvas.height),this.ctx.restore()}},{key:"drawBlurBackground",value:function(e,t,n){this.ctx.clearRect(0,0,this.effectCanvas.width,this.effectCanvas.height),this.ctx.globalCompositeOperation="copy",this.ctx.filter="none",this.ctx.filter="blur("+this.edgeBlurRange+"px)",this.drawSegmentationMask(t),this.ctx.globalCompositeOperation="source-in",this.ctx.filter="none",this.ctx.drawImage(e,0,0,this.effectCanvas.width,this.effectCanvas.height),this.ctx.globalCompositeOperation="destination-over",this.ctx.filter="blur("+n+"px)",this.ctx.drawImage(e,0,0,this.effectCanvas.width,this.effectCanvas.height),this.ctx.restore()}},{key:"virtualBackgroundImage",set:function(e){var t;t=e,function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(this,A(this,D,"set"),t)}}]),e}();function F(){return this.rawLocalVideo.pause(),null!=this.canvasStream&&this.canvasStream.getVideoTracks().forEach((function(e){return e.stop()})),this.webRTCAdaptor.switchVideoCameraCapture(this.webRTCAdaptor.publishStreamId)}C(_,"DEEPAR","deepar"),C(_,"VIRTUAL_BACKGROUND","virtual-background"),C(_,"BLUR_BACKGROUND","blur-background"),C(_,"NO_EFFECT","no-effect"),C(_,"deepARModelList",["flower_face","Ping_Pong"]),C(_,"DEBUG",!1),C(_,"LOCATE_FILE_URL","https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation"),C(_,"DEEP_AR_FOLDER_ROOT_URL","https://cdn.jsdelivr.net/npm/deepar@4.0.3"),C(_,"DEEP_AR_EFFECTS_URL","../js/external/deepar-effects/"),C(_,"DEEP_AR_EXTENSION",".deepar"),O.register((function(e){var t=new _(e);Object.defineProperty(e,"setBlurEffectRange",{value:function(e,n){t.setBlurEffectRange(e,n)}}),Object.defineProperty(e,"enableEffect",{value:function(e,n,i){return t.enableEffect(e,n,i)}}),Object.defineProperty(e,"setBackgroundImage",{value:function(e){t.virtualBackgroundImage=e}})}));var B={sdpConstraints:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0},mediaConstraints:{video:!1,audio:!1}},V=function(){function e(t,n,i){var r=this;a(this,e),this.player=Object(u.v)(i.playerId),this.player.hasOwnProperty("sendDataViaWebRTC")||Object.defineProperty(this.player,"sendDataViaWebRTC",{value:function(e){r.webRTCAdaptor.sendData(r.source.streamName,e)}}),this.isPlaying=!1,this.disposed=!1,this.initiateWebRTCAdaptor(t,i),this.player.ready((function(){r.player.addClass("videojs-webrtc-plugin")})),this.player.on("playing",(function(){r.player.el().getElementsByClassName("vjs-custom-spinner").length&&r.player.el().removeChild(r.player.spinner)})),u.v.registerComponent("ResolutionMenuButton",p),u.v.registerComponent("ResolutionMenuItem",m)}return s(e,[{key:"initiateWebRTCAdaptor",value:function(e,t){var n=this;this.options=u.v.mergeOptions(B,t),this.source=e,"object"==typeof e.iceServers?this.source.pcConfig={iceServers:e.iceServers}:"string"==typeof e.iceServers&&(this.source.pcConfig={iceServers:JSON.parse(e.iceServers)}),this.source.mediaServerUrl=e.src.replace(e.src.split("/").at(-1),"websocket"),this.source.streamName=e.src.split("/").at(-1).split(".webrtc")[0],this.source.token=this.getUrlParameter("token"),this.source.subscriberId=this.getUrlParameter("subscriberId"),this.source.subscriberCode=this.getUrlParameter("subscriberCode"),this.source.reconnect=void 0===this.source.reconnect||this.source.reconnect;var i={websocketURL:this.source.mediaServerUrl,mediaConstraints:this.source.mediaConstraints,isPlayMode:!0,sdpConstraints:this.source.sdpConstraints,reconnectIfRequiredFlag:this.source.reconnect,callback:function(e,t){if(!n.disposed)switch(n.player.trigger("webrtc-info",{obj:t,info:e}),e){case"initialized":n.play();break;case"ice_connection_state_changed":break;case"play_started":n.joinStreamHandler(t),n.isPlaying=!0,n.player.trigger("play");break;case"play_finished":n.leaveStreamHandler(t),n.isPlaying=!1,n.player.trigger("ended");break;case"streamInformation":n.streamInformationHandler(t);break;case"resolutionChangeInfo":n.resolutionChangeHandler(t);break;case"data_received":n.player.trigger("webrtc-data-received",{obj:t});break;case"data_channel_not_open":break;case"newTrackAvailable":var i=n.player.tech().el();i.srcObject!==t.stream&&(i.srcObject=t.stream)}},callbackError:function(e,t){if(!n.disposed){var i=u.v.getComponent("ModalDialog");n.errorModal&&n.errorModal.close(),n.errorModal=new i(n.player,{content:"ERROR: "+JSON.stringify(e),temporary:!0,pauseOnOpen:!1,uncloseable:!0}),n.player.addChild(n.errorModal),n.errorModal.open(),n.errorModal.setTimeout((function(){return n.errorModal.close()}),3e3),n.player.trigger("webrtc-error",{error:e,message:t})}}};if(this.source.pcConfig){var r={};Object(u._)(r,this.source.pcConfig),Object(u._)(i,{peerconnection_config:r})}this.webRTCAdaptor=new O(i)}},{key:"play",value:function(){this.webRTCAdaptor.play(this.source.streamName,this.source.token,null,null,this.source.subscriberId,this.source.subscriberCode,null)}},{key:"joinStreamHandler",value:function(e){this.webRTCAdaptor.getStreamInfo(this.source.streamName)}},{key:"leaveStreamHandler",value:function(){this.player.resolutions=[];var e=this.player.controlBar.getChild("ResolutionMenuButton");e&&e.update()}},{key:"streamInformationHandler",value:function(e){var n=e.streamInfo.reduce((function(e,n){return e.includes(n.streamHeight)?e:[].concat(t(e),[n.streamHeight])}),[]).sort((function(e,t){return t-e}));this.player.resolutions=n.map((function(e){return{label:e,value:e}})),this.player.selectedResolution=0,this.addResolutionButton()}},{key:"addResolutionButton",value:function(){var e=this.player.controlBar,t=e.getChild("fullscreenToggle").el();e.getChild("ResolutionMenuButton")&&e.removeChild("ResolutionMenuButton"),e.el().insertBefore(e.addChild("ResolutionMenuButton",{plugin:this,streamName:this.source.streamName}).el(),t)}},{key:"resolutionChangeHandler",value:function(e){var t=this;this.player.spinner=document.createElement("div"),this.player.spinner.className="vjs-custom-spinner",this.player.el().appendChild(this.player.spinner),this.player.pause(),this.player.setTimeout((function(){t.player.el().getElementsByClassName("vjs-custom-spinner").length&&(t.player.el().removeChild(t.player.spinner),t.player.play())}),2e3)}},{key:"changeStreamQuality",value:function(e){this.webRTCAdaptor.forceStreamQuality(this.source.streamName,e),this.player.selectedResolution=e,this.player.controlBar.getChild("ResolutionMenuButton").update()}},{key:"getUrlParameter",value:function(e){return this.source.src.includes("?")?(this.source.src.split("?")[1].split("&").reduce((function(e,t){var n=t.split("=");return e[decodeURIComponent(n[0])]=decodeURIComponent(n[1]),e}),{})||{})[e]:null}},{key:"dispose",value:function(){this.disposed=!0,this.webRTCAdaptor&&(this.webRTCAdaptor.stop(this.source.streamName),this.webRTCAdaptor.closeWebSocket(),this.webRTCAdaptor=null)}}]),e}(),U={name:"videojs-webrtc-plugin",VERSION:"1.3.1",canHandleSource:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=u.v.mergeOptions(u.v.options,t);return n.source=e.src,U.canPlayType(e.type,n)},handleSource:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=u.v.mergeOptions(u.v.options,n);return t.webrtc=new V(e,t,i),t.webrtc},canPlayType:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return/\.webrtc.*$/.test(t.source)?"maybe":""}};u.v.getTech("Html5").registerSourceHandler(U,0);var W={WebRTCHandler:V,webRTCSourceHandler:U}}).call(this,o("yLpj"))}}])}();