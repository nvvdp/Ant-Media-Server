(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{"tP/V":function(e,t,i){"use strict";i.r(t),(function(e){i.d(t,"default",(function(){return x}));var r=i("LFg+");i("KeXy");const n=r.v.getComponent("MenuItem"),a=r.v.getComponent("Component");class o extends n{constructor(e,t){t.selectable=!0,t.multiSelectable=!1,super(e,t)}handleClick(){this.options().plugin.changeStreamQuality(this.options().value)}}a.registerComponent("ResolutionMenuItem",o);const s=r.v.getComponent("MenuButton");class c extends s{constructor(e,t){super(e,t)}createEl(){return r.v.dom.createEl("div",{className:"vjs-http-source-selector vjs-menu-button vjs-menu-button-popup vjs-control vjs-button"})}buildCSSClass(){return super.buildCSSClass()+" vjs-icon-cog"}update(){return super.update()}createItems(){const e=[],t=[{label:"auto",value:0},...this.player().resolutions];for(let i=0;i<t.length;i++)e.push(new o(this.player_,{label:t[i].label,value:t[i].value,selected:t[i].value===this.player().selectedResolution,plugin:this.options().plugin,streamName:this.options().streamName}));return e}}window.log=function(){var e=function(){},t="undefined"!=typeof window&&void 0!==window.navigator&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"];function r(e,t){var i=e[t];if("function"==typeof i.bind)return i.bind(e);try{return Function.prototype.bind.call(i,e)}catch(r){return function(){return Function.prototype.apply.apply(i,[e,arguments])}}}function n(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function a(i){return"debug"===i&&(i="log"),"undefined"!=typeof console&&("trace"===i&&t?n:void 0!==console[i]?r(console,i):void 0!==console.log?r(console,"log"):e)}function o(t,r){for(var n=0;n<i.length;n++){var a=i[n];this[a]=n<t?e:this.methodFactory(a,t,r)}this.log=this.debug}function s(e,t,i){return function(){"undefined"!=typeof console&&(o.call(this,t,i),this[e].apply(this,arguments))}}function c(e,t,i){return a(e)||s.apply(this,arguments)}function l(e,t,r){var n,a=this;t=null==t?"WARN":t;var s="loglevel";function l(){var e;if("undefined"!=typeof window&&s){try{e=window.localStorage[s]}catch(r){}if(void 0===e)try{var t=window.document.cookie,i=t.indexOf(encodeURIComponent(s)+"=");-1!==i&&(e=/^([^;]+)/.exec(t.slice(i))[1])}catch(r){}return void 0===a.levels[e]&&(e=void 0),e}}"string"==typeof e?s+=":"+e:"symbol"==typeof e&&(s=void 0),a.name=e,a.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},a.methodFactory=r||c,a.getLevel=function(){return n},a.setLevel=function(t,r){if("string"==typeof t&&void 0!==a.levels[t.toUpperCase()]&&(t=a.levels[t.toUpperCase()]),!("number"==typeof t&&t>=0&&t<=a.levels.SILENT))throw"log.setLevel() called with invalid level: "+t;if(n=t,!1!==r&&function(e){var t=(i[e]||"silent").toUpperCase();if("undefined"!=typeof window&&s){try{return void(window.localStorage[s]=t)}catch(r){}try{window.document.cookie=encodeURIComponent(s)+"="+t+";"}catch(r){}}}(t),o.call(a,t,e),"undefined"==typeof console&&t<a.levels.SILENT)return"No console available for logging"},a.setDefaultLevel=function(e){t=e,l()||a.setLevel(e,!1)},a.resetLevel=function(){a.setLevel(t,!1),function(){if("undefined"!=typeof window&&s){try{return void window.localStorage.removeItem(s)}catch(e){}try{window.document.cookie=encodeURIComponent(s)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}()},a.enableAll=function(e){a.setLevel(a.levels.TRACE,e)},a.disableAll=function(e){a.setLevel(a.levels.SILENT,e)};var d=l();null==d&&(d=t),a.setLevel(d,!1)}var d=new l,u={};d.getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=u[e];return t||(t=u[e]=new l(e,d.getLevel(),d.methodFactory)),t};var h="undefined"!=typeof window?window.log:void 0;return d.noConflict=function(){return"undefined"!=typeof window&&window.log===d&&(window.log=h),d},d.getLoggers=function(){return u},d.default=d,d}();var l=window.log;class d{constructor(e,t){this.context=e,this.instant=0,this.mic=null,this.volumeMeterNode=null,this.url=t}connectToSource(e,t,i){return this.context.audioWorklet.addModule(this.url).then(()=>{this.mic=this.context.createMediaStreamSource(e),this.volumeMeterNode=new AudioWorkletNode(this.context,"volume-meter"),this.volumeMeterNode.port.onmessage=e=>{"debug"==e.data.type?l.debug(e.data.message):(this.instant=e.data,t(this.instant.toFixed(2)),l.debug("Audio level: "+this.instant.toFixed(2)))},this.mic.connect(this.volumeMeterNode)}).catch(e=>{throw void 0!==i&&i(e),l.error("Error in soundmeter: "+e),l.error("You may need to define the url of the volume-meter-processor.js"),e})}stop(){null!=this.volumeMeterNode&&(this.volumeMeterNode.port.postMessage("stop"),this.volumeMeterNode.disconnect(),this.volumeMeterNode.port.close(),this.volumeMeterNode=null),null!=this.mic&&(this.mic.disconnect(),this.mic=null)}}function u(){var e=navigator.userAgent||navigator.vendor||window.opera;return/android/i.test(e)}String.prototype.endsWith||(String.prototype.endsWith=function(e,t){var i=this.toString();("number"!=typeof t||!isFinite(t)||Math.floor(t)!==t||t>i.length)&&(t=i.length);var r=i.lastIndexOf(e,t-=e.length);return-1!==r&&r===t});var h=window.log;class m{constructor(e){for(var t in this.bandwidth=1200,this.debug=!1,this.camera_location="top",this.camera_margin=15,this.camera_percent=15,this.mediaConstraints={video:!0,audio:!0},this.getSender=e.getSender,this.publishStreamId=null,this.localStream=null,this.publishMode="camera",this.callback=(e,t)=>{h.debug("Callback info: "+e+" object: "+typeof t!==void 0?JSON.stringify(t):"")},this.callbackError=e=>{h.error(e)},this.volumeMeterUrl="volume-meter-processor.js",e.userParameters)e.userParameters.hasOwnProperty(t)&&(this[t]=e.userParameters[t]);e.callback&&(this.callback=e.callback),e.callbackError&&(this.callbackError=e.callbackError),this.currentVolume=null,this.previousAudioTrack=null,this.silentAudioTrack=null,this.desktopStream=null,this.smallVideoTrack=null,this.blackVideoTrack=null,this.audioContext=new AudioContext,this.oscillator=null,this.primaryAudioTrackGainNode=null,this.secondaryAudioTrackGainNode=null,this.localStreamSoundMeter=null,this.levelCallback=null,this.blackFrameTimer=null,this.desktopCameraCanvasDrawerTimer=null,this.mutedAudioStream=null,this.isMuted=!1,this.meterRefresh=null,this.cameraEnabled=!0,this.replacementStream=null,this.localVideo=this.localVideoElement||document.getElementById(this.localVideoId),this.dummyCanvas=document.createElement("canvas"),this.mediaConstraints?"camera"==this.mediaConstraints.video?this.publishMode="camera":"screen"==this.mediaConstraints.video?this.publishMode="screen":"screen+camera"==this.mediaConstraints.video&&(this.publishMode="screen+camera"):this.mediaConstraints={video:!0,audio:!0},this.checkBrowserScreenShareSupported()}initLocalStream(){return this.checkWebRTCPermissions(),void 0!==this.mediaConstraints.video&&0!=this.mediaConstraints.video?this.openStream(this.mediaConstraints):void 0!==this.mediaConstraints.audio&&0!=this.mediaConstraints.audio?this.navigatorUserMedia({audio:this.mediaConstraints.audio},e=>this.gotStream(e),!0):(h.debug("no media requested, just return an empty stream"),Promise.resolve(null))}checkWebRTCPermissions(){return"WebSocket"in window?void 0===navigator.mediaDevices?(h.debug("Cannot open camera and mic because of unsecure context. Please Install SSL(https)"),void this.callbackError("UnsecureContext")):void(void 0!==navigator.mediaDevices&&null!=navigator.mediaDevices&&null!=navigator.mediaDevices||this.callbackError("getUserMediaIsNotAllowed")):(h.debug("WebSocket not supported."),void this.callbackError("WebSocketNotSupported"))}getDevices(){return navigator.mediaDevices.enumerateDevices().then(e=>{var t=new Array,i=!1,r=!1;return e.forEach(e=>{"audioinput"!=e.kind&&"videoinput"!=e.kind||(t.push(e),"audioinput"==e.kind&&(i=!0),"videoinput"==e.kind&&(r=!0))}),this.callback("available_devices",t),0==i&&null==this.localStream&&(h.debug("Audio input not found"),h.debug("Retrying to get user media without audio"),this.inputDeviceNotFoundLimit<2?0!=r?(this.openStream({video:!0,audio:!1}),this.inputDeviceNotFoundLimit++):(h.debug("Video input not found"),alert("There is no video or audio input")):alert("No input device found, publish is not possible")),t}).catch(e=>{throw h.error("Cannot get devices -> error name: "+e.name+": "+e.message),e})}trackDeviceChange(){navigator.mediaDevices.ondevicechange=()=>{this.getDevices()}}setDesktopwithCameraSource(e,t,i){return this.desktopStream=e,this.navigatorUserMedia({video:!0,audio:!1},r=>{this.smallVideoTrack=r.getVideoTracks()[0];var n=document.createElement("canvas"),a=n.getContext("2d"),o=document.createElement("video");o.srcObject=e,o.play();var s=document.createElement("video");s.srcObject=r,s.play();var c=n.captureStream(15);null!=i&&(e.getVideoTracks()[0].onended=function(e){i(e)}),(null==this.localStream?this.gotStream(c):this.updateVideoTrack(c,t,onended,null)).then(()=>{this.desktopCameraCanvasDrawerTimer=setInterval(()=>{n.width=o.videoWidth,n.height=o.videoHeight,a.drawImage(o,0,0,n.width,n.height);var e=o.videoWidth*(this.camera_percent/100),t=s.videoHeight/s.videoWidth*e;a.drawImage(s,n.width-e-this.camera_margin,"top"==this.camera_location?this.camera_margin:n.height-t-this.camera_margin,e,t)},66)})},!0)}prepareStreamTracks(e,t,i,r){var n=i.getAudioTracks();return n.length>0&&"camera"==this.publishMode&&(n[0].stop(),i.removeTrack(n[0])),"undefined"!=t&&0!=t?this.navigatorUserMedia({audio:t}).then(a=>{a=this.setGainNodeStream(a);var o=t=>{this.callback("screen_share_stopped"),this.setVideoCameraSource(r,e,null,!0)};return"screen"==this.publishMode?this.updateVideoTrack(i,r,o,!0).then(()=>(n.length>0&&(a=this.mixAudioStreams(i,a)),this.updateAudioTrack(a,r,null))):"screen+camera"==this.publishMode?(n.length>0&&(a=this.mixAudioStreams(i,a)),this.updateAudioTrack(a,r,null).then(()=>this.setDesktopwithCameraSource(i,r,o))):(0!=t&&null!=t&&i.addTrack(a.getAudioTracks()[0]),i.getVideoTracks().length>0?this.updateVideoTrack(i,r,null,null).then(()=>this.updateAudioTrack(i,r,null).then(()=>this.gotStream(i))):i.getAudioTracks().length>0?this.updateAudioTrack(i,r,null).then(()=>this.gotStream(i)):this.gotStream(i))}).catch(e=>{throw"NotFoundError"==e.name?this.getDevices():this.callbackError(e.name,e.message),e}):this.gotStream(i)}navigatorUserMedia(e,t,i){if("dummy"==e.video||"dummy"==e.audio){var r=new MediaStream;return"dummy"==e.audio&&r.addTrack(this.getSilentAudioTrack()),"dummy"==e.video&&r.addTrack(this.getBlackVideoTrack()),new Promise((e,t)=>{e(r)})}return navigator.mediaDevices.getUserMedia(e).then(e=>(void 0===t&&null==t||t(e),e)).catch(e=>{throw 1==i?"NotFoundError"==e.name?this.getDevices():this.callbackError(e.name,e.message):h.warn(e),e})}navigatorDisplayMedia(e,t){return navigator.mediaDevices.getDisplayMedia(e).then(e=>(void 0!==t&&t(e),e)).catch(e=>{"NotAllowedError"===e.name&&(h.debug("Permission denied error"),this.callbackError("ScreenSharePermissionDenied"),null==this.localStream?this.openStream({video:!0,audio:!0}):this.switchVideoCameraCapture(streamId))})}getMedia(e,t){var i=!1;return void 0!==e.audio&&0!=e.audio&&(i=e.audio),null!=this.desktopCameraCanvasDrawerTimer&&(clearInterval(this.desktopCameraCanvasDrawerTimer),this.desktopCameraCanvasDrawerTimer=null),"screen+camera"==this.publishMode||"screen"==this.publishMode?this.navigatorDisplayMedia(e).then(r=>(this.smallVideoTrack&&this.smallVideoTrack.stop(),this.prepareStreamTracks(e,i,r,t))):this.navigatorUserMedia(e).then(r=>(this.smallVideoTrack&&this.smallVideoTrack.stop(),this.prepareStreamTracks(e,i,r,t))).catch(e=>{"NotFoundError"==e.name?this.getDevices():this.callbackError(e.name,e.message)})}openStream(e,t){return this.mediaConstraints=e,this.getMedia(e,t).then(()=>{"dummy"!=this.mediaConstraints.video&&null!=this.mediaConstraints.video&&(this.stopBlackVideoTrack(),this.clearBlackVideoTrackTimer()),"dummy"!=this.mediaConstraints.audio&&null!=this.mediaConstraints.audio&&this.stopSilentAudioTrack()})}closeStream(){this.localStream&&(this.localStream.getVideoTracks().forEach((function(e){e.onended=null,e.stop()})),this.localStream.getAudioTracks().forEach((function(e){e.onended=null,e.stop()}))),this.videoTrack&&this.videoTrack.stop(),this.audioTrack&&this.audioTrack.stop(),this.smallVideoTrack&&this.smallVideoTrack.stop(),this.previousAudioTrack&&this.previousAudioTrack.stop()}checkBrowserScreenShareSupported(){(void 0!==navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia||navigator.getDisplayMedia)&&this.callback("browser_screen_share_supported")}enableSecondStreamInMixedAudio(e){null!=this.secondaryAudioTrackGainNode&&(this.secondaryAudioTrackGainNode.gain.value=e?1:0)}gotStream(e){return this.localStream=e,this.localVideo&&(this.localVideo.srcObject=e),this.getDevices(),this.trackDeviceChange(),new Promise((e,t)=>{e()})}changeLocalVideo(e){this.localVideo=e,this.localStream&&(this.localVideo.srcObject=this.localStream)}enableAudioLevelWhenMuted(){return new Promise((e,t)=>{navigator.mediaDevices.getUserMedia({video:!1,audio:!0}).then(i=>{this.mutedAudioStream=i,this.mutedSoundMeter=new d(this.audioContext,this.volumeMeterUrl),this.mutedSoundMeter.connectToSource(this.mutedAudioStream,e=>{e>.1&&this.callback("speaking_but_muted")},i=>{i&&t(i),this.meterRefresh=setInterval(()=>{this.mutedSoundMeter.instant.toFixed(2)>.1&&this.callback("speaking_but_muted")},200),e(null)})}).catch((function(e){h.debug("Can't get the soundlevel on mute"),t(e)}))})}disableAudioLevelWhenMuted(){null!=this.meterRefresh&&(clearInterval(this.meterRefresh),this.meterRefresh=null),null!=this.mutedSoundMeter&&(this.mutedSoundMeter.stop(),this.mutedSoundMeter=null),null!=this.mutedAudioStream&&this.mutedAudioStream.getTracks().forEach((function(e){e.stop()}))}mixAudioStreams(e,t){var i=new MediaStream;e.getVideoTracks().forEach((function(e){i.addTrack(e)}));var r=this.audioContext.createMediaStreamDestination();return e.getAudioTracks().length>0?(this.primaryAudioTrackGainNode=this.audioContext.createGain(),this.primaryAudioTrackGainNode.gain.value=1,this.audioContext.createMediaStreamSource(e).connect(this.primaryAudioTrackGainNode).connect(r)):h.debug("Origin stream does not have audio track"),t.getAudioTracks().length>0?(this.secondaryAudioTrackGainNode=this.audioContext.createGain(),this.secondaryAudioTrackGainNode.gain.value=1,this.audioContext.createMediaStreamSource(t).connect(this.secondaryAudioTrackGainNode).connect(r)):h.debug("Second stream does not have audio track"),r.stream.getAudioTracks().forEach((function(e){i.addTrack(e),h.debug("audio destination add track")})),i}setGainNodeStream(e){if(0!=this.mediaConstraints.audio&&void 0!==this.mediaConstraints.audio){var t=e.getVideoTracks(),i=e.getAudioTracks();this.audioContext=new AudioContext;var r=this.audioContext.createMediaStreamSource(e),n=this.audioContext.createMediaStreamDestination();this.primaryAudioTrackGainNode=this.audioContext.createGain(),r.connect(this.primaryAudioTrackGainNode),this.primaryAudioTrackGainNode.connect(n),this.primaryAudioTrackGainNode.gain.value=null==this.currentVolume?1:this.currentVolume;var a=n.stream;for(var o of t)a.addTrack(o);for(var s of i)a.addTrack(s);return null!==this.previousAudioTrack&&this.previousAudioTrack.stop(),this.previousAudioTrack=a.getAudioTracks()[1],a}return e}switchDesktopCapture(e){return this.publishMode="screen",void 0!==this.mediaConstraints.video&&0!=this.mediaConstraints.video&&(this.mediaConstraints.video=!0),this.getMedia(this.mediaConstraints,e)}switchDesktopCaptureWithCamera(e){return void 0!==this.mediaConstraints.video&&0!=this.mediaConstraints.video&&(this.mediaConstraints.video=!0),this.publishMode="screen+camera",this.getMedia(this.mediaConstraints,e)}updateLocalAudioStream(e,t){var i=e.getAudioTracks()[0];if(null!=this.localStream&&null!=this.localStream.getAudioTracks()[0]){var r=this.localStream.getAudioTracks()[0];r!=i&&(this.localStream.removeTrack(r),r.stop(),this.localStream.addTrack(i))}else null!=this.localStream?this.localStream.addTrack(i):this.localStream=e;null!=this.localVideo&&(this.localVideo.srcObject=this.localStream),null!=t&&(e.getAudioTracks()[0].onended=function(e){t(e)}),this.isMuted?this.muteLocalMic():this.unmuteLocalMic(),null!=this.localStreamSoundMeter&&this.enableAudioLevelForLocalStream(this.levelCallback)}updateLocalVideoStream(e,t,i){i&&null!=this.desktopStream&&this.desktopStream.getVideoTracks()[0].stop();var r=e.getVideoTracks()[0];if(null!=this.localStream&&null!=this.localStream.getVideoTracks()[0]){var n=this.localStream.getVideoTracks()[0];n!=r&&(this.localStream.removeTrack(n),n.stop(),this.localStream.addTrack(r))}else null!=this.localStream?this.localStream.addTrack(r):this.localStream=e;this.localVideo&&(this.localVideo.srcObject=this.localStream),null!=t&&(e.getVideoTracks()[0].onended=function(e){t(e)})}switchAudioInputSource(e,t){var i=this.localStream.getAudioTracks()[0];return i&&u()&&i.stop(),void 0===i&&h.warn("There is no audio track in local stream"),void 0!==t?(!0!==this.mediaConstraints.audio?this.mediaConstraints.audio.deviceId=t:this.mediaConstraints.audio={deviceId:t},this.setAudioInputSource(e,{video:!1,audio:{deviceId:t}},null,t)):new Promise((e,t)=>{t("There is no device id for audio input source")})}setAudioInputSource(e,t,i){return this.navigatorUserMedia(t,r=>(r=this.setGainNodeStream(r),this.updateAudioTrack(r,e,t,i)),!0)}checkAndStopLocalVideoTrackOnAndroid(){this.localStream&&this.localStream.getVideoTracks().length>0&&u()&&this.localStream.getVideoTracks()[0].stop(),null!==this.localStream&&0!==this.localStream.getVideoTracks().length||h.warn("There is no video track in local stream")}switchVideoCameraCapture(e,t,i){return this.checkAndStopLocalVideoTrackOnAndroid(),this.publishMode="camera",navigator.mediaDevices.enumerateDevices().then(r=>{for(var n=0;n<r.length;n++)if("videoinput"==r[n].kind&&r[n].deviceId==t){!0!==this.mediaConstraints.video?this.mediaConstraints.video.deviceId={exact:t}:this.mediaConstraints.video={deviceId:{exact:t}};break}return h.debug("Given deviceId = "+t+" - Media constraints video property = "+this.mediaConstraints.video),this.setVideoCameraSource(e,this.mediaConstraints,i,!0,t)})}setVideoCameraSource(e,t,i,r){return this.navigatorUserMedia(t,n=>(r&&this.secondaryAudioTrackGainNode&&n.getAudioTracks().length>0&&(this.secondaryAudioTrackGainNode=null,n=this.setGainNodeStream(n),this.updateAudioTrack(n,e,t,i)),this.cameraEnabled?this.updateVideoTrack(n,e,i,r):this.turnOffLocalCamera()),!0)}switchVideoCameraFacingMode(e,t){this.checkAndStopLocalVideoTrackOnAndroid(),void 0!==this.mediaConstraints.video&&void 0!==this.mediaConstraints.video.deviceId&&delete this.mediaConstraints.video.deviceId;var i={facingMode:t};return this.mediaConstraints.video=Object(r._)({},this.mediaConstraints.video,i),this.publishMode="camera",h.debug("Media constraints video property = "+this.mediaConstraints.video),this.setVideoCameraSource(e,{video:this.mediaConstraints.video},null,!0)}updateAudioTrack(e,t,i){var r=this.getSender(t,"audio");return r?r.replaceTrack(e.getAudioTracks()[0]).then(t=>{this.updateLocalAudioStream(e,i)}).catch((function(e){throw h.debug(e.name),e})):(this.updateLocalAudioStream(e,i),new Promise((e,t)=>{e()}))}updateVideoTrack(e,t,i,r){var n=this.getSender(t,"video");return n?n.replaceTrack(e.getVideoTracks()[0]).then(t=>{this.updateLocalVideoStream(e,i,r)}).catch(e=>{h.debug(e.name)}):(this.updateLocalVideoStream(e,i,r),new Promise((e,t)=>{e()}))}getBlackVideoTrack(){return this.dummyCanvas.getContext("2d").fillRect(0,0,320,240),this.replacementStream=this.dummyCanvas.captureStream(),null==this.blackFrameTimer&&(this.blackFrameTimer=setInterval(()=>{this.getBlackVideoTrack()},3e3)),this.blackVideoTrack=this.replacementStream.getVideoTracks()[0],this.blackVideoTrack}getSilentAudioTrack(){this.stopSilentAudioTrack(),this.oscillator=this.audioContext.createOscillator();var e=this.oscillator.connect(this.audioContext.createMediaStreamDestination());return this.oscillator.start(),this.silentAudioTrack=e.stream.getAudioTracks()[0],this.silentAudioTrack}stopSilentAudioTrack(){null!=this.oscillator&&(this.oscillator.stop(),this.oscillator.disconnect(),this.oscillator=null),null!=this.silentAudioTrack&&(this.silentAudioTrack.stop(),this.silentAudioTrack=null)}turnOffLocalCamera(e){var t;return this.getBlackVideoTrack(),null!=this.localStream?(t=null!=e||void 0!==e?e:this.publishStreamId,this.cameraEnabled=!1,this.updateVideoTrack(this.replacementStream,t,null,!0)):new Promise((e,t)=>{this.callbackError("NoActiveConnection"),t("NoActiveStream")})}clearBlackVideoTrackTimer(){null!=this.blackFrameTimer&&(clearInterval(this.blackFrameTimer),this.blackFrameTimer=null)}stopBlackVideoTrack(){null!=this.blackVideoTrack&&(this.blackVideoTrack.stop(),this.blackVideoTrack=null)}turnOnLocalCamera(e){return this.clearBlackVideoTrackTimer(),this.stopBlackVideoTrack(),this.navigatorUserMedia(this.mediaConstraints,null==this.localStream?e=>{this.gotStream(e)}:t=>{var i;i=null!=e||void 0!==e?e:this.publishStreamId,this.cameraEnabled=!0,this.updateVideoTrack(t,i,null,!0)},!1)}muteLocalMic(){this.isMuted=!0,null!=this.localStream?this.localStream.getAudioTracks().forEach(e=>e.enabled=!1):this.callbackError("NoActiveConnection")}unmuteLocalMic(){this.isMuted=!1,null!=this.localStream?this.localStream.getAudioTracks().forEach(e=>e.enabled=!0):this.callbackError("NoActiveConnection")}getVideoSender(e){var t=null;return"undefined"!=typeof adapter&&null!==adapter&&("chrome"===adapter.browserDetails.browser||"firefox"===adapter.browserDetails.browser||"safari"===adapter.browserDetails.browser&&adapter.browserDetails.version>=64)&&"RTCRtpSender"in window&&"setParameters"in window.RTCRtpSender.prototype&&(t=this.getSender(e,"video")),t}changeBandwidth(e,t){var i=this.getVideoSender(t);if(null!=i){var r=i.getParameters();return r.encodings||(r.encodings=[{}]),"unlimited"===e?delete r.encodings[0].maxBitrate:r.encodings[0].maxBitrate=1e3*e,i.setParameters(r)}return Promise.reject("Video sender not found to change bandwidth. Streaming may not be active")}setVolumeLevel(e){this.currentVolume=e,null!=this.primaryAudioTrackGainNode&&(this.primaryAudioTrackGainNode.gain.value=e),null!=this.secondaryAudioTrackGainNode&&(this.secondaryAudioTrackGainNode.gain.value=e)}enableAudioLevelForLocalStream(e){return this.levelCallback=e,this.disableAudioLevelForLocalStream(),this.localStreamSoundMeter=new d(this.audioContext,this.volumeMeterUrl),"running"!==this.audioContext.state?this.audioContext.resume().then(()=>this.localStreamSoundMeter.connectToSource(this.localStream,e)):this.localStreamSoundMeter.connectToSource(this.localStream,e)}disableAudioLevelForLocalStream(){null!=this.localStreamSoundMeter&&(this.localStreamSoundMeter.stop(),this.localStreamSoundMeter=null)}applyConstraints(e){var t={};void 0===e.audio&&void 0===e.video?(t.video=e,this.mediaConstraints.video=Object(r._)({},this.mediaConstraints.video,t.video)):void 0!==e.video&&(t.video=e.video,this.mediaConstraints.video=Object(r._)({},this.mediaConstraints.video,t.video)),void 0!==e.audio&&(t.audio=e.audio,this.mediaConstraints.audio=Object(r._)({},this.mediaConstraints.audio,t.audio));var i=null;return void 0!==t.video&&(i=this.localStream&&this.localStream.getVideoTracks().length>0?this.localStream.getVideoTracks()[0].applyConstraints(this.mediaConstraints.video):new Promise((e,t)=>{t("There is no video track to apply constraints")})),void 0!==t.audio&&(i=this.setAudioInputSource(this.publishStreamId,{audio:this.mediaConstraints.audio},null)),null!=this.localStreamSoundMeter&&this.enableAudioLevelForLocalStream(this.levelCallback),i}}function f(e,t,i,r,n,a,o){try{var s=e[a](o),c=s.value}catch(l){return void i(l)}s.done?t(c):Promise.resolve(c).then(r,n)}function p(e){return function(){var t=this,i=arguments;return new Promise((function(r,n){var a=e.apply(t,i);function o(e){f(a,r,n,o,s,"next",e)}function s(e){f(a,r,n,o,s,"throw",e)}o(void 0)}))}}function v(e,t,i){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function g(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}function b(e,t,i){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return i}function y(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}class S{constructor(e){this.streamId=e,this.totalBytesReceivedCount=0,this.totalBytesSent=0,this.videoPacketsLost=0,this.fractionLost=0,this.startTime=0,this.lastFramesEncoded=0,this.totalFramesEncodedCount=0,this.lastBytesReceived=0,this.lastBytesSent=0,this.totalVideoPacketsSent=0,this.totalAudioPacketsSent=0,this.currentTimestamp=0,this.lastTime=0,this.timerId=0,this.firstByteSentCount=0,this.firstBytesReceivedCount=0,this.audioLevel=-1,this.qualityLimitationReason="",this.resWidth=0,this.resHeight=0,this.srcFps=0,this.frameWidth=0,this.frameHeight=0,this.videoRoundTripTime=0,this.videoJitter=0,this.audioRoundTripTime=0,this.audioJitter=0,this.audioPacketsLost=0,this.framesReceived=0,this.framesDropped=0,this.framesDecoded=0,this.audioJitterAverageDelay=0,this.videoJitterAverageDelay=0,this.availableOutgoingBitrate=1/0,this.inboundRtpList=[]}get averageOutgoingBitrate(){return Math.floor(8*(this.totalBytesSentCount-this.firstByteSentCount)/(this.currentTimestamp-this.startTime))}get currentFPS(){return((this.totalFramesEncodedCount-this.lastFramesEncoded)/(this.currentTimestamp-this.lastTime)*1e3).toFixed(1)}get averageIncomingBitrate(){return Math.floor(8*(this.totalBytesReceivedCount-this.firstBytesReceivedCount)/(this.currentTimestamp-this.startTime))}get currentOutgoingBitrate(){return Math.floor(8*(this.totalBytesSentCount-this.lastBytesSent)/(this.currentTimestamp-this.lastTime))}get currentIncomingBitrate(){return Math.floor(8*(this.totalBytesReceivedCount-this.lastBytesReceived)/(this.currentTimestamp-this.lastTime))}set currentTime(e){this.lastTime=this.currentTimestamp,this.currentTimestamp=e,0==this.startTime&&(this.startTime=e-1)}set totalBytesReceived(e){this.lastBytesReceived=this.totalBytesReceivedCount,this.totalBytesReceivedCount=e,0==this.firstBytesReceivedCount&&(this.firstBytesReceivedCount=e)}set totalBytesSent(e){this.lastBytesSent=this.totalBytesSentCount,this.totalBytesSentCount=e,0==this.firstByteSentCount&&(this.firstByteSentCount=e)}set totalFramesEncoded(e){this.lastFramesEncoded=this.totalFramesEncodedCount,this.totalFramesEncodedCount=e,0==this.lastFramesEncoded&&(this.lastFramesEncoded=e)}}var w=window.log;class C{constructor(e){for(var t in this.debug=!1,e)e.hasOwnProperty(t)&&(this[t]=e[t]);this.initWebSocketConnection(),addEventListener("offline",e=>{this.connected=!1,this.connecting=!1,w.info("Network status has changed to offline. Resetting flags to reconnect faster")})}initWebSocketConnection(e){this.connecting=!0,this.connected=!1,this.pingTimerId=-1;var t=new URL(this.websocket_url);["origin","edge"].includes(t.searchParams.get("target"))||(t.searchParams.set("target",this.webrtcadaptor.isPlayMode?"edge":"origin"),this.websocket_url=t.toString()),this.wsConn=new WebSocket(this.websocket_url),this.wsConn.onopen=()=>{this.debug&&w.debug("websocket connected"),this.pingTimerId=setInterval(()=>{this.sendPing()},3e3),this.connected=!0,this.connecting=!1,this.callback("initialized"),void 0!==e&&e()},this.wsConn.onmessage=e=>{var t=JSON.parse(e.data);"start"==t.command?(this.debug&&w.debug("received start command"),this.webrtcadaptor.startPublishing(t.streamId)):"takeCandidate"==t.command?(this.debug&&(w.debug("received ice candidate for stream id "+t.streamId),w.debug(t.candidate)),this.webrtcadaptor.takeCandidate(t.streamId,t.label,t.candidate)):"takeConfiguration"==t.command?(this.debug&&w.debug("received remote description type for stream id: "+t.streamId+" type: "+t.type),this.webrtcadaptor.takeConfiguration(t.streamId,t.sdp,t.type,t.idMapping)):"stop"==t.command?(this.debug&&w.debug("Stop command received"),this.webrtcadaptor.closePeerConnection(t.streamId)):"error"==t.command?this.callbackError(t.definition,t):"notification"==t.command?this.callback(t.definition,t):"streamInformation"==t.command||"roomInformation"==t.command?this.callback(t.command,t):"pong"==t.command?this.callback(t.command):"trackList"==t.command?this.callback(t.command,t):"connectWithNewId"==t.command?(this.multiPeerStreamId=t.streamId,this.join(t.streamId)):"peerMessageCommand"==t.command&&this.callback(t.command,t)},this.wsConn.onerror=e=>{this.connecting=!1,this.connected=!1,w.info(" error occured: "+JSON.stringify(e)),this.clearPingTimer(),this.callbackError("WebSocketNotConnected",e)},this.wsConn.onclose=e=>{this.connecting=!1,this.connected=!1,this.debug&&w.debug("connection closed."),this.clearPingTimer(),this.callback("closed",e)}}clearPingTimer(){-1!=this.pingTimerId&&(this.debug&&w.debug("Clearing ping message timer"),clearInterval(this.pingTimerId),this.pingTimerId=-1)}sendPing(){this.wsConn.send(JSON.stringify({command:"ping"}))}close(){this.wsConn.close()}send(e){if(0!=this.connecting||0!=this.connected)try{this.wsConn.send(e),this.debug&&w.debug("sent message:"+e)}catch(t){w.warn("Cannot send message:"+e)}else this.initWebSocketConnection(()=>{this.send(e)})}isConnected(){return this.connected}isConnecting(){return this.connecting}}var k=window.log;class T{constructor(e){this.size=e,this.received=0,this.data=new ArrayBuffer(e)}}class A{static register(e){A.pluginInitMethods.push(e)}constructor(e){for(var t in this.peerconnection_config={iceServers:[{urls:"stun:stun1.l.google.com:19302"}],sdpSemantics:"unified-plan"},this.sdp_constraints={OfferToReceiveAudio:!1,OfferToReceiveVideo:!1},this.remotePeerConnection=new Array,this.remotePeerConnectionStats=new Array,this.remoteDescriptionSet=new Array,this.iceCandidateList=new Array,this.roomName=null,this.playStreamId=new Array,this.isMultiPeer=!1,this.multiPeerStreamId=null,this.webSocketAdaptor=null,this.isPlayMode=!1,this.debug=!1,this.publishStreamId=null,this.idMapping=new Array,this.onlyDataChannel=!1,this.dataChannelEnabled=!0,this.receivingMessages=new Map,this.candidateTypes=["udp","tcp"],this.callback=null,this.callbackError=null,this.reconnectIfRequiredFlag=!0,this.websocket_url=null,this.websocketURL=null,this.initializeComponents=!0,this.degradationPreference="maintain-resolution",e)e.hasOwnProperty(t)&&(this[t]=e[t]);if(null==this.websocketURL&&(this.websocketURL=this.websocket_url),null==this.websocketURL)throw new Error("WebSocket URL is not defined. It's mandatory");this.remoteVideo=this.remoteVideoElement||document.getElementById(this.remoteVideoId),this.soundMeters=new Array,this.soundLevelList=new Array,this.eventListeners=new Array,this.errorEventListeners=new Array,this.publishToken=null,this.publishSubscriberId=null,this.publishSubscriberCode=null,this.publishStreamName=null,this.publishMainTrack=null,this.publishMetaData=null,this.publishRole=null,this.playToken=null,this.playRoomId=null,this.playEnableTracks=null,this.playSubscriberId=null,this.playSubscriberCode=null,this.playMetaData=null,this.playRole=null,this.lastReconnectiontionTrialTime=0,this.mediaManager=new m({userParameters:e,webRTCAdaptor:this,callback:(e,t)=>{this.notifyEventListeners(e,t)},callbackError:(e,t)=>{this.notifyErrorEventListeners(e,t)},getSender:(e,t)=>this.getSender(e,t)}),this.initializeComponents&&this.initialize()}initPlugins(){A.pluginInitMethods.forEach(e=>{e(this)})}addEventListener(e){this.eventListeners.push(e)}addErrorEventListener(e){this.errorEventListeners.push(e)}notifyEventListeners(e,t){this.eventListeners.forEach(i=>{i(e,t)}),null!=this.callback&&this.callback(e,t)}notifyErrorEventListeners(e,t){this.errorEventListeners.forEach(i=>{i(e,t)}),null!=this.callbackError&&this.callbackError(e,t)}initialize(){return this.isPlayMode||this.onlyDataChannel||null!=this.mediaManager.localStream?new Promise((e,t)=>{this.initPlugins(),this.checkWebSocketConnection(),e("Wait 'initialized' callback from websocket")}):this.mediaManager.initLocalStream().then(()=>(this.initPlugins(),this.checkWebSocketConnection(),new Promise((e,t)=>{e("Wait 'initialized' callback from websocket")}))).catch(e=>{throw k.warn(e),e})}publish(e,t,i,r,n,a,o,s){if(this.publishStreamId=e,this.mediaManager.publishStreamId=e,this.publishToken=t,this.publishSubscriberId=i,this.publishSubscriberCode=r,this.publishStreamName=n,this.publishMainTrack=a,this.publishMetaData=o,this.publishRole=s,this.onlyDataChannel)this.sendPublishCommand(e,t,i,r,n,a,o,s,!1,!1);else if(null==this.mediaManager.localStream)this.mediaManager.initLocalStream().then(()=>{var c=!1,l=!1;null!=this.mediaManager.localStream&&(c=this.mediaManager.localStream.getVideoTracks().length>0,l=this.mediaManager.localStream.getAudioTracks().length>0),this.sendPublishCommand(e,t,i,r,n,a,o,s,c,l)}).catch(e=>{throw k.warn(e),e});else{var c=this.mediaManager.localStream.getVideoTracks().length>0,l=this.mediaManager.localStream.getAudioTracks().length>0;this.sendPublishCommand(e,t,i,r,n,a,o,s,c,l)}this.initPeerConnection(e,"publish"),setTimeout(()=>{"checking"!=this.iceConnectionState(this.publishStreamId)&&"connected"!=this.iceConnectionState(this.publishStreamId)&&"completed"!=this.iceConnectionState(this.publishStreamId)&&this.reconnectIfRequired(0)},3e3)}sendPublishCommand(e,t,i,r,n,a,o,s,c,l){this.webSocketAdaptor.send(JSON.stringify({command:"publish",streamId:e,token:t,subscriberId:void 0!==typeof i&&null!=i?i:"",subscriberCode:void 0!==typeof r&&null!=r?r:"",streamName:void 0!==typeof n&&null!=n?n:"",mainTrack:void 0!==typeof a&&null!=a?a:"",video:c,audio:l,metaData:void 0!==typeof o&&null!=o?o:"",role:void 0!==typeof s&&null!=s?s:""}))}joinRoom(e,t,i){this.roomName=e,this.webSocketAdaptor.send(JSON.stringify({command:"joinRoom",room:e,streamId:t,mode:i}))}play(e,t,i,r,n,a,o,s){this.playStreamId.push(e),this.playToken=t,this.playRoomId=i,this.playEnableTracks=r,this.playSubscriberId=n,this.playSubscriberCode=a,this.playMetaData=o,this.playRole=s,this.webSocketAdaptor.send(JSON.stringify({command:"play",streamId:e,token:void 0!==typeof t&&null!=t?t:"",room:void 0!==typeof i&&null!=i?i:"",trackList:void 0!==typeof r&&null!=r?r:[],subscriberId:void 0!==typeof n&&null!=n?n:"",subscriberCode:void 0!==typeof a&&null!=n?a:"",viewerInfo:void 0!==typeof o&&null!=o?o:"",role:void 0!==typeof s&&null!=s?s:""})),this.initPeerConnection(e,"play"),setTimeout(()=>{"checking"!=this.iceConnectionState(e)&&"connected"!=this.iceConnectionState(e)&&"completed"!=this.iceConnectionState(e)&&this.reconnectIfRequired(0)},3e3)}reconnectIfRequired(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3e3;this.reconnectIfRequiredFlag&&(e>0?setTimeout(()=>{this.tryAgain()},e):this.tryAgain())}tryAgain(){var e=this,t=Date.now();if(!(t-this.lastReconnectiontionTrialTime<3e3)){this.lastReconnectiontionTrialTime=t,null!=this.remotePeerConnection[this.publishStreamId]&&"checking"!=this.iceConnectionState(this.publishStreamId)&&"connected"!=this.iceConnectionState(this.publishStreamId)&&"completed"!=this.iceConnectionState(this.publishStreamId)&&(this.notifyEventListeners("reconnection_attempt_for_publisher",this.publishStreamId),this.stop(this.publishStreamId),setTimeout(()=>{k.log("Trying publish again for stream: "+this.publishStreamId),this.publish(this.publishStreamId,this.publishToken,this.publishSubscriberId,this.publishSubscriberCode,this.publishStreamName,this.publishMainTrack,this.publishMetaData,this.publishRole)},500));var i=function(){var t=e.playStreamId[r];"null"!=e.remotePeerConnection[t]&&"checking"!=e.iceConnectionState(t)&&"connected"!=e.iceConnectionState(t)&&"completed"!=e.iceConnectionState(t)&&(e.notifyEventListeners("reconnection_attempt_for_player",t),k.log("It will try to play again for stream: "+t+" because it is not stopped on purpose"),e.stop(t),setTimeout(()=>{k.log("Trying play again for stream: "+t),e.play(t,e.playToken,e.playRoomId,e.playEnableTracks,e.playSubscriberId,e.playSubscriberCode,e.playMetaData,e.playRole)},500))};for(var r in this.playStreamId)i()}}stop(e){this.closePeerConnection(e),null!=this.webSocketAdaptor&&this.webSocketAdaptor.isConnected()&&this.webSocketAdaptor.send(JSON.stringify({command:"stop",streamId:e}))}join(e){this.webSocketAdaptor.send(JSON.stringify({command:"join",streamId:e,multiPeer:this.isMultiPeer&&null==this.multiPeerStreamId,mode:this.isPlayMode?"play":"both"}))}onTrack(e,t){if(k.debug("onTrack for stream"),null!=this.remoteVideo)this.remoteVideo.srcObject!==e.streams[0]&&(this.remoteVideo.srcObject=e.streams[0],k.debug("Received remote stream"));else{var i={stream:e.streams[0],track:e.track,streamId:t,trackId:this.idMapping[t][e.transceiver.mid]};this.notifyEventListeners("newTrackAvailable",i),this.notifyEventListeners("newStreamAvailable",i)}}leaveFromRoom(e){for(var t in this.remotePeerConnection)this.closePeerConnection(t);this.roomName=e;var i={command:"leaveFromRoom",room:e};k.debug("leave request is sent for "+e),this.webSocketAdaptor.send(JSON.stringify(i))}leave(e){this.webSocketAdaptor.send(JSON.stringify({command:"leave",streamId:this.isMultiPeer&&null!=this.multiPeerStreamId?this.multiPeerStreamId:e})),this.closePeerConnection(e),this.multiPeerStreamId=null}getStreamInfo(e){this.webSocketAdaptor.send(JSON.stringify({command:"getStreamInfo",streamId:e}))}requestVideoTrackAssignments(e){this.webSocketAdaptor.send(JSON.stringify({command:"getVideoTrackAssignmentsCommand",streamId:e}))}getBroadcastObject(e){this.webSocketAdaptor.send(JSON.stringify({command:"getBroadcastObject",streamId:e}))}updateStreamMetaData(e,t){this.webSocketAdaptor.send(JSON.stringify({command:"updateStreamMetaData",streamId:e,metaData:t}))}getRoomInfo(e,t){this.webSocketAdaptor.send(JSON.stringify({command:"getRoomInfo",streamId:t,room:e}))}getSubtracks(e,t,i,r){this.webSocketAdaptor.send(JSON.stringify({command:"getSubtracks",streamId:e,role:t,offset:i,size:r}))}enableTrack(e,t,i){this.webSocketAdaptor.send(JSON.stringify({command:"enableTrack",streamId:e,trackId:t,enabled:i}))}getTracks(e,t){this.playStreamId.push(e),this.webSocketAdaptor.send(JSON.stringify({command:"getTrackList",streamId:e,token:t}))}iceCandidateReceived(e,t){if(e.candidate){var i=!1;if(""==e.candidate.candidate?i=!0:void 0===e.candidate.protocol?this.candidateTypes.forEach(t=>{e.candidate.candidate.toLowerCase().includes(t)&&(i=!0)}):i=this.candidateTypes.includes(e.candidate.protocol.toLowerCase()),i){var r={command:"takeCandidate",streamId:t,label:e.candidate.sdpMLineIndex,id:e.candidate.sdpMid,candidate:e.candidate.candidate};this.debug&&(k.debug("sending ice candiate for stream Id "+t),k.debug(JSON.stringify(e.candidate))),this.webSocketAdaptor.send(JSON.stringify(r))}else k.debug("Candidate's protocol(full sdp: "+e.candidate.candidate+") is not supported. Supported protocols: "+this.candidateTypes),""!=e.candidate.candidate&&this.notifyErrorEventListeners("protocol_not_supported","Support protocols: "+this.candidateTypes.toString()+" candidate: "+e.candidate.candidate)}else k.debug("No event.candidate in the iceCandidate event")}sanitizeHTML(e){return e.includes("script")?e.replace(/</g,"&lt;").replace(/>/g,"&gt;"):e}initDataChannel(e,t){t.onerror=i=>{k.debug("Data Channel Error:",i);var r={streamId:e,error:i};k.debug("channel status: ",t.readyState),"closed"!=t.readyState&&this.notifyErrorEventListeners("data_channel_error",r)},t.onmessage=t=>{var i={streamId:e,data:t.data},r=i.data;if("string"==typeof r||r instanceof String)i.data=this.sanitizeHTML(i.data),this.notifyEventListeners("data_received",i);else{var n=r.length||r.size||r.byteLength,a=(s=new Int32Array(r,0,1))[0],o=this.receivingMessages[a];if(null==o){var s=new Int32Array(r,0,2);return o=new T(s[1]),this.receivingMessages[a]=o,void(n>8&&k.debug("something went wrong in msg receiving"))}var c=r.slice(4,n);new Uint8Array(o.data).set(new Uint8Array(c),o.received,n-4),o.received+=n-4,o.size==o.received&&(i.data=o.data,this.notifyEventListeners("data_received",i))}},t.onopen=()=>{this.remotePeerConnection[e].dataChannel=t,k.debug("Data channel is opened"),this.notifyEventListeners("data_channel_opened",e)},t.onclose=()=>{k.debug("Data channel is closed"),this.notifyEventListeners("data_channel_closed",e)}}initPeerConnection(e,t){if(null==this.remotePeerConnection[e]){var i=e;if(k.debug("stream id in init peer connection: "+e+" close stream id: "+i),this.remotePeerConnection[e]=new RTCPeerConnection(this.peerconnection_config),this.remoteDescriptionSet[e]=!1,this.iceCandidateList[e]=new Array,this.playStreamId.includes(e)||null!=this.mediaManager.localStream&&this.mediaManager.localStream.getTracks().forEach(t=>{var i=this.remotePeerConnection[e].addTrack(t,this.mediaManager.localStream);if("video"==t.kind){var r=i.getParameters();r.degradationPreference=this.degradationPreference,i.setParameters(r).then(()=>{k.info("Degradation Preference is set to "+this.degradationPreference)}).catch(e=>{k.warn("Degradation Preference cannot be set to "+this.degradationPreference)})}}),this.remotePeerConnection[e].onicecandidate=e=>{this.iceCandidateReceived(e,i)},this.remotePeerConnection[e].ontrack=e=>{this.onTrack(e,i)},this.remotePeerConnection[e].onnegotiationneeded=e=>{k.debug("onnegotiationneeded")},this.dataChannelEnabled)if("publish"==t)if(this.remotePeerConnection[e].createDataChannel){var r=this.remotePeerConnection[e].createDataChannel(e,{ordered:!0});this.initDataChannel(e,r)}else k.warn("CreateDataChannel is not supported");else if("play"==t)this.remotePeerConnection[e].ondatachannel=t=>{this.initDataChannel(e,t.channel)};else if(this.remotePeerConnection[e].createDataChannel){var n=this.remotePeerConnection[e].createDataChannel(e,{ordered:!0});this.initDataChannel(e,n),this.remotePeerConnection[e].ondatachannel=t=>{this.initDataChannel(e,t.channel)}}else k.warn("CreateDataChannel is not supported");this.remotePeerConnection[e].oniceconnectionstatechange=t=>{var i={state:this.remotePeerConnection[e].iceConnectionState,streamId:e};"failed"!=i.state&&"disconnected"!=i.state&&"closed"!=i.state||this.reconnectIfRequired(3e3),this.notifyEventListeners("ice_connection_state_changed",i),this.isPlayMode||this.playStreamId.includes(e)||"connected"==this.remotePeerConnection[e].iceConnectionState&&this.mediaManager.changeBandwidth(this.mediaManager.bandwidth,e).then(()=>{k.debug("Bandwidth is changed to "+this.mediaManager.bandwidth)}).catch(e=>k.warn(e))}}return this.remotePeerConnection[e]}closePeerConnection(e){var t=this.remotePeerConnection[e];if(null!=t){this.remotePeerConnection[e]=null,delete this.remotePeerConnection[e],null!=t.dataChannel&&t.dataChannel.close(),"closed"!=t.signalingState&&t.close();var i=this.playStreamId.indexOf(e);-1!=i&&this.playStreamId.splice(i,1)}null!=this.remotePeerConnectionStats[e]&&(clearInterval(this.remotePeerConnectionStats[e].timerId),delete this.remotePeerConnectionStats[e]),null!=this.soundMeters[e]&&delete this.soundMeters[e]}signallingState(e){return null!=this.remotePeerConnection[e]?this.remotePeerConnection[e].signalingState:null}iceConnectionState(e){return null!=this.remotePeerConnection[e]?this.remotePeerConnection[e].iceConnectionState:null}gotDescription(e,t){this.remotePeerConnection[t].setLocalDescription(e).then(i=>{k.debug("Set local description successfully for stream Id "+t);var r={command:"takeConfiguration",streamId:t,type:e.type,sdp:e.sdp};k.debug("setLocalDescription:"+e.sdp),this.webSocketAdaptor.send(JSON.stringify(r))}).catch(e=>{k.error("Cannot set local description. Error is: "+e)})}takeConfiguration(e,t,i,r){var n=e,a=i,o=t,s="offer"==a,c="publish";s&&(c="play"),this.idMapping[n]=r,this.initPeerConnection(n,c),k.debug("setRemoteDescription:"+o),this.remotePeerConnection[n].setRemoteDescription(new RTCSessionDescription({sdp:o,type:a})).then(e=>{this.debug&&(k.debug("set remote description is succesfull with response: "+e+" for stream : "+n+" and type: "+a),k.debug(o)),this.remoteDescriptionSet[n]=!0;var t=this.iceCandidateList[n].length;k.debug("Ice candidate list size to be added: "+t);for(var i=0;i<t;i++)this.addIceCandidate(n,this.iceCandidateList[n][i]);this.iceCandidateList[n]=[],s&&(k.debug("try to create answer for stream id: "+n),this.remotePeerConnection[n].createAnswer(this.sdp_constraints).then(e=>{k.debug("created answer for stream id: "+n),e.sdp=e.sdp.replace("useinbandfec=1","useinbandfec=1; stereo=1"),this.gotDescription(e,n)}).catch(e=>{k.error("create answer error :"+e)}))}).catch(e=>{this.debug&&k.error("set remote description is failed with error: "+e),(e.toString().indexOf("InvalidAccessError")>-1||e.toString().indexOf("setRemoteDescription")>-1)&&this.notifyErrorEventListeners("notSetRemoteDescription")})}takeCandidate(e,t,i){var r=e,n=i,a=new RTCIceCandidate({sdpMLineIndex:t,candidate:n});this.initPeerConnection(r,"peer"),k.debug("takeCandidate:"+n),1==this.remoteDescriptionSet[r]?this.addIceCandidate(r,a):(k.debug("Ice candidate is added to list because remote description is not set yet"),this.iceCandidateList[r].push(a))}addIceCandidate(e,t){var i=!1;""==t.candidate?i=!0:void 0===t.protocol?this.candidateTypes.forEach(e=>{t.candidate.toLowerCase().includes(e)&&(i=!0)}):i=this.candidateTypes.includes(t.protocol.toLowerCase()),i?this.remotePeerConnection[e].addIceCandidate(t).then(t=>{this.debug&&k.debug("Candidate is added for stream "+e)}).catch(i=>{k.error("ice candiate cannot be added for stream id: "+e+" error is: "+i),k.error(t)}):this.debug&&k.debug("Candidate's protocol("+t.protocol+") is not supported.Candidate: "+t.candidate+" Supported protocols:"+this.candidateTypes)}startPublishing(e){var t=e;this.initPeerConnection(t,"publish").createOffer(this.sdp_constraints).then(e=>{this.gotDescription(e,t)}).catch(e=>{k.error("create offer error for stream id: "+t+" error: "+e)})}toggleVideo(e,t,i){this.webSocketAdaptor.send(JSON.stringify({command:"toggleVideo",streamId:e,trackId:t,enabled:i}))}toggleAudio(e,t,i){this.webSocketAdaptor.send(JSON.stringify({command:"toggleAudio",streamId:e,trackId:t,enabled:i}))}getStats(e){return k.debug("peerstatsgetstats = "+this.remotePeerConnectionStats[e]),new Promise((t,i)=>{this.remotePeerConnection[e].getStats(null).then(i=>{var r=-1,n=-1,a=-1,o=-1,s=-1,c=-1,l=-1,d=-1,u=-1,h="",m=-1,f=-1,p=-1,v=-1,g=-1,b=-1,y=-1,w=-1,C=-1,k=-1,T=-1,A=-1,E=-1,R=-1,P=-1,I=1/0,M=[];i.forEach(e=>{if("inbound-rtp"==e.type&&void 0!==e.kind){var t={};t.trackIdentifier=e.trackIdentifier,r+=e.bytesReceived,"audio"==e.kind?(a=e.packetsLost,t.audioPacketsLost=e.packetsLost):"video"==e.kind&&(n=e.packetsLost,t.videoPacketsLost=e.packetsLost,t.framesDropped=e.framesDropped,t.framesDecoded=e.framesDecoded,t.framesPerSecond=e.framesPerSecond),t.bytesReceived=e.bytesReceived,t.jitterBufferDelay=e.jitterBufferDelay,t.lastPacketReceivedTimestamp=e.lastPacketReceivedTimestamp,o+=e.fractionLost,t.fractionLost=e.fractionLost,s=e.timestamp,t.currentTime=e.timestamp,void 0!==e.frameWidth&&(g=e.frameWidth,t.frameWidth=e.frameWidth),void 0!==e.frameHeight&&(b=e.frameHeight,t.frameHeight=e.frameHeight),void 0!==e.framesDecoded&&(T=e.framesDecoded,t.framesDecoded=e.framesDecoded),void 0!==e.framesDropped&&(A=e.framesDropped,t.framesDropped=e.framesDropped),void 0!==e.framesReceived&&(E=e.framesReceived,t.framesReceived=e.framesReceived),M.push(t)}else"outbound-rtp"==e.type?("audio"==e.kind?d=e.packetsSent:"video"==e.kind&&(l=e.packetsSent,g=e.frameWidth,b=e.frameHeight),c+=e.bytesSent,s=e.timestamp,h=e.qualityLimitationReason,null!=e.framesEncoded&&(m+=e.framesEncoded)):"track"==e.type&&void 0!==e.kind&&"audio"==e.kind?(void 0!==e.audioLevel&&(u=e.audioLevel),void 0!==e.jitterBufferDelay&&void 0!==e.jitterBufferEmittedCount&&(R=e.jitterBufferDelay/e.jitterBufferEmittedCount)):"track"==e.type&&void 0!==e.kind&&"video"==e.kind?(void 0!==e.frameWidth&&(g=e.frameWidth),void 0!==e.frameHeight&&(b=e.frameHeight),void 0!==e.framesDecoded&&(T=e.framesDecoded),void 0!==e.framesDropped&&(A=e.framesDropped),void 0!==e.framesReceived&&(E=e.framesReceived),void 0!==e.jitterBufferDelay&&void 0!==e.jitterBufferEmittedCount&&(P=e.jitterBufferDelay/e.jitterBufferEmittedCount)):"remote-inbound-rtp"==e.type&&void 0!==e.kind?(void 0!==e.packetsLost&&("video"==e.kind?n=e.packetsLost:"audio"==e.kind&&(a=e.packetsLost)),void 0!==e.roundTripTime&&("video"==e.kind?y=e.roundTripTime:"audio"==e.kind&&(C=e.roundTripTime)),void 0!==e.jitter&&("video"==e.kind?w=e.jitter:"audio"==e.kind&&(k=e.jitter))):"media-source"==e.type?"video"==e.kind&&(f=e.width,p=e.height,v=e.framesPerSecond):"candidate-pair"==e.type&&"succeeded"==e.state&&null!=e.availableOutgoingBitrate&&(I=e.availableOutgoingBitrate/1e3)}),void 0!==this.remotePeerConnectionStats[e]&&null!=this.remotePeerConnectionStats[e]||(this.remotePeerConnectionStats[e]=new S(e)),this.remotePeerConnectionStats[e].totalBytesReceived=r,this.remotePeerConnectionStats[e].videoPacketsLost=n,this.remotePeerConnectionStats[e].audioPacketsLost=a,this.remotePeerConnectionStats[e].fractionLost=o,this.remotePeerConnectionStats[e].currentTime=s,this.remotePeerConnectionStats[e].totalBytesSent=c,this.remotePeerConnectionStats[e].totalVideoPacketsSent=l,this.remotePeerConnectionStats[e].totalAudioPacketsSent=d,this.remotePeerConnectionStats[e].audioLevel=u,this.remotePeerConnectionStats[e].qualityLimitationReason=h,this.remotePeerConnectionStats[e].totalFramesEncoded=m,this.remotePeerConnectionStats[e].resWidth=f,this.remotePeerConnectionStats[e].resHeight=p,this.remotePeerConnectionStats[e].srcFps=v,this.remotePeerConnectionStats[e].frameWidth=g,this.remotePeerConnectionStats[e].frameHeight=b,this.remotePeerConnectionStats[e].videoRoundTripTime=y,this.remotePeerConnectionStats[e].videoJitter=w,this.remotePeerConnectionStats[e].audioRoundTripTime=C,this.remotePeerConnectionStats[e].audioJitter=k,this.remotePeerConnectionStats[e].framesDecoded=T,this.remotePeerConnectionStats[e].framesDropped=A,this.remotePeerConnectionStats[e].framesReceived=E,this.remotePeerConnectionStats[e].videoJitterAverageDelay=P,this.remotePeerConnectionStats[e].audioJitterAverageDelay=R,this.remotePeerConnectionStats[e].availableOutgoingBitrate=I,this.remotePeerConnectionStats[e].inboundRtpList=M,this.notifyEventListeners("updated_stats",this.remotePeerConnectionStats[e]),t(!0)}).catch(e=>{t(!1)})})}enableStats(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;null==this.remotePeerConnectionStats[e]&&(this.remotePeerConnectionStats[e]=new S(e),this.remotePeerConnectionStats[e].timerId=setInterval(()=>{this.getStats(e)},t))}disableStats(e){null==this.remotePeerConnectionStats[e]&&void 0===this.remotePeerConnectionStats[e]||(clearInterval(this.remotePeerConnectionStats[e].timerId),delete this.remotePeerConnectionStats[e])}checkWebSocketConnection(){(null==this.webSocketAdaptor||0==this.webSocketAdaptor.isConnected()&&0==this.webSocketAdaptor.isConnecting())&&(k.debug("websocket url : "+this.websocketURL),this.webSocketAdaptor=new C({websocket_url:this.websocketURL,webrtcadaptor:this,callback:(e,t)=>{"closed"==e&&this.reconnectIfRequired(),this.notifyEventListeners(e,t)},callbackError:(e,t)=>{this.notifyErrorEventListeners(e,t)},debug:this.debug}))}closeWebSocket(){for(var e in this.remotePeerConnection)this.closePeerConnection(e);this.remotePeerConnection=new Array,this.webSocketAdaptor.close()}peerMessage(e,t,i){this.webSocketAdaptor.send(JSON.stringify({command:"peerMessageCommand",streamId:e,definition:t,data:i}))}forceStreamQuality(e,t){this.webSocketAdaptor.send(JSON.stringify({command:"forceStreamQuality",streamId:e,streamHeight:t}))}sendData(e,t){if(void 0!==this.remotePeerConnection[e]){var i=this.remotePeerConnection[e].dataChannel;if(null==i||void 0===i)return void k.warn("dataChannel is null or undefined");if("open"!==i.readyState)return void k.warn("dataChannel.readyState is not open: "+i.readyState);var r=t.length||t.size||t.byteLength,n=0;if("string"==typeof t||t instanceof String)i.send(t);else{var a=Math.floor(999999*Math.random()),o=new Int32Array(2);for(o[0]=a,o[1]=r,i.send(o),n=0;n<r;){var s=Math.min(r-n,16e3),c=new Uint8Array(s+4),l=new Int32Array(1);l[0]=a,c.set(new Uint8Array(l.buffer,0,4),0);var d=t.slice(n,n+s);c.set(new Uint8Array(d),4),n+=s,i.send(c)}}}else k.warn("Send data is called for undefined peer connection with stream id: "+e)}enableAudioLevel(e,t){var i=new d(this.mediaManager.audioContext);i.connectToSource(e,()=>{},(function(e){e?alert(e):k.debug("Added sound meter for stream: "+t+" = "+i.instant.toFixed(2))})),this.soundMeters[t]=i}getSoundLevelList(e){for(var t=0;t<e.length;t++)this.soundLevelList[e[t]]=this.soundMeters[e[t]].instant.toFixed(2);this.notifyEventListeners("gotSoundList",this.soundLevelList)}getSender(e,t){var i=null;return null!=this.remotePeerConnection[e]&&(i=this.remotePeerConnection[e].getSenders().find((function(e){return e.track.kind==t}))),i}assignVideoTrack(e,t,i){this.webSocketAdaptor.send(JSON.stringify({command:"assignVideoTrackCommand",streamId:t,videoTrackId:e,enabled:i}))}updateVideoTrackAssignments(e,t,i){this.webSocketAdaptor.send(JSON.stringify({streamId:e,command:"updateVideoTrackAssignmentsCommand",offset:t,size:i}))}setMaxVideoTrackCount(e,t){this.webSocketAdaptor.send(JSON.stringify({streamId:e,command:"setMaxVideoTrackCountCommand",maxTrackCount:t}))}updateAudioLevel(e,t){this.sendData(e,JSON.stringify({streamId:e,eventType:"UPDATE_AUDIO_LEVEL",audioLevel:t}))}getDebugInfo(e){this.webSocketAdaptor.send(JSON.stringify({streamId:e,command:"getDebugInfo"}))}registerPushNotificationToken(e,t,i,r){this.webSocketAdaptor.send(JSON.stringify({command:"registerPushNotificationToken",subscriberId:e,token:t,pnsRegistrationToken:i,pnsType:r}))}sendPushNotification(e,t,i,r){if("object"!=typeof i)throw k.error("Push Notification Content is not JSON format"),new Error("Push Notification Content is not JSON format");if(!Array.isArray(r))throw k.error("subscriberIdsToNotify is not an array. Please put the subscriber ids to notify in an array such as [user1], [user1, user2]"),new Error("subscriberIdsToNotify is not an array. Please put the subscriber ids to notify in an array such as [user1], [user1, user2]");this.webSocketAdaptor.send(JSON.stringify({command:"sendPushNotification",subscriberId:e,token:t,pushNotificationContent:i,subscriberIdsToNotify:r}))}sendPushNotificationToTopic(e,t,i,r){if("object"!=typeof i)throw k.error("Push Notification Content is not JSON format"),new Error("Push Notification Content is not JSON format");this.webSocketAdaptor.send(JSON.stringify({command:"sendPushNotification",subscriberId:e,token:t,pushNotificationContent:i,topic:r}))}turnOffLocalCamera(e){return this.mediaManager.turnOffLocalCamera(e)}turnOnLocalCamera(e){return this.mediaManager.turnOnLocalCamera(e)}muteLocalMic(){this.mediaManager.muteLocalMic()}unmuteLocalMic(){this.mediaManager.unmuteLocalMic()}switchDesktopCapture(e){return this.mediaManager.switchDesktopCapture(e)}switchVideoCameraCapture(e,t,i){return this.mediaManager.switchVideoCameraCapture(e,t,i)}updateVideoTrack(e,t,i,r){return this.mediaManager.updateVideoTrack(e,t,i,r)}updateAudioTrack(e,t,i){return this.mediaManager.updateAudioTrack(e,t,i)}switchVideoCameraFacingMode(e,t){return this.mediaManager.switchVideoCameraFacingMode(e,t)}switchDesktopCaptureWithCamera(e){return this.mediaManager.switchDesktopCaptureWithCamera(e)}switchAudioInputSource(e,t){return this.mediaManager.switchAudioInputSource(e,t)}setVolumeLevel(e){this.mediaManager.setVolumeLevel(e)}enableAudioLevelForLocalStream(e,t){return this.mediaManager.enableAudioLevelForLocalStream(e)}disableAudioLevelForLocalStream(){this.mediaManager.disableAudioLevelForLocalStream()}applyConstraints(e){return this.mediaManager.applyConstraints(e)}changeBandwidth(e,t){this.mediaManager.changeBandwidth(e,t)}enableAudioLevelWhenMuted(){return this.mediaManager.enableAudioLevelWhenMuted()}disableAudioLevelWhenMuted(){this.mediaManager.disableAudioLevelWhenMuted()}getVideoSender(e){return this.mediaManager.getVideoSender(e)}openStream(e,t){return this.mediaManager.openStream(e,t)}closeStream(){return this.mediaManager.closeStream()}}v(A,"pluginInitMethods",new Array);var E="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{};(function(){var e;function t(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}var i="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,i){return e==Array.prototype||e==Object.prototype||(e[t]=i.value),e},n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof E&&E];for(var t=0;t<e.length;++t){var i=e[t];if(i&&i.Math==Math)return i}throw Error("Cannot find global object")}(this);function a(e,t){if(t)e:{var r=n;e=e.split(".");for(var a=0;a<e.length-1;a++){var o=e[a];if(!(o in r))break e;r=r[o]}(t=t(a=r[e=e[e.length-1]]))!=a&&null!=t&&i(r,e,{configurable:!0,writable:!0,value:t})}}function o(e){return(e={next:e})[Symbol.iterator]=function(){return this},e}function s(e){var i="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];return i?i.call(e):{next:t(e)}}function c(e){if(!(e instanceof Array)){e=s(e);for(var t,i=[];!(t=e.next()).done;)i.push(t.value);e=i}return e}a("Symbol",(function(e){function t(e,t){this.h=e,i(this,"description",{configurable:!0,writable:!0,value:t})}if(e)return e;t.prototype.toString=function(){return this.h};var r="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",n=0;return function e(i){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new t(r+(i||"")+"_"+n++,i)}})),a("Symbol.iterator",(function(e){if(e)return e;e=Symbol("Symbol.iterator");for(var r="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),a=0;a<r.length;a++){var s=n[r[a]];"function"==typeof s&&"function"!=typeof s.prototype[e]&&i(s.prototype,e,{configurable:!0,writable:!0,value:function(){return o(t(this))}})}return e}));var l="function"==typeof Object.assign?Object.assign:function(e,t){for(var i=1;i<arguments.length;i++){var r=arguments[i];if(r)for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};a("Object.assign",(function(e){return e||l}));var d,u="function"==typeof Object.create?Object.create:function(e){function t(){}return t.prototype=e,new t};if("function"==typeof Object.setPrototypeOf)d=Object.setPrototypeOf;else{var h;e:{var m={};try{m.__proto__={a:!0},h=m.a;break e}catch(vi){}h=!1}d=h?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null}var f=d;function p(e,t){if(e.prototype=u(t.prototype),e.prototype.constructor=e,f)f(e,t);else for(var i in t)if("prototype"!=i)if(Object.defineProperties){var r=Object.getOwnPropertyDescriptor(t,i);r&&Object.defineProperty(e,i,r)}else e[i]=t[i];e.za=t.prototype}function v(){this.m=!1,this.j=null,this.i=void 0,this.h=1,this.v=this.s=0,this.l=null}function g(e){if(e.m)throw new TypeError("Generator is already running");e.m=!0}function b(e,t){e.l={ma:t,na:!0},e.h=e.s||e.v}function y(e,t,i){return e.h=i,{value:t}}function S(e){this.h=new v,this.i=e}function w(e,t,i,r){try{var n=t.call(e.h.j,i);if(!(n instanceof Object))throw new TypeError("Iterator result "+n+" is not an object");if(!n.done)return e.h.m=!1,n;var a=n.value}catch(o){return e.h.j=null,b(e.h,o),C(e)}return e.h.j=null,r.call(e.h,a),C(e)}function C(e){for(;e.h.h;)try{var t=e.i(e.h);if(t)return e.h.m=!1,{value:t.value,done:!1}}catch(i){e.h.i=void 0,b(e.h,i)}if(e.h.m=!1,e.h.l){if(t=e.h.l,e.h.l=null,t.na)throw t.ma;return{value:t.return,done:!0}}return{value:void 0,done:!0}}function k(e){this.next=function(t){return g(e.h),e.h.j?t=w(e,e.h.j.next,t,e.h.u):(e.h.u(t),t=C(e)),t},this.throw=function(t){return g(e.h),e.h.j?t=w(e,e.h.j.throw,t,e.h.u):(b(e.h,t),t=C(e)),t},this.return=function(t){return function(e,t){g(e.h);var i=e.h.j;return i?w(e,"return"in i?i.return:function(e){return{value:e,done:!0}},t,e.h.return):(e.h.return(t),C(e))}(e,t)},this[Symbol.iterator]=function(){return this}}function T(e){return function(e){function t(t){return e.next(t)}function i(t){return e.throw(t)}return new Promise((function(r,n){!function e(a){a.done?r(a.value):Promise.resolve(a.value).then(t,i).then(e,n)}(e.next())}))}(new k(new S(e)))}function A(e){return e||Array.prototype.fill}v.prototype.u=function(e){this.i=e},v.prototype.return=function(e){this.l={return:e},this.h=this.v},a("Promise",(function(e){function t(e){this.i=0,this.j=void 0,this.h=[],this.u=!1;var t=this.l();try{e(t.resolve,t.reject)}catch(i){t.reject(i)}}function i(){this.h=null}function r(e){return e instanceof t?e:new t((function(t){t(e)}))}if(e)return e;i.prototype.i=function(e){if(null==this.h){this.h=[];var t=this;this.j((function(){t.m()}))}this.h.push(e)};var a=n.setTimeout;i.prototype.j=function(e){a(e,0)},i.prototype.m=function(){for(;this.h&&this.h.length;){var e=this.h;this.h=[];for(var t=0;t<e.length;++t){var i=e[t];e[t]=null;try{i()}catch(r){this.l(r)}}}this.h=null},i.prototype.l=function(e){this.j((function(){throw e}))},t.prototype.l=function(){function e(e){return function(r){i||(i=!0,e.call(t,r))}}var t=this,i=!1;return{resolve:e(this.I),reject:e(this.m)}},t.prototype.I=function(e){if(e===this)this.m(new TypeError("A Promise cannot resolve to itself"));else if(e instanceof t)this.L(e);else{e:switch(typeof e){case"object":var i=null!=e;break e;case"function":i=!0;break e;default:i=!1}i?this.F(e):this.s(e)}},t.prototype.F=function(e){var t=void 0;try{t=e.then}catch(i){return void this.m(i)}"function"==typeof t?this.M(t,e):this.s(e)},t.prototype.m=function(e){this.v(2,e)},t.prototype.s=function(e){this.v(1,e)},t.prototype.v=function(e,t){if(0!=this.i)throw Error("Cannot settle("+e+", "+t+"): Promise already settled in state"+this.i);this.i=e,this.j=t,2===this.i&&this.K(),this.H()},t.prototype.K=function(){var e=this;a((function(){if(e.D()){var t=n.console;void 0!==t&&t.error(e.j)}}),1)},t.prototype.D=function(){if(this.u)return!1;var e=n.CustomEvent,t=n.Event,i=n.dispatchEvent;return void 0===i||("function"==typeof e?e=new e("unhandledrejection",{cancelable:!0}):"function"==typeof t?e=new t("unhandledrejection",{cancelable:!0}):(e=n.document.createEvent("CustomEvent")).initCustomEvent("unhandledrejection",!1,!0,e),e.promise=this,e.reason=this.j,i(e))},t.prototype.H=function(){if(null!=this.h){for(var e=0;e<this.h.length;++e)o.i(this.h[e]);this.h=null}};var o=new i;return t.prototype.L=function(e){var t=this.l();e.T(t.resolve,t.reject)},t.prototype.M=function(e,t){var i=this.l();try{e.call(t,i.resolve,i.reject)}catch(r){i.reject(r)}},t.prototype.then=function(e,i){function r(e,t){return"function"==typeof e?function(t){try{n(e(t))}catch(i){a(i)}}:t}var n,a,o=new t((function(e,t){n=e,a=t}));return this.T(r(e,n),r(i,a)),o},t.prototype.catch=function(e){return this.then(void 0,e)},t.prototype.T=function(e,t){function i(){switch(r.i){case 1:e(r.j);break;case 2:t(r.j);break;default:throw Error("Unexpected state: "+r.i)}}var r=this;null==this.h?o.i(i):this.h.push(i),this.u=!0},t.resolve=r,t.reject=function(e){return new t((function(t,i){i(e)}))},t.race=function(e){return new t((function(t,i){for(var n=s(e),a=n.next();!a.done;a=n.next())r(a.value).T(t,i)}))},t.all=function(e){var i=s(e),n=i.next();return n.done?r([]):new t((function(e,t){function a(t){return function(i){o[t]=i,0==--s&&e(o)}}var o=[],s=0;do{o.push(void 0),s++,r(n.value).T(a(o.length-1),t),n=i.next()}while(!n.done)}))},t})),a("Array.prototype.keys",(function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var i=0,r=!1,n={next:function(){return!r&&i<e.length?{value:i++,done:!1}:(r=!0,{done:!0,value:void 0})}};return n[Symbol.iterator]=function(){return n},n}(this)}})),a("Array.prototype.fill",(function(e){return e||function(e,t,i){var r=this.length||0;for(0>t&&(t=Math.max(0,r+t)),(null==i||i>r)&&(i=r),0>(i=Number(i))&&(i=Math.max(0,r+i)),t=Number(t||0);t<i;t++)this[t]=e;return this}})),a("Int8Array.prototype.fill",A),a("Uint8Array.prototype.fill",A),a("Uint8ClampedArray.prototype.fill",A),a("Int16Array.prototype.fill",A),a("Uint16Array.prototype.fill",A),a("Int32Array.prototype.fill",A),a("Uint32Array.prototype.fill",A),a("Float32Array.prototype.fill",A),a("Float64Array.prototype.fill",A),a("Object.is",(function(e){return e||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}})),a("Array.prototype.includes",(function(e){return e||function(e,t){var i=this;i instanceof String&&(i=String(i));var r=i.length;for(0>(t=t||0)&&(t=Math.max(t+r,0));t<r;t++){var n=i[t];if(n===e||Object.is(n,e))return!0}return!1}})),a("String.prototype.includes",(function(e){return e||function(e,t){if(null==this)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(e instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return-1!==this.indexOf(e,t||0)}}));var R=this||self;function P(e,t){e=e.split(".");var i,r=R;e[0]in r||void 0===r.execScript||r.execScript("var "+e[0]);for(;e.length&&(i=e.shift());)e.length||void 0===t?r=r[i]&&r[i]!==Object.prototype[i]?r[i]:r[i]={}:r[i]=t}function I(e){var t;return(t=R.navigator)&&(t=t.userAgent)||(t=""),-1!=t.indexOf(e)}var M=Array.prototype.map?function(e,t){return Array.prototype.map.call(e,t,void 0)}:function(e,t){for(var i=e.length,r=Array(i),n="string"==typeof e?e.split(""):e,a=0;a<i;a++)a in n&&(r[a]=t.call(void 0,n[a],a,e));return r},L={},O=null;function D(){if(!O){O={};for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),t=["+/=","+/","-_=","-_.","-_"],i=0;5>i;i++){var r=e.concat(t[i].split(""));L[i]=r;for(var n=0;n<r.length;n++){var a=r[n];void 0===O[a]&&(O[a]=n)}}}}var N="undefined"!=typeof Uint8Array,x=!(I("Trident")||I("MSIE"))&&"function"==typeof R.btoa;function j(e){if(!x){var t;void 0===t&&(t=0),D(),t=L[t];for(var i=Array(Math.floor(e.length/3)),r=t[64]||"",n=0,a=0;n<e.length-2;n+=3){var o=e[n],s=e[n+1],c=e[n+2],l=t[o>>2];i[a++]=l+(o=t[(3&o)<<4|s>>4])+(s=t[(15&s)<<2|c>>6])+(c=t[63&c])}switch(l=0,c=r,e.length-n){case 2:c=t[(15&(l=e[n+1]))<<2]||r;case 1:i[a]=t[(e=e[n])>>2]+t[(3&e)<<4|l>>4]+c+r}return i.join("")}for(t="";10240<e.length;)t+=String.fromCharCode.apply(null,e.subarray(0,10240)),e=e.subarray(10240);return t+=String.fromCharCode.apply(null,e),btoa(t)}var _,F=RegExp("[-_.]","g");function B(e){switch(e){case"-":return"+";case"_":return"/";case".":return"=";default:return""}}function V(e){if(!x)return function(e){var t=e.length,i=3*t/4;i%3?i=Math.floor(i):-1!="=.".indexOf(e[t-1])&&(i=-1!="=.".indexOf(e[t-2])?i-2:i-1);var r=new Uint8Array(i),n=0;return function(e,t){function i(t){for(;r<e.length;){var i=e.charAt(r++),n=O[i];if(null!=n)return n;if(!/^[\s\xa0]*$/.test(i))throw Error("Unknown base64 encoding at char: "+i)}return t}D();for(var r=0;;){var n=i(-1),a=i(0),o=i(64),s=i(64);if(64===s&&-1===n)break;t(n<<2|a>>4),64!=o&&(t(a<<4&240|o>>2),64!=s&&t(o<<6&192|s))}}(e,(function(e){r[n++]=e})),n!==i?r.subarray(0,n):r}(e);F.test(e)&&(e=e.replace(F,B)),e=atob(e);for(var t=new Uint8Array(e.length),i=0;i<e.length;i++)t[i]=e.charCodeAt(i);return t}function U(){return _||(_=new Uint8Array(0))}var W={},G="function"==typeof Uint8Array.prototype.slice,J=0,H=0;function z(e){var t=0>e,i=(e=Math.abs(e))>>>0;e=Math.floor((e-i)/4294967296),t&&(t=(i=s(q(i,e))).next().value,e=i.next().value,i=t),J=i>>>0,H=e>>>0}var K,X="function"==typeof BigInt;function q(e,t){return t=~t,e?e=1+~e:t+=1,[e,t]}function Y(e,t){this.i=e>>>0,this.h=t>>>0}function Q(e){if(!e)return K||(K=new Y(0,0));if(!/^-?\d+$/.test(e))return null;if(16>e.length)z(Number(e));else if(X)e=BigInt(e),J=Number(e&BigInt(4294967295))>>>0,H=Number(e>>BigInt(32)&BigInt(4294967295));else{var t=+("-"===e[0]);H=J=0;for(var i=e.length,r=t,n=(i-t)%6+t;n<=i;r=n,n+=6)r=Number(e.slice(r,n)),H*=1e6,4294967296<=(J=1e6*J+r)&&(H+=J/4294967296|0,J%=4294967296);t&&(e=(t=s(q(J,H))).next().value,t=t.next().value,J=e,H=t)}return new Y(J,H)}function Z(e,t){return Error("Invalid wire type: "+e+" (at position "+t+")")}function $(){return Error("Failed to read varint, encoding is invalid.")}function ee(e,t){return Error("Tried to read past the end of the data "+t+" > "+e)}function te(){throw Error("Invalid UTF8")}function ie(e,t){return t=String.fromCharCode.apply(null,t),null==e?t:e+t}var re,ne,ae,oe=void 0,se="undefined"!=typeof TextDecoder,ce="undefined"!=typeof TextEncoder;function le(e){if(e!==W)throw Error("illegal external caller")}function de(e,t){if(le(t),this.V=e,null!=e&&0===e.length)throw Error("ByteString should be constructed with non-empty values")}function ue(){return ae||(ae=new de(null,W))}function he(e){le(W);var t=e.V;return null==(t=null==t||N&&null!=t&&t instanceof Uint8Array?t:"string"==typeof t?V(t):null)?t:e.V=t}function me(e,t){this.i=null,this.m=!1,this.h=this.j=this.l=0,fe(this,e,t)}function fe(e,t,i){e.S=void 0!==(i=void 0===i?{}:i).S&&i.S,t&&(t=function(e){if("string"==typeof e)return{buffer:V(e),C:!1};if(Array.isArray(e))return{buffer:new Uint8Array(e),C:!1};if(e.constructor===Uint8Array)return{buffer:e,C:!1};if(e.constructor===ArrayBuffer)return{buffer:new Uint8Array(e),C:!1};if(e.constructor===de)return{buffer:he(e)||U(),C:!0};if(e instanceof Uint8Array)return{buffer:new Uint8Array(e.buffer,e.byteOffset,e.byteLength),C:!1};throw Error("Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, a ByteString or an Array of numbers")}(t),e.i=t.buffer,e.m=t.C,e.l=0,e.j=e.i.length,e.h=e.l)}function pe(e,t){if(e.h=t,t>e.j)throw ee(e.j,t)}function ve(e){var t=e.i,i=e.h,r=t[i++],n=127&r;if(128&r&&(n|=(127&(r=t[i++]))<<7,128&r&&(n|=(127&(r=t[i++]))<<14,128&r&&(n|=(127&(r=t[i++]))<<21,128&r&&(n|=(r=t[i++])<<28,128&r&&128&t[i++]&&128&t[i++]&&128&t[i++]&&128&t[i++]&&128&t[i++])))))throw $();return pe(e,i),n}function ge(e,t){if(0>t)throw Error("Tried to read a negative byte length: "+t);var i=e.h,r=i+t;if(r>e.j)throw ee(t,e.j-i);return e.h=r,i}me.prototype.reset=function(){this.h=this.l};var be=[];function ye(){this.h=[]}function Se(e,t,i){for(;0<i||127<t;)e.h.push(127&t|128),t=(t>>>7|i<<25)>>>0,i>>>=7;e.h.push(t)}function we(e,t){for(;127<t;)e.h.push(127&t|128),t>>>=7;e.h.push(t)}function Ce(e,t){if(be.length){var i=be.pop();fe(i,e,t),e=i}else e=new me(e,t);this.h=e,this.j=this.h.h,this.i=this.l=-1,this.setOptions(t)}function ke(e){var t=e.h;if(t.h==t.j)return!1;e.j=e.h.h;var i=ve(e.h)>>>0;if(t=i>>>3,!(0<=(i&=7)&&5>=i))throw Z(i,e.j);if(1>t)throw Error("Invalid field number: "+t+" (at position "+e.j+")");return e.l=t,e.i=i,!0}function Te(e){switch(e.i){case 0:if(0!=e.i)Te(e);else e:{for(var t=(e=e.h).h,i=t+10,r=e.i;t<i;)if(0==(128&r[t++])){pe(e,t);break e}throw $()}break;case 1:pe(e=e.h,e.h+8);break;case 2:2!=e.i?Te(e):(t=ve(e.h)>>>0,pe(e=e.h,e.h+t));break;case 5:pe(e=e.h,e.h+4);break;case 3:for(t=e.l;;){if(!ke(e))throw Error("Unmatched start-group tag: stream EOF");if(4==e.i){if(e.l!=t)throw Error("Unmatched end-group tag");break}Te(e)}break;default:throw Z(e.i,e.j)}}ye.prototype.length=function(){return this.h.length},ye.prototype.end=function(){var e=this.h;return this.h=[],e},Ce.prototype.setOptions=function(e){this.ca=void 0!==(e=void 0===e?{}:e).ca&&e.ca},Ce.prototype.reset=function(){this.h.reset(),this.j=this.h.h,this.i=this.l=-1};var Ae=[];function Ee(){this.j=[],this.i=0,this.h=new ye}function Re(e,t){0!==t.length&&(e.j.push(t),e.i+=t.length)}var Pe="function"==typeof Symbol&&"symbol"==typeof Symbol()?Symbol():void 0;function Ie(e,t){return Pe?e[Pe]|=t:void 0!==e.A?e.A|=t:(Object.defineProperties(e,{A:{value:t,configurable:!0,writable:!0,enumerable:!1}}),t)}function Me(e,t){Pe?e[Pe]&&(e[Pe]&=~t):void 0!==e.A&&(e.A&=~t)}function Le(e){var t;return null==(t=Pe?e[Pe]:e.A)?0:t}function Oe(e,t){Pe?e[Pe]=t:void 0!==e.A?e.A=t:Object.defineProperties(e,{A:{value:t,configurable:!0,writable:!0,enumerable:!1}})}function De(e){return Ie(e,1),e}function Ne(e,t){Oe(t,-51&(0|e))}function xe(e,t){Oe(t,-41&(18|e))}var je={};function _e(e){return null!==e&&"object"==typeof e&&!Array.isArray(e)&&e.constructor===Object}var Fe,Be,Ve=[];function Ue(e){if(2&Le(e.o))throw Error("Cannot mutate an immutable Message")}function We(e){var t=e.length;(t=t?e[t-1]:void 0)&&_e(t)?t.g=1:e.push(((t={}).g=1,t))}function Ge(e){return e.B||(e.B=e.o[e.i+e.G]={})}function Je(e,t){return-1===t?null:t>=e.i?e.B?e.B[t]:void 0:e.o[t+e.G]}function He(e,t,i,r){Ue(e),ze(e,t,i,r)}function ze(e,t,i,r){e.j&&(e.j=void 0),t>=e.i||r?Ge(e)[t]=i:(e.o[t+e.G]=i,(e=e.B)&&t in e&&delete e[t])}function Ke(e,t,i,r){var n=Je(e,t);Array.isArray(n)||(n=Fe);var a=Le(n);if(1&a||De(n),r)2&a||Ie(n,2),1&i||Object.freeze(n);else{r=!(2&i);var o=2&a;1&i||!o?r&&16&a&&!o&&Me(n,16):ze(e,t,n=De(Array.prototype.slice.call(n)))}return n}function Xe(e,t){var i=Je(e,t),r=null==i?i:"number"==typeof i||"NaN"===i||"Infinity"===i||"-Infinity"===i?Number(i):void 0;return null!=r&&r!==i&&ze(e,t,r),r}function qe(e,t,i,r,n){e.h||(e.h={});var a=e.h[i],o=Ke(e,i,3,n);if(!a){var s=o;a=[];var c=!!(16&Le(e.o));o=!!(2&Le(s));var l=s;!n&&o&&(s=Array.prototype.slice.call(s));for(var d=o,u=0;u<s.length;u++){var h=s[u],m=t,f=!1;if(f=void 0!==f&&f,void 0!==(h=Array.isArray(h)?new m(h):f?new m:void 0)){var p=f=Le(m=h.o);o&&(p|=2),c&&(p|=16),p!=f&&Oe(m,p),m=p,d=d||!!(2&m),a.push(h)}}return e.h[i]=a,t=33|(c=Le(s)),c!=(t=d?-9&t:8|t)&&(d=s,Object.isFrozen(d)&&(d=Array.prototype.slice.call(d)),Oe(d,t),s=d),l!==s&&ze(e,i,s),(n||r&&o)&&Ie(a,2),r&&Object.freeze(a),a}return n||(n=Object.isFrozen(a),r&&!n?Object.freeze(a):!r&&n&&(a=Array.prototype.slice.call(a),e.h[i]=a)),a}function Ye(e,t,i){var r=!!(2&Le(e.o));if(t=qe(e,t,i,r,r),e=Ke(e,i,3,r),!(r||8&Le(e))){for(r=0;r<t.length;r++){if(2&Le((i=t[r]).o)){var n=ct(i,!1);n.j=i}else n=i;i!==n&&(t[r]=n,e[r]=n.o)}Ie(e,8)}return t}function Qe(e,t,i){if(null!=i&&"number"!=typeof i)throw Error("Value of float/double field must be a number|null|undefined, found "+typeof i+": "+i);He(e,t,i)}function Ze(e,t,i,r,n){Ue(e);var a=qe(e,i,t,!1,!1);return i=null!=r?r:new i,e=Ke(e,t,2,!1),null!=n?(a.splice(n,0,i),e.splice(n,0,i.o)):(a.push(i),e.push(i.o)),i.C()&&Me(e,8),i}function $e(e,t){return null==e?t:e}function et(e,t,i){return i=void 0===i?0:i,$e(Xe(e,t),i)}function tt(e,t,i,r){if(null!=e){if(Array.isArray(e))e=it(e,t,i,void 0!==r);else if(_e(e)){var n,a={};for(n in e)a[n]=tt(e[n],t,i,r);e=a}else e=t(e,r);return e}}function it(e,t,i,r){var n=Le(e);r=r?!!(16&n):void 0,e=Array.prototype.slice.call(e);for(var a=0;a<e.length;a++)e[a]=tt(e[a],t,i,r);return i(n,e),e}function rt(e){return e.ja===je?e.toJSON():function(e){switch(typeof e){case"number":return isFinite(e)?e:String(e);case"object":if(e)if(Array.isArray(e)){if(0!=(128&Le(e)))return We(e=Array.prototype.slice.call(e)),e}else{if(N&&null!=e&&e instanceof Uint8Array)return j(e);if(e instanceof de){var t=e.V;return null==t?"":"string"==typeof t?t:e.V=j(t)}}}return e}(e)}function nt(e,t){128&e&&We(t)}function at(e,t,i){if(i=void 0===i?xe:i,null!=e){if(N&&e instanceof Uint8Array)return e.length?new de(new Uint8Array(e),W):ue();if(Array.isArray(e)){var r=Le(e);return 2&r?e:!t||32&r||!(16&r||0===r)?(4&(t=Le(e=it(e,at,4&r?xe:i,!0)))&&2&t&&Object.freeze(e),e):(Oe(e,2|r),e)}return e.ja===je?st(e):e}}function ot(e,t,i,r,n,a,o){if(e=e.h&&e.h[i]){if(2&(r=Le(e))?r=e:(xe(r,a=M(e,st)),Object.freeze(a),r=a),Ue(t),o=null==r?Fe:De([]),null!=r){for(a=!!r.length,e=0;e<r.length;e++){var s=r[e];a=a&&!(2&Le(s.o)),o[e]=s.o}a=1|(a?8:0),((e=Le(o))&a)!==a&&(Object.isFrozen(o)&&(o=Array.prototype.slice.call(o)),Oe(o,e|a)),t.h||(t.h={}),t.h[i]=r}else t.h&&(t.h[i]=void 0);ze(t,i,o,n)}else He(t,i,at(r,a,o),n)}function st(e){return 2&Le(e.o)||Ie((e=ct(e,!0)).o,2),e}function ct(e,t){var i=e.o,r=[];Ie(r,16);var n=e.constructor.h;if(n&&r.push(n),n=e.B){r.length=i.length,r.fill(void 0,r.length,i.length);var a={};r[r.length-1]=a}0!=(128&Le(i))&&We(r),t=t||e.C()?xe:Ne,Be=r,r=new(a=e.constructor)(r),Be=void 0,e.R&&(r.R=e.R.slice()),a=!!(16&Le(i));for(var o=n?i.length-1:i.length,s=0;s<o;s++)ot(e,r,s-e.G,i[s],!1,a,t);if(n)for(var c in n)ot(e,r,+c,n[c],!0,a,t);return r}function lt(e,t,i){null==e&&(e=Be),Be=void 0;var r,n=this.constructor.i||0,a=0<n,o=this.constructor.h,s=!1;if(null==e){var c=48,l=!0;a&&(n=0,c|=128),Oe(e=o?[o]:[],c)}else{if(!Array.isArray(e))throw Error();if(o&&o!==e[0])throw Error();var d=c=Ie(e,0);if((l=0!=(16&d))&&((s=0!=(32&d))||(d|=32)),a){if(128&d)n=0;else if(0<e.length){var u=e[e.length-1];if(_e(u)&&"g"in u){n=0,d|=128,delete u.g;var h,m=!0;for(h in u){m=!1;break}m&&e.pop()}}}else if(128&d)throw Error();c!==d&&Oe(e,d)}if(this.G=(o?0:-1)-n,this.h=void 0,this.o=e,n=(o=this.o.length)-1,o&&_e(o=this.o[n])?(this.B=o,this.i=n-this.G):void 0!==t&&-1<t?(this.i=Math.max(t,n+1-this.G),this.B=void 0):this.i=Number.MAX_VALUE,!a&&this.B&&"g"in this.B)throw Error('Unexpected "g" flag in sparse object of message that is not a group type.');if(i)for(t=l&&!s&&!0,a=this.i,l=0;l<i.length;l++)(s=i[l])<a?(n=e[s+=this.G])?dt(n,t):e[s]=Fe:(r||(r=Ge(this)),(n=r[s])?dt(n,t):r[s]=Fe)}function dt(e,t){if(Array.isArray(e)){var i=Le(e),r=1;!t||2&i||(r|=16),(i&r)!==r&&Oe(e,i|r)}}function ut(e,t,i){if(i){var r,n={};for(r in i){var a=i[r],o=a.ra;o||(n.J=a.xa||a.oa.W,a.ia?(n.aa=yt(a.ia),o=function(e){return function(t,i,r){return e.J(t,i,r,e.aa)}}(n)):a.ka?(n.Z=St(a.da.P,a.ka),o=function(e){return function(t,i,r){return e.J(t,i,r,e.Z)}}(n)):o=n.J,a.ra=o),o(t,e,a.da),n={J:n.J,aa:n.aa,Z:n.Z}}}!function(e,t){if(t=t.R){Re(e,e.h.end());for(var i=0;i<t.length;i++)Re(e,he(t[i])||U())}}(t,e)}Oe(Ve,23),Fe=Object.freeze(Ve),lt.prototype.toJSON=function(){return it(this.o,rt,nt)},lt.prototype.C=function(){return!!(2&Le(this.o))},lt.prototype.ja=je,lt.prototype.toString=function(){return this.o.toString()};var ht=Symbol();function mt(e,t,i){return e[ht]||(e[ht]=function(e,r){return t(e,r,i)})}function ft(e){var t=e[ht];if(!t){var i=Ot(e);e[ht]=t=function(e,t){return Dt(e,t,i)}}return t}function pt(e){var t=function(e){var t=e.ia;return t?ft(t):(t=e.wa)?mt(e.da.P,t,e.ka):void 0}(e),i=e.da,r=e.oa.U;return t?function(e,n){return r(e,n,i,t)}:function(e,t){return r(e,t,i)}}function vt(e,t){var i=e[t];return"function"==typeof i&&0===i.length&&(i=i(),e[t]=i),Array.isArray(i)&&(Rt in i||wt in i||0<i.length&&"function"==typeof i[0])?i:void 0}function gt(e,t,i,r,n,a){t.P=e[0];var o=1;if(e.length>o&&"number"!=typeof e[o]){var s=e[o++];i(t,s)}for(;o<e.length;){i=e[o++];for(var c=o+1;c<e.length&&"number"!=typeof e[c];)c++;switch(s=e[o++],c-=o){case 0:r(t,i,s);break;case 1:(c=vt(e,o))?(o++,n(t,i,s,c)):r(t,i,s,e[o++]);break;case 2:n(t,i,s,c=vt(e,c=o++),e[o++]);break;case 3:a(t,i,s,e[o++],e[o++],e[o++]);break;case 4:a(t,i,s,e[o++],e[o++],e[o++],e[o++]);break;default:throw Error("unexpected number of binary field arguments: "+c)}}return t}var bt=Symbol();function yt(e){var t=e[bt];if(!t){var i=Et(e);e[bt]=t=function(e,t){return Nt(e,t,i)}}return t}function St(e,t){var i=e[bt];return i||(e[bt]=i=function(e,i){return ut(e,i,t)}),i}var wt=Symbol();function Ct(e,t){e.push(t)}function kt(e,t,i){e.push(t,i.W)}function Tt(e,t,i,r){var n=yt(r),a=Et(r).P,o=i.W;e.push(t,(function(e,t,i){return o(e,t,i,a,n)}))}function At(e,t,i,r,n,a){var o=St(r,a),s=i.W;e.push(t,(function(e,t,i){return s(e,t,i,r,o)}))}function Et(e){var t=e[wt];return t||(t=gt(e,e[wt]=[],Ct,kt,Tt,At),Rt in e&&wt in e&&(e.length=0),t)}var Rt=Symbol();function Pt(e,t){e[0]=t}function It(e,t,i,r){var n=i.U;e[t]=r?function(e,t,i){return n(e,t,i,r)}:n}function Mt(e,t,i,r,n){var a=i.U,o=ft(r),s=Ot(r).P;e[t]=function(e,t,i){return a(e,t,i,s,o,n)}}function Lt(e,t,i,r,n,a,o){var s=i.U,c=mt(r,n,a);e[t]=function(e,t,i){return s(e,t,i,r,c,o)}}function Ot(e){var t=e[Rt];return t||(t=gt(e,e[Rt]={},Pt,It,Mt,Lt),Rt in e&&wt in e&&(e.length=0),t)}function Dt(e,t,i){for(;ke(t)&&4!=t.i;){var r=t.l,n=i[r];if(!n){var a=i[0];a&&(a=a[r])&&(n=i[r]=pt(a))}if(!n||!n(t,e,r)){r=e,a=(n=t).j,Te(n);var o=n;if(!o.ca){if(n=o.h.h-a,o.h.h=a,o=o.h,0==n)n=ue();else{if(a=ge(o,n),o.S&&o.m)n=o.i.subarray(a,a+n);else{o=o.i;var s=a;n=s===(n=a+n)?U():G?o.slice(s,n):new Uint8Array(o.subarray(s,n))}n=0==n.length?ue():new de(n,W)}(a=r.R)?a.push(n):r.R=[n]}}}return e}function Nt(e,t,i){for(var r=i.length,n=1==r%2,a=n?1:0;a<r;a+=2)(0,i[a+1])(t,e,i[a]);ut(e,t,n?i[0]:void 0)}function xt(e,t){return{U:e,W:t}}var jt=xt((function(e,t,i){if(5!==e.i)return!1;var r=(e=e.h).i,n=e.h,a=r[n],o=r[n+1],s=r[n+2];return r=r[n+3],pe(e,e.h+4),e=2*((o=(a<<0|o<<8|s<<16|r<<24)>>>0)>>31)+1,a=o>>>23&255,o&=8388607,He(t,i,255==a?o?NaN:1/0*e:0==a?e*Math.pow(2,-149)*o:e*Math.pow(2,a-150)*(o+Math.pow(2,23))),!0}),(function(e,t,i){if(null!=(t=Xe(t,i))){we(e.h,8*i+5),e=e.h;var r=+t;0===r?0<1/r?J=H=0:(H=0,J=2147483648):isNaN(r)?(H=0,J=2147483647):34028234663852886e22<(r=(i=0>r?-2147483648:0)?-r:r)?(H=0,J=(2139095040|i)>>>0):11754943508222875e-54>r?(r=Math.round(r/Math.pow(2,-149)),H=0,J=(i|r)>>>0):(t=Math.floor(Math.log(r)/Math.LN2),r*=Math.pow(2,-t),16777216<=(r=Math.round(8388608*r))&&++t,H=0,J=(i|t+127<<23|8388607&r)>>>0),e.h.push((i=J)>>>0&255),e.h.push(i>>>8&255),e.h.push(i>>>16&255),e.h.push(i>>>24&255)}})),_t=xt((function(e,t,i){if(0!==e.i)return!1;var r=e.h,n=0,a=e=0,o=r.i,s=r.h;do{var c=o[s++];n|=(127&c)<<a,a+=7}while(32>a&&128&c);for(32<a&&(e|=(127&c)>>4),a=3;32>a&&128&c;a+=7)e|=(127&(c=o[s++]))<<a;if(pe(r,s),!(128>c))throw $();return r=n>>>0,(e=2147483648&(c=e>>>0))&&(c=~c>>>0,0==(r=1+~r>>>0)&&(c=c+1>>>0)),r=4294967296*c+(r>>>0),He(t,i,e?-r:r),!0}),(function(e,t,i){null!=(t=Je(t,i))&&("string"==typeof t&&Q(t),null!=t&&(we(e.h,8*i),"number"==typeof t?(e=e.h,z(t),Se(e,J,H)):(i=Q(t),Se(e.h,i.i,i.h))))})),Ft=xt((function(e,t,i){return 0===e.i&&(He(t,i,ve(e.h)),!0)}),(function(e,t,i){if(null!=(t=Je(t,i))&&null!=t)if(we(e.h,8*i),e=e.h,0<=(i=t))we(e,i);else{for(t=0;9>t;t++)e.h.push(127&i|128),i>>=7;e.h.push(1)}})),Bt=xt((function(e,t,i){if(2!==e.i)return!1;var r=ve(e.h)>>>0,n=ge(e=e.h,r);if(e=e.i,se){var a,o=e;(a=re)||(a=re=new TextDecoder("utf-8",{fatal:!0})),e=n+r,o=0===n&&e===o.length?o:o.subarray(n,e);try{var s=a.decode(o)}catch(u){if(void 0===oe){try{a.decode(new Uint8Array([128]))}catch(h){}try{a.decode(new Uint8Array([97])),oe=!0}catch(h){oe=!1}}throw!oe&&(re=void 0),u}}else{r=(s=n)+r,n=[];for(var c,l,d=null;s<r;)128>(c=e[s++])?n.push(c):224>c?s>=r?te():(l=e[s++],194>c||128!=(192&l)?(s--,te()):n.push((31&c)<<6|63&l)):240>c?s>=r-1?te():128!=(192&(l=e[s++]))||224===c&&160>l||237===c&&160<=l||128!=(192&(o=e[s++]))?(s--,te()):n.push((15&c)<<12|(63&l)<<6|63&o):244>=c?s>=r-2?te():128!=(192&(l=e[s++]))||0!=l-144+(c<<28)>>30||128!=(192&(o=e[s++]))||128!=(192&(a=e[s++]))?(s--,te()):(c=(7&c)<<18|(63&l)<<12|(63&o)<<6|63&a,n.push(55296+((c-=65536)>>10&1023),56320+(1023&c))):te(),8192<=n.length&&(d=ie(d,n),n.length=0);s=ie(d,n)}return He(t,i,s),!0}),(function(e,t,i){if(null!=(t=Je(t,i))){var r=!1;if(r=void 0!==r&&r,ce){if(r&&/(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])/.test(t))throw Error("Found an unpaired surrogate");t=(ne||(ne=new TextEncoder)).encode(t)}else{for(var n=0,a=new Uint8Array(3*t.length),o=0;o<t.length;o++){var s=t.charCodeAt(o);if(128>s)a[n++]=s;else{if(2048>s)a[n++]=s>>6|192;else{if(55296<=s&&57343>=s){if(56319>=s&&o<t.length){var c=t.charCodeAt(++o);if(56320<=c&&57343>=c){a[n++]=(s=1024*(s-55296)+c-56320+65536)>>18|240,a[n++]=s>>12&63|128,a[n++]=s>>6&63|128,a[n++]=63&s|128;continue}o--}if(r)throw Error("Found an unpaired surrogate");s=65533}a[n++]=s>>12|224,a[n++]=s>>6&63|128}a[n++]=63&s|128}}t=n===a.length?a:a.subarray(0,n)}we(e.h,8*i+2),we(e.h,t.length),Re(e,e.h.end()),Re(e,t)}})),Vt=xt((function(e,t,i,r,n){if(2!==e.i)return!1;t=Ze(t,i,r),i=e.h.j,r=ve(e.h)>>>0;var a=e.h.h+r,o=a-i;if(0>=o&&(e.h.j=a,n(t,e,void 0,void 0,void 0),o=a-e.h.h),o)throw Error("Message parsing ended unexpectedly. Expected to read "+r+" bytes, instead read "+(r-o)+" bytes, either the data ended unexpectedly or the message misreported its own length");return e.h.h=a,e.h.j=i,!0}),(function(e,t,i,r,n){if(null!=(t=Ye(t,r,i)))for(r=0;r<t.length;r++){var a=e;we(a.h,8*i+2);var o=a.h.end();Re(a,o),o.push(a.i),a=o,n(t[r],e),o=e;var s=a.pop();for(s=o.i+o.h.length()-s;127<s;)a.push(127&s|128),s>>>=7,o.i++;a.push(s),o.i++}}));function Ut(e){return function(t,i){e:{if(Ae.length){var r=Ae.pop();r.setOptions(i),fe(r.h,t,i),t=r}else t=new Ce(t,i);try{var n=Ot(e),a=Dt(new n.P,t,n);break e}finally{(n=t.h).i=null,n.m=!1,n.l=0,n.j=0,n.h=0,n.S=!1,t.l=-1,t.i=-1,100>Ae.length&&Ae.push(t)}a=void 0}return a}}function Wt(e){return function(){var t=new Ee;Nt(this,t,Et(e)),Re(t,t.h.end());for(var i=new Uint8Array(t.i),r=t.j,n=r.length,a=0,o=0;o<n;o++){var s=r[o];i.set(s,a),a+=s.length}return t.j=[i],i}}function Gt(e){lt.call(this,e)}p(Gt,lt);var Jt=[Gt,1,Ft,2,jt,3,Bt,4,Bt];function Ht(e){lt.call(this,e,-1,zt)}Gt.prototype.l=Wt(Jt),p(Ht,lt),Ht.prototype.addClassification=function(e,t){return Ze(this,1,Gt,e,t),this};var zt=[1],Kt=Ut([Ht,1,Vt,Jt]);function Xt(e){lt.call(this,e)}p(Xt,lt);var qt=[Xt,1,jt,2,jt,3,jt,4,jt,5,jt];function Yt(e){lt.call(this,e,-1,Qt)}Xt.prototype.l=Wt(qt),p(Yt,lt);var Qt=[1],Zt=Ut([Yt,1,Vt,qt]);function $t(e){lt.call(this,e)}p($t,lt);var ei=[$t,1,jt,2,jt,3,jt,4,jt,5,jt,6,_t],ti=Ut(ei);function ii(e,t,i){if(i=e.createShader(0===i?e.VERTEX_SHADER:e.FRAGMENT_SHADER),e.shaderSource(i,t),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS))throw Error("Could not compile WebGL shader.\n\n"+e.getShaderInfoLog(i));return i}function ri(e){return Ye(e,Gt,1).map((function(e){var t=Je(e,1);return{index:null==t?0:t,qa:et(e,2),label:null!=Je(e,3)?$e(Je(e,3),""):void 0,displayName:null!=Je(e,4)?$e(Je(e,4),""):void 0}}))}function ni(e){return{x:et(e,1),y:et(e,2),z:et(e,3),visibility:null!=Xe(e,4)?et(e,4):void 0}}function ai(e,t){this.i=e,this.h=t,this.m=0}function oi(e,t,i){return function(e,t){var i=e.h;if(void 0===e.s){var r=ii(i,"\n  attribute vec2 aVertex;\n  attribute vec2 aTex;\n  varying vec2 vTex;\n  void main(void) {\n    gl_Position = vec4(aVertex, 0.0, 1.0);\n    vTex = aTex;\n  }",0),n=ii(i,"\n  precision mediump float;\n  varying vec2 vTex;\n  uniform sampler2D sampler0;\n  void main(){\n    gl_FragColor = texture2D(sampler0, vTex);\n  }",1),a=i.createProgram();if(i.attachShader(a,r),i.attachShader(a,n),i.linkProgram(a),!i.getProgramParameter(a,i.LINK_STATUS))throw Error("Could not compile WebGL program.\n\n"+i.getProgramInfoLog(a));r=e.s=a,i.useProgram(r),n=i.getUniformLocation(r,"sampler0"),e.l={O:i.getAttribLocation(r,"aVertex"),N:i.getAttribLocation(r,"aTex"),ya:n},e.v=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,e.v),i.enableVertexAttribArray(e.l.O),i.vertexAttribPointer(e.l.O,2,i.FLOAT,!1,0,0),i.bufferData(i.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),i.STATIC_DRAW),i.bindBuffer(i.ARRAY_BUFFER,null),e.u=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,e.u),i.enableVertexAttribArray(e.l.N),i.vertexAttribPointer(e.l.N,2,i.FLOAT,!1,0,0),i.bufferData(i.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),i.STATIC_DRAW),i.bindBuffer(i.ARRAY_BUFFER,null),i.uniform1i(n,0)}r=e.l,i.useProgram(e.s),i.canvas.width=t.width,i.canvas.height=t.height,i.viewport(0,0,t.width,t.height),i.activeTexture(i.TEXTURE0),e.i.bindTexture2d(t.glName),i.enableVertexAttribArray(r.O),i.bindBuffer(i.ARRAY_BUFFER,e.v),i.vertexAttribPointer(r.O,2,i.FLOAT,!1,0,0),i.enableVertexAttribArray(r.N),i.bindBuffer(i.ARRAY_BUFFER,e.u),i.vertexAttribPointer(r.N,2,i.FLOAT,!1,0,0),i.bindFramebuffer(i.DRAW_FRAMEBUFFER?i.DRAW_FRAMEBUFFER:i.FRAMEBUFFER,null),i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT),i.colorMask(!0,!0,!0,!0),i.drawArrays(i.TRIANGLE_FAN,0,4),i.disableVertexAttribArray(r.O),i.disableVertexAttribArray(r.N),i.bindBuffer(i.ARRAY_BUFFER,null),e.i.bindTexture2d(0)}(e,t),"function"==typeof e.h.canvas.transferToImageBitmap?Promise.resolve(e.h.canvas.transferToImageBitmap()):i?Promise.resolve(e.h.canvas):"function"==typeof createImageBitmap?createImageBitmap(e.h.canvas):(void 0===e.j&&(e.j=document.createElement("canvas")),new Promise((function(t){e.j.height=e.h.canvas.height,e.j.width=e.h.canvas.width,e.j.getContext("2d",{}).drawImage(e.h.canvas,0,0,e.h.canvas.width,e.h.canvas.height),t(e.j)})))}function si(e){this.h=e}$t.prototype.l=Wt(ei);var ci=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]);function li(e,t){return t+e}function di(e,t){window[e]=t}function ui(e){if(this.h=e,this.listeners={},this.l={},this.L={},this.s={},this.v={},this.M=this.u=this.ga=!0,this.I=Promise.resolve(),this.fa="",this.D={},this.locateFile=e&&e.locateFile||li,"object"==typeof window)var t=window.location.pathname.toString().substring(0,window.location.pathname.toString().lastIndexOf("/"))+"/";else{if("undefined"==typeof location)throw Error("solutions can only be loaded on a web page or in a web worker");t=location.pathname.toString().substring(0,location.pathname.toString().lastIndexOf("/"))+"/"}if(this.ha=t,e.options)for(var i=(t=s(Object.keys(e.options))).next();!i.done;i=t.next()){var r=e.options[i=i.value].default;void 0!==r&&(this.l[i]="function"==typeof r?r():r)}}function hi(e,t){var i,r;return T((function(n){return t in e.L?n.return(e.L[t]):(i=e.locateFile(t,""),r=fetch(i).then((function(e){return e.arrayBuffer()})),e.L[t]=r,n.return(r))}))}function mi(e,t){for(var i=t.name||"$",r=[].concat(c(t.wants)),n=new e.i.StringList,a=s(t.wants),o=a.next();!o.done;o=a.next())n.push_back(o.value);a=e.i.PacketListener.implement({onResults:function(n){for(var a={},o=0;o<t.wants.length;++o)a[r[o]]=n.get(o);var c=e.listeners[i];c&&(e.I=function(e,t,i){var r,n,a,o,c,l,d,u,h,m,f,p;return T((function(v){switch(v.h){case 1:if(!i)return v.return(t);for(r={},n=0,a=s(Object.keys(i)),o=a.next();!o.done;o=a.next())"string"!=typeof(c=i[o.value])&&"texture"===c.type&&void 0!==t[c.stream]&&++n;1<n&&(e.M=!1),l=s(Object.keys(i)),o=l.next();case 2:if(o.done){v.h=4;break}if("string"==typeof(u=i[d=o.value]))return f=r,p=d,y(v,function(e,t,i){var r;return T((function(n){return"number"==typeof i||i instanceof Uint8Array||i instanceof e.i.Uint8BlobList?n.return(i):i instanceof e.i.Texture2dDataOut?((r=e.v[t])||(r=new ai(e.i,e.K),e.v[t]=r),n.return(oi(r,i,e.M))):n.return(void 0)}))}(e,d,t[u]),14);if(h=t[u.stream],"detection_list"===u.type){if(h){for(var g=h.getRectList(),b=h.getLandmarksList(),S=h.getClassificationsList(),w=[],C=0;C<g.size();++C){var k=ti(g.get(C)),A=void 0;A=void 0===A?0:A,k={la:{sa:et(k,1),ta:et(k,2),height:et(k,3),width:et(k,4),rotation:et(k,5,0),pa:$e(Je(k,6),A)},ea:Ye(Zt(b.get(C)),Xt,1).map(ni),ba:ri(Kt(S.get(C)))},w.push(k)}g=w}else g=[];r[d]=g,v.h=7;break}if("proto_list"===u.type){if(h){for(g=Array(h.size()),b=0;b<h.size();b++)g[b]=h.get(b);h.delete()}else g=[];r[d]=g,v.h=7;break}if(void 0===h){v.h=3;break}if("float_list"===u.type){r[d]=h,v.h=7;break}if("proto"===u.type){r[d]=h,v.h=7;break}if("texture"!==u.type)throw Error("Unknown output config type: '"+u.type+"'");return(m=e.v[d])||(m=new ai(e.i,e.K),e.v[d]=m),y(v,oi(m,h,e.M),13);case 13:r[d]=v.i;case 7:u.transform&&r[d]&&(r[d]=u.transform(r[d])),v.h=3;break;case 14:f[p]=v.i;case 3:o=l.next(),v.h=2;break;case 4:return v.return(r)}}))}(e,a,t.outs).then((function(i){i=c(i);for(var n=0;n<t.wants.length;++n){var o=a[r[n]];"object"==typeof o&&o.hasOwnProperty&&o.hasOwnProperty("delete")&&o.delete()}i&&(e.I=i)})))}}),e.j.attachMultiListener(n,a),n.delete()}function fi(e){switch(void 0===e&&(e=0),e){case 1:return"selfie_segmentation_landscape.tflite";default:return"selfie_segmentation.tflite"}}function pi(e){var t=this;this.h=new ui({locateFile:(e=e||{}).locateFile,files:function(e){return[{simd:!0,url:"selfie_segmentation_solution_simd_wasm_bin.js"},{simd:!1,url:"selfie_segmentation_solution_wasm_bin.js"},{data:!0,url:fi(e.modelSelection)}]},graph:{url:"selfie_segmentation.binarypb"},listeners:[{wants:["segmentation_mask","image_transformed"],outs:{image:{type:"texture",stream:"image_transformed"},segmentationMask:{type:"texture",stream:"segmentation_mask"}}}],inputs:{image:{type:"video",stream:"input_frames_gpu"}},options:{useCpuInference:{type:0,graphOptionXref:{calculatorType:"InferenceCalculator",fieldName:"use_cpu_inference"},default:"object"==typeof window&&void 0!==window.navigator&&("iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document)},selfieMode:{type:0,graphOptionXref:{calculatorType:"GlScalerCalculator",calculatorIndex:1,fieldName:"flip_horizontal"}},modelSelection:{type:1,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorModelSelection",fieldName:"int_value"},onChange:function(e){var i,r;return T((function(n){return 1==n.h?(i=fi(e),r="third_party/mediapipe/modules/selfie_segmentation/"+i,y(n,hi(t.h,i),2)):(t.h.overrideFile(r,n.i),n.return(!0))}))}}}})}(e=ui.prototype).close=function(){return this.j&&this.j.delete(),Promise.resolve()},e.reset=function(){var e=this;return T((function(t){e.j&&(e.j.reset(),e.s={},e.v={}),t.h=0}))},e.setOptions=function(e,t){var i=this;if(t=t||this.h.options){for(var n=[],a=[],o={},c=s(Object.keys(e)),l=c.next();!l.done;o={X:o.X,Y:o.Y},l=c.next())if(!((l=l.value)in this.l)||this.l[l]!==e[l]){this.l[l]=e[l];var d=t[l];void 0!==d&&(d.onChange&&(o.X=d.onChange,o.Y=e[l],n.push(function(e){return function(){return T((function(t){if(1==t.h)return y(t,e.X(e.Y),2);!0===t.i&&(i.u=!0),t.h=0}))}}(o))),d.graphOptionXref&&(l=Object(r._)({},{calculatorName:"",calculatorIndex:0},d.graphOptionXref,{valueNumber:1===d.type?e[l]:0,valueBoolean:0===d.type&&e[l],valueString:2===d.type?e[l]:""}),a.push(l)))}0===n.length&&0===a.length||(this.u=!0,this.H=(void 0===this.H?[]:this.H).concat(a),this.F=(void 0===this.F?[]:this.F).concat(n))}},e.initialize=function(){var e=this;return T((function(t){return 1==t.h?y(t,function(e){var t,i,r,n,a,o,s,l,d,u,h;return T((function(m){switch(m.h){case 1:return e.ga?(t=void 0===e.h.files?[]:"function"==typeof e.h.files?e.h.files(e.l):e.h.files,y(m,T((function(e){switch(e.h){case 1:return e.s=2,y(e,WebAssembly.instantiate(ci),4);case 4:e.h=3,e.s=0;break;case 2:return e.s=0,e.l=null,e.return(!1);case 3:return e.return(!0)}})),2)):m.return();case 2:if(i=m.i,"object"==typeof window)return di("createMediapipeSolutionsWasm",{locateFile:e.locateFile}),di("createMediapipeSolutionsPackedAssets",{locateFile:e.locateFile}),o=t.filter((function(e){return void 0!==e.data})),s=t.filter((function(e){return void 0===e.data})),l=Promise.all(o.map((function(t){var i=hi(e,t.url);if(void 0!==t.path){var r=t.path;i=i.then((function(t){return e.overrideFile(r,t),Promise.resolve(t)}))}return i}))),d=Promise.all(s.map((function(t){return void 0===t.simd||t.simd&&i||!t.simd&&!i?function(e){var t=document.createElement("script");return t.setAttribute("src",e),t.setAttribute("crossorigin","anonymous"),new Promise((function(e){t.addEventListener("load",(function(){e()}),!1),t.addEventListener("error",(function(){e()}),!1),document.body.appendChild(t)}))}(e.locateFile(t.url,e.ha)):Promise.resolve()}))).then((function(){var t,i,r;return T((function(n){if(1==n.h)return t=window.createMediapipeSolutionsWasm,i=window.createMediapipeSolutionsPackedAssets,r=e,y(n,t(i),2);r.i=n.i,n.h=0}))})),u=T((function(t){return e.h.graph&&e.h.graph.url?t=y(t,hi(e,e.h.graph.url),0):(t.h=0,t=void 0),t})),y(m,Promise.all([d,l,u]),7);if("function"!=typeof importScripts)throw Error("solutions can only be loaded on a web page or in a web worker");return r=t.filter((function(e){return void 0===e.simd||e.simd&&i||!e.simd&&!i})).map((function(t){return e.locateFile(t.url,e.ha)})),importScripts.apply(null,c(r)),n=e,y(m,createMediapipeSolutionsWasm(Module),6);case 6:n.i=m.i,e.m=new OffscreenCanvas(1,1),e.i.canvas=e.m,a=e.i.GL.createContext(e.m,{antialias:!1,alpha:!1,va:"undefined"!=typeof WebGL2RenderingContext?2:1}),e.i.GL.makeContextCurrent(a),m.h=4;break;case 7:if(e.m=document.createElement("canvas"),!(h=e.m.getContext("webgl2",{}))&&!(h=e.m.getContext("webgl",{})))return alert("Failed to create WebGL canvas context when passing video frame."),m.return();e.K=h,e.i.canvas=e.m,e.i.createContext(e.m,!0,!0,{});case 4:e.j=new e.i.SolutionWasm,e.ga=!1,m.h=0}}))}(e),2):3!=t.h?y(t,function(e){var t,i,r,n,a,o;return T((function(c){if(1==c.h)return e.h.graph&&e.h.graph.url&&e.fa===e.h.graph.url?c.return():(e.u=!0,e.h.graph&&e.h.graph.url?(e.fa=e.h.graph.url,y(c,hi(e,e.h.graph.url),3)):void(c.h=2));for(2!=c.h&&e.j.loadGraph(c.i),t=s(Object.keys(e.D)),i=t.next();!i.done;i=t.next())e.j.overrideFile(r=i.value,e.D[r]);if(e.D={},e.h.listeners)for(n=s(e.h.listeners),a=n.next();!a.done;a=n.next())mi(e,a.value);o=e.l,e.l={},e.setOptions(o),c.h=0}))}(e),3):y(t,function(e){var t,i,r,n,a;return T((function(o){switch(o.h){case 1:if(!e.u)return o.return();if(!e.F){o.h=2;break}t=s(e.F),i=t.next();case 3:if(i.done){o.h=5;break}return y(o,(0,i.value)(),4);case 4:i=t.next(),o.h=3;break;case 5:e.F=void 0;case 2:if(e.H){for(r=new e.i.GraphOptionChangeRequestList,n=s(e.H),a=n.next();!a.done;a=n.next())r.push_back(a.value);e.j.changeOptions(r),r.delete(),e.H=void 0}e.u=!1,o.h=0}}))}(e),0)}))},e.overrideFile=function(e,t){this.j?this.j.overrideFile(e,t):this.D[e]=t},e.clearOverriddenFiles=function(){this.D={},this.j&&this.j.clearOverriddenFiles()},e.send=function(e,t){var i,n,a,o,c,l,d,u,h,m=this;return T((function(f){switch(f.h){case 1:return m.h.inputs?(i=1e3*(null==t?performance.now():t),y(f,m.I,2)):f.return();case 2:return y(f,m.initialize(),3);case 3:for(n=new m.i.PacketDataList,a=s(Object.keys(e)),o=a.next();!o.done;o=a.next())if(l=m.h.inputs[c=o.value]){e:{var p=e[c];switch(l.type){case"video":var v=m.s[l.stream];if(v||(v=new ai(m.i,m.K),m.s[l.stream]=v),0===v.m&&(v.m=v.i.createTexture()),"undefined"!=typeof HTMLVideoElement&&p instanceof HTMLVideoElement)var g=p.videoWidth,b=p.videoHeight;else"undefined"!=typeof HTMLImageElement&&p instanceof HTMLImageElement?(g=p.naturalWidth,b=p.naturalHeight):(g=p.width,b=p.height);b={glName:v.m,width:g,height:b},(g=v.h).canvas.width=b.width,g.canvas.height=b.height,g.activeTexture(g.TEXTURE0),v.i.bindTexture2d(v.m),g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,p),v.i.bindTexture2d(0),v=b;break e;case"detections":for((v=m.s[l.stream])||(v=new si(m.i),m.s[l.stream]=v),v.data||(v.data=new v.h.DetectionListData),v.data.reset(p.length),b=0;b<p.length;++b){var S=v.data,w=S.setBoundingBox,C=b,k=(g=p[b]).la,T=new $t;if(Qe(T,1,k.sa),Qe(T,2,k.ta),Qe(T,3,k.height),Qe(T,4,k.width),Qe(T,5,k.rotation),He(T,6,k.pa),k=T.l(),w.call(S,C,k),g.ea)for(S=0;S<g.ea.length;++S){T=g.ea[S],C=(w=v.data).addNormalizedLandmark,k=b,T=Object(r._)({},T,{visibility:T.visibility?T.visibility:0});var A=new Xt;Qe(A,1,T.x),Qe(A,2,T.y),Qe(A,3,T.z),T.visibility&&Qe(A,4,T.visibility),T=A.l(),C.call(w,k,T)}if(g.ba)for(S=0;S<g.ba.length;++S)C=(w=v.data).addClassification,k=b,T=g.ba[S],Qe(A=new Gt,2,T.qa),T.index&&He(A,1,T.index),T.label&&He(A,3,T.label),T.displayName&&He(A,4,T.displayName),T=A.l(),C.call(w,k,T)}v=v.data;break e;default:v={}}}switch(d=v,u=l.stream,l.type){case"video":n.pushTexture2d(Object(r._)({},d,{stream:u,timestamp:i}));break;case"detections":(h=d).stream=u,h.timestamp=i,n.pushDetectionList(h);break;default:throw Error("Unknown input config type: '"+l.type+"'")}}return m.j.send(n),y(f,m.I,4);case 4:n.delete(),f.h=0}}))},e.onResults=function(e,t){this.listeners[t||"$"]=e},P("Solution",ui),P("OptionType",{BOOL:0,NUMBER:1,ua:2,0:"BOOL",1:"NUMBER",2:"STRING"}),(e=pi.prototype).close=function(){return this.h.close(),Promise.resolve()},e.onResults=function(e){this.h.onResults(e)},e.initialize=function(){var e=this;return T((function(t){return y(t,e.h.initialize(),0)}))},e.reset=function(){this.h.reset()},e.send=function(e){var t=this;return T((function(i){return y(i,t.h.send(e),0)}))},e.setOptions=function(e){this.h.setOptions(e)},P("SelfieSegmentation",pi),P("VERSION","0.1.1675465747")}).call(E);var R=window.log,P=new WeakMap,I=new WeakSet;class M{constructor(e){var t;y(this,t=I),t.add(this),function(e,t,i){y(e,t),t.set(e,{writable:!0,value:null})}(this,P),this.webRTCAdaptor=e,this.selfieSegmentation=null,this.effectCanvas=null,this.ctx=null,this.rawLocalVideo=document.createElement("video"),this.deepAR=null,this.backgroundBlurRange=3,this.edgeBlurRange=4,this.effectName=M.NO_EFFECT,this.startTime=0,this.statTimerId=-1,this.renderedFrameCount=0,this.lastRenderedFrameCount=0,this.effectCanvasFPS=0,this.videoCallbackPeriodMs=0,this.initializeSelfieSegmentation(),this.isInitialized=!0}init(e){var t=this;return p((function*(){yield t.setRawLocalVideo(e);var i=e.getVideoTracks()[0].getSettings();return t.effectCanvasFPS=i.frameRate,t.videoCallbackPeriodMs=1e3/t.effectCanvasFPS,t.effectCanvas=t.createEffectCanvas(i.width,i.height),t.ctx=t.effectCanvas.getContext("2d"),t.canvasStream&&(t.canvasStream.getTracks().forEach(e=>e.stop()),t.canvasStream=null),t.canvasStream=t.effectCanvas.captureStream(t.effectCanvasFPS),new Promise((e,i)=>{e(t.canvasStream)})}))()}setRawLocalVideo(e){return this.rawLocalVideo.srcObject=e,this.rawLocalVideo.muted=!0,this.rawLocalVideo.autoplay=!0,this.rawLocalVideo.play()}createEffectCanvas(e,t){var i=document.createElement("canvas");return i.id="effectCanvas",i.width=e,i.height=t,i}initializeSelfieSegmentation(){this.selfieSegmentation=new SelfieSegmentation({locateFile:e=>M.LOCATE_FILE_URL+"/"+e}),this.selfieSegmentation.setOptions({selfieMode:!1,modelSelection:1}),this.selfieSegmentation.onResults(e=>{this.onResults(e)})}set virtualBackgroundImage(e){var t;t=e,function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(this,g(this,P,"set"),t)}startFpsCalculation(){this.statTimerId=setInterval(()=>{var e=(new Date).getTime(),t=(e-this.startTime)/1e3;this.startTime=e;var i=(this.renderedFrameCount-this.lastRenderedFrameCount)/t;this.renderedFrameCount=this.lastRenderedFrameCount,R.warn("Fps: "+i+"fps")},1e3)}stopFpsCalculation(){-1!==this.statTimerId&&(clearInterval(this.statTimerId),this.statTimerId=-1)}processFrame(){var e=this;return p((function*(){yield e.selfieSegmentation.send({image:e.rawLocalVideo}),e.effectName!==M.NO_EFFECT&&setTimeout(()=>{e.processFrame()},e.videoCallbackPeriodMs)}))()}setBlurEffectRange(e,t){this.backgroundBlurRange=e,this.edgeBlurRange=t}enableEffect(e,t,i){var r=this;return p((function*(){if(r.isInitialized){switch(e){case M.DEEPAR:case M.VIRTUAL_BACKGROUND:case M.BLUR_BACKGROUND:case M.NO_EFFECT:break;default:return void R.warn("Unknown effect name please use the constants VideoEffect.VIRTUAL_BACKGROUND,VideoEffect.BLUR_BACKGROUND or VideoEffect.NO_EFFECT ")}var n=r.effectName;if(r.effectName=e,n===M.DEEPAR&&e!==M.DEEPAR&&(r.deepAR.shutdown(),r.deepAR=null),e===M.VIRTUAL_BACKGROUND||e===M.BLUR_BACKGROUND)return n===M.NO_EFFECT||n===M.DEEPAR?(M.DEBUG&&r.startFpsCalculation(),navigator.mediaDevices.getUserMedia({video:r.webRTCAdaptor.mediaConstraints.video,audio:!0}).then(e=>r.init(e).then(e=>r.webRTCAdaptor.updateVideoTrack(e,r.webRTCAdaptor.publishStreamId,null,!0).then(()=>{setTimeout(()=>{r.processFrame()},r.videoCallbackPeriodMs)})).catch(e=>{throw R.error(e),e}))):new Promise((e,t)=>{e()});if(e!==M.DEEPAR){if(n===M.DEEPAR){var a=yield navigator.mediaDevices.getUserMedia({video:r.webRTCAdaptor.mediaConstraints.video,audio:!0});yield r.setRawLocalVideo(a)}return new Promise((e,t)=>{r.stopFpsCalculation(),b(r,I,L).call(r),e()})}if(null!=t&&""!==t&&null!=i&&""!==i)if(n!==M.DEEPAR){n!==M.BLUR_BACKGROUND&&n!==M.VIRTUAL_BACKGROUND||(r.stopFpsCalculation(),yield b(r,I,L).call(r));var o=r.createEffectCanvas(500,500),s=new DeepAR({licenseKey:t,canvas:o,deeparWasmPath:M.DEEP_AR_FOLDER_ROOT_URL+"/wasm/deepar.wasm",callbacks:{onInitialize:function(){s.startVideo(!0)}}});r.deepAR=s,r.deepAR.callbacks.onVideoStarted=()=>{r.canvasStream=o.captureStream(30),r.webRTCAdaptor.updateVideoTrack(r.canvasStream,r.webRTCAdaptor.publishStreamId,null,!0),r.deepAR.switchEffect(0,"slot",M.DEEP_AR_EFFECTS_URL+i+M.DEEP_AR_EXTENSION)},r.deepAR.downloadFaceTrackingModel(M.DEEP_AR_FOLDER_ROOT_URL+"/models/face/models-68-extreme.bin"),r.deepAR.setVideoElement(r.rawLocalVideo,!0)}else r.deepAR.switchEffect(0,"slot",M.DEEP_AR_EFFECTS_URL+i+M.DEEP_AR_EXTENSION);else R.error("DeepAR API key or DeepAR Model is not set!")}else R.error("VideoEffect is not initialized!")}))()}drawSegmentationMask(e){this.ctx.drawImage(e,0,0,this.effectCanvas.width,this.effectCanvas.height)}onResults(e){this.renderedFrameCount++,this.effectName==M.BLUR_BACKGROUND?this.drawBlurBackground(e.image,e.segmentationMask,this.backgroundBlurRange):this.effectName==M.VIRTUAL_BACKGROUND?this.drawVirtualBackground(e.image,e.segmentationMask,function(e,t){return t.get?t.get.call(e):t.value}(this,g(this,P,"get"))):this.drawImageDirectly(e.image)}drawImageDirectly(e){this.ctx.save(),this.ctx.globalCompositeOperation="source-over",this.ctx.filter="none",this.ctx.drawImage(e,0,0,e.width,e.height),this.ctx.restore()}drawVirtualBackground(e,t,i){this.ctx.save(),this.ctx.filter="none",this.ctx.clearRect(0,0,this.effectCanvas.width,this.effectCanvas.height),this.ctx.drawImage(t,0,0,this.effectCanvas.width,this.effectCanvas.height),this.ctx.globalCompositeOperation="source-out",this.ctx.drawImage(i,0,0,i.naturalWidth,i.naturalHeight,0,0,this.effectCanvas.width,this.effectCanvas.height),this.ctx.globalCompositeOperation="destination-atop",this.ctx.drawImage(e,0,0,this.effectCanvas.width,this.effectCanvas.height),this.ctx.restore()}drawBlurBackground(e,t,i){this.ctx.clearRect(0,0,this.effectCanvas.width,this.effectCanvas.height),this.ctx.globalCompositeOperation="copy",this.ctx.filter="none",this.ctx.filter="blur("+this.edgeBlurRange+"px)",this.drawSegmentationMask(t),this.ctx.globalCompositeOperation="source-in",this.ctx.filter="none",this.ctx.drawImage(e,0,0,this.effectCanvas.width,this.effectCanvas.height),this.ctx.globalCompositeOperation="destination-over",this.ctx.filter="blur("+i+"px)",this.ctx.drawImage(e,0,0,this.effectCanvas.width,this.effectCanvas.height),this.ctx.restore()}}function L(){return this.rawLocalVideo.pause(),null!=this.canvasStream&&this.canvasStream.getVideoTracks().forEach(e=>e.stop()),this.webRTCAdaptor.switchVideoCameraCapture(this.webRTCAdaptor.publishStreamId)}v(M,"DEEPAR","deepar"),v(M,"VIRTUAL_BACKGROUND","virtual-background"),v(M,"BLUR_BACKGROUND","blur-background"),v(M,"NO_EFFECT","no-effect"),v(M,"deepARModelList",["flower_face","Ping_Pong"]),v(M,"DEBUG",!1),v(M,"LOCATE_FILE_URL","https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation"),v(M,"DEEP_AR_FOLDER_ROOT_URL","https://cdn.jsdelivr.net/npm/deepar@4.0.3"),v(M,"DEEP_AR_EFFECTS_URL","../js/external/deepar-effects/"),v(M,"DEEP_AR_EXTENSION",".deepar"),A.register(e=>{var t=new M(e);Object.defineProperty(e,"setBlurEffectRange",{value:function(e,i){t.setBlurEffectRange(e,i)}}),Object.defineProperty(e,"enableEffect",{value:function(e,i,r){return t.enableEffect(e,i,r)}}),Object.defineProperty(e,"setBackgroundImage",{value:function(e){t.virtualBackgroundImage=e}})});const O={sdpConstraints:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0},mediaConstraints:{video:!1,audio:!1}};class D{constructor(e,t,i){this.player=Object(r.v)(i.playerId),this.player.hasOwnProperty("sendDataViaWebRTC")||Object.defineProperty(this.player,"sendDataViaWebRTC",{value:e=>{this.webRTCAdaptor.sendData(this.source.streamName,e)}}),this.isPlaying=!1,this.disposed=!1,this.initiateWebRTCAdaptor(e,i),this.player.ready(()=>{this.player.addClass("videojs-webrtc-plugin")}),this.player.on("playing",()=>{this.player.el().getElementsByClassName("vjs-custom-spinner").length&&this.player.el().removeChild(this.player.spinner)}),r.v.registerComponent("ResolutionMenuButton",c),r.v.registerComponent("ResolutionMenuItem",o)}initiateWebRTCAdaptor(e,t){this.options=r.v.mergeOptions(O,t),this.source=e,"object"==typeof e.iceServers?this.source.pcConfig={iceServers:e.iceServers}:"string"==typeof e.iceServers&&(this.source.pcConfig={iceServers:JSON.parse(e.iceServers)}),this.source.mediaServerUrl=e.src.replace(e.src.split("/").at(-1),"websocket"),this.source.streamName=e.src.split("/").at(-1).split(".webrtc")[0],this.source.token=this.getUrlParameter("token"),this.source.subscriberId=this.getUrlParameter("subscriberId"),this.source.subscriberCode=this.getUrlParameter("subscriberCode"),this.source.reconnect=void 0===this.source.reconnect||this.source.reconnect;const i={websocketURL:this.source.mediaServerUrl,mediaConstraints:this.source.mediaConstraints,isPlayMode:!0,sdpConstraints:this.source.sdpConstraints,reconnectIfRequiredFlag:this.source.reconnect,callback:(e,t)=>{if(!this.disposed)switch(this.player.trigger("webrtc-info",{obj:t,info:e}),e){case"initialized":this.play();break;case"ice_connection_state_changed":break;case"play_started":this.joinStreamHandler(t),this.isPlaying=!0,this.player.trigger("play");break;case"play_finished":this.leaveStreamHandler(t),this.isPlaying=!1,this.player.trigger("ended");break;case"streamInformation":this.streamInformationHandler(t);break;case"resolutionChangeInfo":this.resolutionChangeHandler(t);break;case"data_received":this.player.trigger("webrtc-data-received",{obj:t});break;case"data_channel_not_open":break;case"newTrackAvailable":{const e=this.player.tech().el();e.srcObject!==t.stream&&(e.srcObject=t.stream);break}}},callbackError:(e,t)=>{if(this.disposed)return;const i=r.v.getComponent("ModalDialog");this.errorModal&&this.errorModal.close(),this.errorModal=new i(this.player,{content:"ERROR: "+JSON.stringify(e),temporary:!0,pauseOnOpen:!1,uncloseable:!0}),this.player.addChild(this.errorModal),this.errorModal.open(),this.errorModal.setTimeout(()=>this.errorModal.close(),3e3),this.player.trigger("webrtc-error",{error:e,message:t})}};if(this.source.pcConfig){const e={};Object(r._)(e,this.source.pcConfig),Object(r._)(i,{peerconnection_config:e})}this.webRTCAdaptor=new A(i)}play(){this.webRTCAdaptor.play(this.source.streamName,this.source.token,null,null,this.source.subscriberId,this.source.subscriberCode,null)}joinStreamHandler(e){this.webRTCAdaptor.getStreamInfo(this.source.streamName)}leaveStreamHandler(){this.player.resolutions=[];const e=this.player.controlBar.getChild("ResolutionMenuButton");e&&e.update()}streamInformationHandler(e){const t=e.streamInfo.reduce((e,t)=>e.includes(t.streamHeight)?e:[...e,t.streamHeight],[]).sort((e,t)=>t-e);this.player.resolutions=t.map(e=>({label:e,value:e})),this.player.selectedResolution=0,this.addResolutionButton()}addResolutionButton(){const e=this.player.controlBar,t=e.getChild("fullscreenToggle").el();e.getChild("ResolutionMenuButton")&&e.removeChild("ResolutionMenuButton"),e.el().insertBefore(e.addChild("ResolutionMenuButton",{plugin:this,streamName:this.source.streamName}).el(),t)}resolutionChangeHandler(e){this.player.spinner=document.createElement("div"),this.player.spinner.className="vjs-custom-spinner",this.player.el().appendChild(this.player.spinner),this.player.pause(),this.player.setTimeout(()=>{this.player.el().getElementsByClassName("vjs-custom-spinner").length&&(this.player.el().removeChild(this.player.spinner),this.player.play())},2e3)}changeStreamQuality(e){this.webRTCAdaptor.forceStreamQuality(this.source.streamName,e),this.player.selectedResolution=e,this.player.controlBar.getChild("ResolutionMenuButton").update()}getUrlParameter(e){return this.source.src.includes("?")?(this.source.src.split("?")[1].split("&").reduce((e,t)=>{const i=t.split("=");return e[decodeURIComponent(i[0])]=decodeURIComponent(i[1]),e},{})||{})[e]:null}dispose(){this.disposed=!0,this.webRTCAdaptor&&(this.webRTCAdaptor.stop(this.source.streamName),this.webRTCAdaptor.closeWebSocket(),this.webRTCAdaptor=null)}}const N={name:"videojs-webrtc-plugin",VERSION:"1.3.1",canHandleSource(e,t={}){const i=r.v.mergeOptions(r.v.options,t);return i.source=e.src,N.canPlayType(e.type,i)},handleSource(e,t,i={}){const n=r.v.mergeOptions(r.v.options,i);return t.webrtc=new D(e,t,n),t.webrtc},canPlayType:(e,t={})=>/\.webrtc.*$/.test(t.source)?"maybe":""};r.v.getTech("Html5").registerSourceHandler(N,0);var x={WebRTCHandler:D,webRTCSourceHandler:N}}).call(this,i("yLpj"))}}]);